<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>pycopi API documentation</title>
    <meta name="description" content="This file is part of PyCoTools.

PyCoTools is free software: you can redistribute it and/or modify
i..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.CopasiMLParser">CopasiMLParser</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.CopasiMLParser.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.CopasiMLParser.write_copasi_file">write_copasi_file</a></li>
    <li class="mono"><a href="#pycopi.CopasiMLParser.write_copasi_file_deprecated">write_copasi_file_deprecated</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.ExperimentMapper">ExperimentMapper</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.ExperimentMapper.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.add_experiment_set">add_experiment_set</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.create_experiment">create_experiment</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.get_existing_experiments">get_existing_experiments</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.map_experiments">map_experiments</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.remove_all_experiments">remove_all_experiments</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.remove_experiment">remove_experiment</a></li>
    <li class="mono"><a href="#pycopi.ExperimentMapper.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.GetModelQuantities">GetModelQuantities</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.GetModelQuantities.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.check_ascii">check_ascii</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.compartment_lookup">compartment_lookup</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.convert_molar_to_particles">convert_molar_to_particles</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.convert_particles_to_molar">convert_particles_to_molar</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_IC_cns">get_IC_cns</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_all_model_variables">get_all_model_variables</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_all_params_dict_deprecated">get_all_params_dict_deprecated</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_all_params_dict_deprecated2">get_all_params_dict_deprecated2</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_compartments">get_compartments</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_experiment_files">get_experiment_files</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_fit_items">get_fit_items</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_global_kinetic_parameters_cns">get_global_kinetic_parameters_cns</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_global_quantities">get_global_quantities</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_global_quantities_cns">get_global_quantities_cns</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_local_kinetic_parameters_cns">get_local_kinetic_parameters_cns</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_local_parameters">get_local_parameters</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_metabolites">get_metabolites</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_model_name">get_model_name</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_model_name_cn">get_model_name_cn</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_quantity_units">get_quantity_units</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_time_unit">get_time_unit</a></li>
    <li class="mono"><a href="#pycopi.GetModelQuantities.get_volume_unit">get_volume_unit</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.InsertParameters">InsertParameters</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.InsertParameters.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.check_parameter_consistancy">check_parameter_consistancy</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.check_parameter_consistancy_deprecated">check_parameter_consistancy_deprecated</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.get_current_parameters_deprecated">get_current_parameters_deprecated</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.get_parameters">get_parameters</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.insert_ICs">insert_ICs</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.insert_all">insert_all</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.insert_fit_items">insert_fit_items</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.insert_global">insert_global</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.insert_locals">insert_locals</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.replace_gl_and_lt">replace_gl_and_lt</a></li>
    <li class="mono"><a href="#pycopi.InsertParameters.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.ParameterEstimation">ParameterEstimation</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.ParameterEstimation.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.add_fit_item">add_fit_item</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.clear_pe">clear_pe</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.convert_to_string">convert_to_string</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.define_report">define_report</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.get_fit_items">get_fit_items</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.get_item_template">get_item_template</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.get_report_key">get_report_key</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.insert_all_fit_items">insert_all_fit_items</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.plot">plot</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.read_item_template">read_item_template</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.remove_all_fit_items">remove_all_fit_items</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.remove_fit_item">remove_fit_item</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.run">run</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.save">save</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.set_PE_method">set_PE_method</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.set_PE_options">set_PE_options</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.set_up">set_up</a></li>
    <li class="mono"><a href="#pycopi.ParameterEstimation.write_item_template">write_item_template</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.ParsePEDataDeprecated">ParsePEDataDeprecated</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.read_data">read_data</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.read_file">read_file</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.read_folder">read_folder</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.read_pickle">read_pickle</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.remove_copasi_headers">remove_copasi_headers</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.rename_RSS">rename_RSS</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.sort_data">sort_data</a></li>
    <li class="mono"><a href="#pycopi.ParsePEDataDeprecated.write_pickle">write_pickle</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.PhaseSpace">PhaseSpace</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.PhaseSpace.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.get_combinations">get_combinations</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.get_report_key">get_report_key</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.isolate_species">isolate_species</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.make_phase_dir">make_phase_dir</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.plot">plot</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.plot1phase">plot1phase</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.plot_all_phase">plot_all_phase</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.read_sim_data">read_sim_data</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.report_definition">report_definition</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.run">run</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.save">save</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.set_deterministic">set_deterministic</a></li>
    <li class="mono"><a href="#pycopi.PhaseSpace.set_report">set_report</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.PruneCopasiHeaders">PruneCopasiHeaders</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.PruneCopasiHeaders.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.PruneCopasiHeaders.prune">prune</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.Reports">Reports</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.Reports.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.Reports.clear_all_reports">clear_all_reports</a></li>
    <li class="mono"><a href="#pycopi.Reports.parameter_estimation_broken">parameter_estimation_broken</a></li>
    <li class="mono"><a href="#pycopi.Reports.parameter_estimation_with_function_evaluations">parameter_estimation_with_function_evaluations</a></li>
    <li class="mono"><a href="#pycopi.Reports.profile_likelihood">profile_likelihood</a></li>
    <li class="mono"><a href="#pycopi.Reports.remove_report">remove_report</a></li>
    <li class="mono"><a href="#pycopi.Reports.run">run</a></li>
    <li class="mono"><a href="#pycopi.Reports.save">save</a></li>
    <li class="mono"><a href="#pycopi.Reports.timecourse">timecourse</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.Run">Run</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.Run.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.Run.multi_run">multi_run</a></li>
    <li class="mono"><a href="#pycopi.Run.run">run</a></li>
    <li class="mono"><a href="#pycopi.Run.save">save</a></li>
    <li class="mono"><a href="#pycopi.Run.set_task">set_task</a></li>
    <li class="mono"><a href="#pycopi.Run.submit_copasi_job_SGE">submit_copasi_job_SGE</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.Scan">Scan</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.Scan.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.Scan.create_scan">create_scan</a></li>
    <li class="mono"><a href="#pycopi.Scan.define_report">define_report</a></li>
    <li class="mono"><a href="#pycopi.Scan.get_report_key">get_report_key</a></li>
    <li class="mono"><a href="#pycopi.Scan.remove_scans">remove_scans</a></li>
    <li class="mono"><a href="#pycopi.Scan.run">run</a></li>
    <li class="mono"><a href="#pycopi.Scan.save">save</a></li>
    <li class="mono"><a href="#pycopi.Scan.set_scan_options">set_scan_options</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#pycopi.TimeCourse">TimeCourse</a></span>
        
          
  <ul>
    <li class="mono"><a href="#pycopi.TimeCourse.__init__">__init__</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.get_report_key">get_report_key</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.plot">plot</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.read_sim_data">read_sim_data</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.report_definition">report_definition</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.run">run</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.save">save</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.set_deterministic">set_deterministic</a></li>
    <li class="mono"><a href="#pycopi.TimeCourse.set_report">set_report</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">pycopi</span> module</h1>
  <p>This file is part of PyCoTools.</p>
<p>PyCoTools is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>PyCoTools is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public License
along with PyCoTools.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>This file is intended to provide a COPASI user an alternative to 
using the official python-copasi API. At present support is 
provided for:
    -running time courses
    -performing parameter estimation
    -performing parameter scans
    -extracting model variables and quantities
    -creating reports (for parameter estimation, 
    profile likelihood and time course)
    -inserting parameters from file, folder of files, pandas dataframe
    or python dictionary</p>
<p>$Author: Ciaran Welsh
$Date: 12-09-2016 
Time:  13:33</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi', this);">Show source &equiv;</a></p>
  <div id="source-pycopi" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> This file is part of PyCoTools.</span>

<span class="sd"> PyCoTools is free software: you can redistribute it and/or modify</span>
<span class="sd"> it under the terms of the GNU Lesser General Public License as published by</span>
<span class="sd"> the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd"> (at your option) any later version.</span>

<span class="sd"> PyCoTools is distributed in the hope that it will be useful,</span>
<span class="sd"> but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd"> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd"> GNU Lesser General Public License for more details.</span>

<span class="sd"> You should have received a copy of the GNU Lesser General Public License</span>
<span class="sd"> along with PyCoTools.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>


<span class="sd"> This file is intended to provide a COPASI user an alternative to </span>
<span class="sd"> using the official python-copasi API. At present support is </span>
<span class="sd"> provided for:</span>
<span class="sd">     -running time courses</span>
<span class="sd">     -performing parameter estimation</span>
<span class="sd">     -performing parameter scans</span>
<span class="sd">     -extracting model variables and quantities</span>
<span class="sd">     -creating reports (for parameter estimation, </span>
<span class="sd">     profile likelihood and time course)</span>
<span class="sd">     -inserting parameters from file, folder of files, pandas dataframe</span>
<span class="sd">     or python dictionary</span>
<span class="sd">     </span>


<span class="sd"> $Author: Ciaran Welsh</span>
<span class="sd"> $Date: 12-09-2016 </span>
<span class="sd"> Time:  13:33</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> 
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">PEAnalysis</span><span class="o">,</span><span class="nn">Errors</span><span class="o">,</span><span class="nn">Misc</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">wrap</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span>  <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>






<span class="c1">#==========================================================================</span>

<span class="k">class</span> <span class="nc">CopasiMLParser</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse a copasi file into xml.etree. </span>
<span class="sd">    </span>
<span class="sd">    Positional arguments:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            A full path to a copasi file</span>
<span class="sd">        </span>
<span class="sd">    Attributes:</span>
<span class="sd">        copasiML=the copasi model parsed into etree</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">FileDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;{} is not a copasi file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_copasiML</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Recently changed this class to use lxml built in functions</span>
<span class="sd">        rather that pythons standard write and read methods. Hopefully this</span>
<span class="sd">        should help some of the performance issues. The below two comments are required for</span>
<span class="sd">        the old class. Keep them commented out until you remove the deprecations fully </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#self.dir=os.path.dirname(self.copasi_file)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">_parse_copasiML_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        deprecated in favor of using etree.parse</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">copasiML_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">copasiML_str</span><span class="p">)</span>
        


    <span class="k">def</span> <span class="nf">write_copasi_file_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Often you need to delete a copasi file and rewrite it</span>
<span class="sd">        directly from the string. This function does this.</span>
<span class="sd">        </span>
<span class="sd">        copasi_filename = a valid .cps file</span>
<span class="sd">        copasiML = an xml string. Convert to xml string</span>
<span class="sd">        before using this function using etree.fromstring(xml_string)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">copasiML</span><span class="p">,</span><span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>    
            
    <span class="k">def</span> <span class="nf">_parse_copasiML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parse xml doc with lxml </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        write to file with lxml write function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">##first convert the copasiML to a root element tree</span>
        <span class="n">root</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
            
<span class="c1">#==============================================================================</span>

<span class="k">class</span> <span class="nc">GetModelQuantities</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Positional arguments:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            Full path to copasi file</span>
<span class="sd">            </span>
<span class="sd">    keywords:</span>
<span class="sd">        Quantitytype:</span>
<span class="sd">            either &#39;concentration&#39; (default) or &#39;particle_numbers&#39;. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">QuantityType</span><span class="o">=</span><span class="s1">&#39;concentration&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">=</span><span class="n">QuantityType</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span>
                
<span class="c1">#        self.all_params=self.get_global_quantities_cns().keys()+self.get_IC_cns().keys()+self.get_local_kinetic_parameters_cns().keys()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">convert_particles_to_molar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">particles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span><span class="c1">#,vol_unit):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts particle numbers to Molarity. </span>
<span class="sd">        particles=number of particles you want to convert</span>
<span class="sd">        mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
            <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
            <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span>
        <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
        <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
        <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span>
            <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">molarity</span><span class="p">,</span><span class="mi">33</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">convert_molar_to_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">moles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts particle numbers to Molarity. </span>
<span class="sd">        particles=number of particles you want to convert</span>
<span class="sd">        mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compartment_volume</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;compartment_volume is the volume of the compartment for species and must be either a float or a int&#39;</span><span class="p">)</span>

        <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
            <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
            <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
        <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
        <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span><span class="o">*</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="c1"># or &#39;#&#39;:</span>
            <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">particles</span>        

    <span class="k">def</span> <span class="nf">get_quantity_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get model quantity units (nM for example)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">quantity_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;quantityUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">quantity_unit</span>
        
    <span class="k">def</span> <span class="nf">get_volume_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model volume units. ml for example</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">vol_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;volumeUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vol_unit</span>
        
    <span class="k">def</span> <span class="nf">get_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model time units</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">time_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;timeUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">time_unit</span>
        
    <span class="k">def</span> <span class="nf">check_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Non-ascii characters are not currently supported. </span>
<span class="sd">        Check for non-ascii characters</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">()</span><span class="o">.</span><span class="n">is_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39;Your model name contains non-ascii characters which are not currently supported by PyCoTools.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>
        
    <span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">name</span>     
        
        


    <span class="k">def</span> <span class="nf">get_model_name_cn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get reference to model name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">first</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">string</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">first</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
        <span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Model=(.*),Vector=C&#39;</span><span class="p">,</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">get_metabolites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deprecated. Use get_ICs_cns() inst</span>
<span class="sd">        returns dict of metabolites in the &#39;species&#39; menu</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metab_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Vector=Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                                
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compartment_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\],&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                    
                    <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                        <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">{}</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="n">concentration</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">concentration</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">compartment_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metab_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">NoMetabolitesError</span><span class="p">(</span><span class="s1">&#39;There are no metabolites in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_name</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">metab_dct</span>
        

    <span class="k">def</span> <span class="nf">get_global_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a dict of global quantities</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
        <span class="n">model_val_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model_val_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">model_val_dct</span>
<span class="c1">#        </span>
                        
    <span class="k">def</span> <span class="nf">get_local_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return dict of local parameters used in your model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                            <span class="k">return</span> <span class="bp">False</span>
                        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">get_compartments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a dict of compartments in your model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Compartment Sizes&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>
        
        
    <span class="k">def</span> <span class="nf">compartment_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metab</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        metab=a single metabolite dict from the get_metabolites method</span>
<span class="sd">        look metab up in the compartment definitions </span>
<span class="sd">        and get the name corresponding to it&#39;s key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">m_comp</span><span class="o">=</span> <span class="n">metab</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span> <span class="n">m_comp</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  

    <span class="k">def</span> <span class="nf">get_IC_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for initial condition parameters. </span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} is not a string but a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>  
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
                <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">molar</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">molar</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">compartment_vol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
        
        
    <span class="k">def</span> <span class="nf">get_global_quantities_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for global kinetic parameters. </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} should be a string but is instead a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">get_local_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for local kinetic parameters. </span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">get_global_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for global parameters that are used as</span>
<span class="sd">        kinetic parameters. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return all parameters that are present in the fit items of the</span>
<span class="sd">        parameter estimation task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
        <span class="k">return</span> <span class="n">d</span>
        

    <span class="k">def</span> <span class="nf">get_all_model_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        concatonate the output of the three functions that give model variables</span>
<span class="sd">        Return list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">l</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        <span class="n">p</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="o">**</span><span class="n">g</span><span class="p">)</span>
        <span class="n">p</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">p</span>
        
    <span class="k">def</span> <span class="nf">get_experiment_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get any parameter estimation data files that are defined </span>
<span class="sd">        within copasi parameter estimation task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;File Name&quot;]&#39;</span>
        <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">files</span>
        
    <span class="k">def</span> <span class="nf">get_all_params_dict_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">        global and IC parameters in copasi_file</span>
<span class="sd">        </span>
<span class="sd">        Use get_all_model_variables</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            now format the local parameters</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">var_dct</span>
        
        
    <span class="k">def</span> <span class="nf">get_all_params_dict_deprecated2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">        global and IC parameters in copasi_file</span>
<span class="sd">        </span>
<span class="sd">        get_all_model_variables</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            now format the local parameters</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">var_dct</span>

<span class="c1">#==============================================================================</span>

<span class="k">class</span> <span class="nc">Reports</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates reports in copasi output specification section. </span>
<span class="sd">    Use: </span>
<span class="sd">        -the ReportType kwarg to specify which type of report you want to make</span>
<span class="sd">        -the Metabolites and GlobalQuantities kwargs to specify which parameters</span>
<span class="sd">        to include</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            The copasi file you want to add a report too</span>
<span class="sd">        </span>
<span class="sd">    **kwargs:</span>

<span class="sd">        ReportType: </span>
<span class="sd">            Which report to write. Options:</span>
<span class="sd">                profilelikleihood:</span>
<span class="sd">                    - for Pydentify, shouldn&#39;t need to manually touch this</span>
<span class="sd">                time_course:</span>
<span class="sd">                    -a table of time Vs concentrations. Included values are specified to the Metabolites and//or GlobalQuantities arguments</span>
<span class="sd">            parameter_estimation:</span>
<span class="sd">                    -a table of values from a parameter estimation and the residual sum of squares value for each run. </span>

<span class="sd">    </span>
<span class="sd">        Metabolites:</span>
<span class="sd">            A list of valid model metabolites you want to include in the report. Default=All metabolites</span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities;</span>
<span class="sd">            List of valid global quantities that you want to include in the report. Default=All global variables</span>
<span class="sd">        </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            Either &#39;concentration&#39; or &#39;particle_number&#39;. Switch between having report output in either concentration of in particle_numbers. </span>

<span class="sd">        ReportName:</span>
<span class="sd">            Name of the report. Default depends on kwarg ReportType</span>
<span class="sd">        </span>
<span class="sd">        Append: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Append to report. Default &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        ConfirmOverwrite: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;.  Default= &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        Save: </span>
<span class="sd">            either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;. </span>
<span class="sd">            false: don&#39;t write to file</span>
<span class="sd">            overwrite: overwrite copasi_file</span>
<span class="sd">            duplicate: write a new file named using the kwarg OutputML</span>
<span class="sd">        </span>
<span class="sd">        OutputML: </span>
<span class="sd">            When Save set to &#39;duplicate&#39;, this is the name of the file</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        Variable: </span>
<span class="sd">            When ReportType is profilelikelihood, theta is the parameter of interest</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
<span class="c1">#        default_report_name=os.path.split(self.copasi_file)[1][:-4]+&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                 <span class="c1">#</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#only for profile_likelihood</span>
        
                 <span class="p">}</span>
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Reports&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                 
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;valid report types include {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
        
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>     
        
        <span class="n">quantity_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_types</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_profilelikelihood.txt&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_time_course.txt&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_parameter_estimation.txt&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_all_reports</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">timecourse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        creates a report to collect time course results. </span>
<span class="sd">        </span>
<span class="sd">        By default all species and all global quantities are used with </span>
<span class="sd">        Time on the left most column. This behavior can be overwritten by passing</span>
<span class="sd">        lists of metabolites to the Metabolites keyword or global quantities to the</span>
<span class="sd">        global quantities keyword</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>              
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_30&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Objects for the report to report</span>
        <span class="n">time</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="c1">#first element always time. </span>
        <span class="n">time</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;CN=Root,Model={},Reference=Time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_model_name_cn</span><span class="p">())</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generate more SubElements dynamically</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=ParticleNumber&#39;</span>
            <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">profile_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create report of a parameter and best value for a parameter estimation </span>
<span class="sd">        for profile likelihoods</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_31&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Scan&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">})</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        

    <span class="k">def</span> <span class="nf">parameter_estimation_with_function_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define a parameter estimation report and include the progression </span>
<span class="sd">        of the parameter estimation (function evaluations).</span>
<span class="sd">        Defaults to including all</span>
<span class="sd">        metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">        These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">        keywords. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_32&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Objects for the report to report</span>
<span class="c1">#        time=etree.SubElement(table,&#39;Object&#39;)</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generate more SubElements dynamically</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
            <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
                
        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
                
                
        <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     


    <span class="k">def</span> <span class="nf">parameter_estimation_broken</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        IMPORTANT</span>
<span class="sd">        THIS FUNCTION GIVES THE ORIGINAL PARAMETER VALUES</span>
<span class="sd">        NOT THE RESULTS OF THE PARAMTEER ESTIMATION</span>
<span class="sd">        </span>
<span class="sd">        Define a parameter estimation report. Defaults to including all</span>
<span class="sd">        metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">        These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">        keywords</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_33&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
<span class="c1">#        </span>
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Header&#39;</span><span class="p">)</span>
        <span class="n">body</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Body&#39;</span><span class="p">)</span>
        <span class="n">footer</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Footer&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_sep</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">),</span><span class="s1">&#39;parent element needs to be an etree element&#39;</span>
            <span class="n">sep</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span><span class="c1">#,attrib={&#39;cn&#39;:&#39;Separator={}&#39;.format()})   </span>
            <span class="n">sep</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Separator={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sep</span>
        
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration,Property=DisplayName&#39;</span>
                    <span class="n">foot_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber,Property=DisplayName&#39;</span>
                    <span class="n">foot_cn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
                
                <span class="c1">#add to xml</span>
                <span class="c1">#header</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">head_cn</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="c1">#footer    </span>
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">foot_cn</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue,Property=DisplayName&#39;</span>
                <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>


                <span class="c1">#add to xml</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                
                
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
                
                
        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
                <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value,Property=DisplayName&#39;</span>
                <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>


                <span class="c1">#add to xml</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
<span class="c1">#                </span>
        <span class="n">best_value_header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">best_value_header</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value,Property=DisplayName&quot;</span>
        <span class="n">best_value_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">best_value_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     
        
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Execute code that builds the report defined by the kwargs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_estimation_with_function_evaluations</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_likelihood</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timecourse</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">report_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove report called report_name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">report_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} not a valid report type. These are valid report types: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">report_name</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
                <span class="n">report_name</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">report_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">clear_all_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Having multile reports defined at once can be really annoying</span>
<span class="sd">        and give you unexpected results. Use this function to remove all reports</span>
<span class="sd">        before defining a new one to ensure you only have one active report any once. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        

<span class="c1">#==============================================================================</span>
<span class="k">class</span> <span class="nc">ParsePEDataDeprecated</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deprecated on 28-01-2017. Keep until you know it </span>
<span class="sd">    wont mess up the rest of your code. </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    parse parameter estimation data from file</span>
<span class="sd">    </span>
<span class="sd">    Positional args:</span>
<span class="sd">        results_path:</span>
<span class="sd">            Full path to a results file or folder of files containing </span>
<span class="sd">            parameter estimation results</span>
<span class="sd">            </span>
<span class="sd">    NOTE: this class is functional but will be replaced by PEAnalysis.ParsePEData</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">results_path</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="o">=</span><span class="n">results_path</span> <span class="c1">#either file or folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData.pickle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path_log</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData_log.pickle&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span>
                 <span class="s1">&#39;FromPickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                 <span class="s1">&#39;OverwritePickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>   
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span> <span class="n">options</span>
        
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;folder&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
            
        
        <span class="c1">#main methods of class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_copasi_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        

      
    <span class="k">def</span> <span class="nf">remove_copasi_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the PruneCopasiHeaders class to truncate copasi style formatting </span>
<span class="sd">        conventions        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#We minus 1 to account for not counting the parameter estimation header 3 lines down</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span><span class="p">:</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">df</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">read_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        read folder of tab separated csv files i.e. the output from copasi</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} is not a real directory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="n">df_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change the RSS from copasi output to RSS</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">b</span><span class="o">=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">b</span><span class="p">:</span><span class="s1">&#39;RSS&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">data</span>

        
    <span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        sort data in order of increasing RSS</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

        
    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;mode not file&#39;</span>
        <span class="n">_</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.xls&#39;</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">],</span><span class="s1">&#39;parameter file is not .txt, .xlsx, .xls, .csv&#39;</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;xlsx&#39;</span> <span class="ow">or</span> <span class="s1">&#39;xls&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>     
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
                
            
    <span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">),</span><span class="s1">&#39;pickle path does</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
            
    
    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_folder</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>
                        


<span class="c1">#==============================================================================            </span>
<span class="k">class</span> <span class="nc">ExperimentMapper</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to map variables from a parameter estimation item template which </span>
<span class="sd">    is written using the ParameterEstimation.Write_item_template method, to model </span>
<span class="sd">    variables. Variable names must match exactly. You cannot have more than </span>
<span class="sd">    1 species with the same name, regardless of compartment. Generally</span>
<span class="sd">    this class is used within the parameter estimation class so the user doesn&#39;t</span>
<span class="sd">    need to bother with it.      </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file: </span>
<span class="sd">            Copasi file path </span>
<span class="sd">        experiment_files:</span>
<span class="sd">            list of experiment file paths</span>
<span class="sd">            </span>
<span class="sd">    See documentation for ParameterEstimation for</span>
<span class="sd">    details on each keyword argument</span>
<span class="sd">    </span>
<span class="sd">    kwargs:</span>
<span class="sd">        RowOrientation</span>
<span class="sd">        </span>
<span class="sd">        ExperimentType</span>
<span class="sd">        </span>
<span class="sd">        FirstRow</span>
<span class="sd">        </span>
<span class="sd">        NormalizeWeightsPerExperiment</span>
<span class="sd">        </span>
<span class="sd">        RowContainingNames</span>
<span class="sd">        </span>
<span class="sd">        Separator</span>
<span class="sd">        </span>
<span class="sd">        WeightMethod</span>
<span class="sd">        </span>
<span class="sd">        Save</span>
<span class="sd">        </span>
<span class="sd">        OutputML        </span>
<span class="sd">             </span>
<span class="sd">                 </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>

        <span class="n">options</span><span class="o">=</span><span class="p">{</span>    
                 <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span> <span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">}</span>
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>

        <span class="c1">#assign numberic values to WeightMethod   </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">))):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">,</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">,</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
        
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">))):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;steadystate&#39;</span><span class="p">,</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;steadystate&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span> 
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
        
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">],</span><span class="s1">&#39;{} should be true or false&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

                
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>        


        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;separator should be given asa python list&#39;</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">]</span>
        
        <span class="c1">#run the experiment mapper        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_experiments</span><span class="p">()</span>
        
        <span class="c1">#save the copasi file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">get_existing_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">existing_experiment_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">existing_experiment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">existing_experiment_list</span>

    <span class="k">def</span> <span class="nf">remove_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        name attribute of experiment. usually Experiment_1 or something</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">experiment_name</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_all_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_existing_experiments</span><span class="p">():</span>
            <span class="n">experiment_name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    
    <span class="k">def</span> <span class="nf">create_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a single experiment set to the parameter estimation task</span>
<span class="sd">        exp_file is an experiment filename with exactly matching headers (independent variablies need &#39;_indep&#39; appended to the end)</span>
<span class="sd">        since this method is intended to be used in a loop in another function to </span>
<span class="sd">        deal with all experiment sets, the second argument &#39;i&#39; is the index for the current experiment</span>
<span class="sd">        </span>
<span class="sd">        i is the exeriment_file index        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1">#get observables from data. Must be exact match        </span>
        <span class="n">obs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        
        <span class="c1">#prune any observables that are contained within square brackets (like the outout from copasu)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">!=</span><span class="p">[]:</span>
                <span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_rows</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">num_columns</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#plus 1 to account for 0 indexed</span>
        
        
        <span class="c1">#if exp_file is in the same directory as copasi_file only use relative path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">exp</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                
<span class="c1">#        key_value= len(self.get_existing_experiments())+1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Experiment_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#necessary XML attributes</span>
        <span class="n">Exp</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">})</span>
        
        <span class="n">RowOrientation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Data is Row Oriented&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">ExperimentType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Experiment Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">ExpFile</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;File Name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="p">}</span>
        <span class="n">FirstRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;First Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">}</span>
        <span class="n">LastRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Last Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span> <span class="c1">#add 1 to account for 0 indexed python </span>
        <span class="n">NormalizeWeightsPerExperiment</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Normalize Weights per Experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">NumberOfColumns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Columns&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">num_columns</span><span class="p">}</span>
        <span class="n">ObjectMap</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object Map&#39;</span><span class="p">}</span>
        <span class="n">RowContainingNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Row containing Names&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">Separator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Separator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">WeightMethod</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weight Method&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>

        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowOrientation</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExperimentType</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExpFile</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">FirstRow</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Key</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">LastRow</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NormalizeWeightsPerExperiment</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfColumns</span><span class="p">)</span>
        <span class="n">Map</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ObjectMap</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowContainingNames</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Separator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">WeightMethod</span><span class="p">)</span>
        
        <span class="c1">#get handle to the cn&#39;s</span>
        <span class="n">ICs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        
        <span class="c1">#define object role attributes</span>
        <span class="n">TimeRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
        <span class="n">DepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span>
        <span class="n">IndepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_columns</span><span class="p">)):</span>
            <span class="n">map_group</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Map</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#when Experiment type is set to time course it should be 1</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">TimeRole</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                    Need to duplicate the below block for ease. Could be more sophisticated </span>
<span class="sd">                    but this is less effort. </span>
<span class="sd">                    &#39;&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                            <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                            
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                            <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>
    
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                            <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                            
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                            Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                            out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                            &#39;&#39;&#39;</span>
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Region of duplicated code</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                        <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                        <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                        <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                        Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                        out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                        &#39;&#39;&#39;</span>
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>
            

        <span class="k">return</span> <span class="n">Exp</span>

    <span class="k">def</span> <span class="nf">add_experiment_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">map_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_experiments</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)):</span>
            <span class="n">Experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_experiment_set</span><span class="p">(</span><span class="n">Experiment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        


<span class="c1">#==============================================================================</span>
<span class="k">class</span> <span class="nc">TimeCourse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a time course using Copasi. Ensure, you specify the corrent amount</span>
<span class="sd">    of time you want simulating. Do this by ensuring that End=StepSize*Intervals.</span>
<span class="sd">    Set Plot=&#39;true&#39; to automatically plot the results which can be found in a file</span>
<span class="sd">    in the same directory as your copasi file in a folder named after your ReportName</span>
<span class="sd">    kwarg</span>
<span class="sd">    </span>
<span class="sd">    NOTE: Space has been left for addition of code to interface with the other</span>
<span class="sd">    copasi solvers. Currently only deterministic is supported. </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file - the copasi file you want to do a time course on </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    **kwargs:</span>
<span class="sd">        For arguments related to plotting, see the documentation for Plot</span>
<span class="sd">        </span>
<span class="sd">        Intervals:</span>
<span class="sd">            How many intervals between start and end. Default=100</span>
<span class="sd">        </span>
<span class="sd">        StepSize:</span>
<span class="sd">            How big each time increment is. Default=&#39;0.01&#39;,</span>
<span class="sd">        </span>
<span class="sd">        Start: </span>
<span class="sd">            Starting point of stimulation. Default=0.0</span>
<span class="sd">        </span>
<span class="sd">        End: </span>
<span class="sd">            The end point of the time course. Default=1.</span>
<span class="sd">        </span>
<span class="sd">        #integration options</span>
<span class="sd">        RelativeTolerance: </span>
<span class="sd">            Default=&#39;1e-6&#39;,</span>
<span class="sd">        </span>
<span class="sd">        AbsoluteTolerance:</span>
<span class="sd">            Default=&#39;1e-12&#39;,</span>
<span class="sd">        </span>
<span class="sd">        MaxInternalSteps:</span>
<span class="sd">            Default=&#39;10000&#39;,</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Not really needed in time course. Do not change. Default=&#39;false&#39;</span>

<span class="sd">        Metabolites:</span>
<span class="sd">            A list of which metabolites to include in output. Default=all</span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities: </span>
<span class="sd">            A list of global quantities to include in the output. Default is all global quantities</span>

<span class="sd">        QuantityType: </span>
<span class="sd">            Either &#39;particle_numbers&#39; or &#39;concentration&#39;,</span>

<span class="sd">        ReportName: </span>
<span class="sd">            Name of the output report. Default is name of the copasi file with _TimeCourse appended&#39;</span>

<span class="sd">        Append: </span>
<span class="sd">            Append to the report, &#39;true&#39; or &#39;false&#39; , default=&#39;false&#39;</span>

<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            Report confirm overwrite , &#39;true&#39; or &#39;false&#39; , default=&#39;false&#39;</span>

<span class="sd">        SimulationType: </span>
<span class="sd">            Either &#39;stochastic&#39; or &#39;deterministic&#39;. default=&#39;deterministic&#39;. IMPORTANT: stochastic not yet implemented but there is room for it</span>

<span class="sd">        OutputEvent: </span>
<span class="sd">            Output event or not, default =&#39;false&#39;</span>

<span class="sd">        Scheduled: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Enables running the simulation by CopasiSE. Default=&#39;true&#39;,</span>

<span class="sd">        Save: </span>
<span class="sd">            Save the copasi file with the changes. Either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;</span>
<span class="sd">        </span>
<span class="sd">        PruneHeaders:</span>
<span class="sd">            Copasi automatically prints out copasi references to output files. Set</span>
<span class="sd">            this to &#39;true&#39; to  prune the references off leaving just the variable name,</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, default=&#39;true&#39;</span>
<span class="sd">        </span>
<span class="sd">        #graph options</span>
<span class="sd">        Plot:</span>
<span class="sd">            Whether to plot the graphs or not</span>
<span class="sd">            </span>
<span class="sd">        SaveFig:</span>
<span class="sd">            Whether to save the figures to file or not</span>
<span class="sd">            </span>
<span class="sd">        ExtraTitle:</span>
<span class="sd">            If SaveFig=&#39;true&#39;,give the filename an extra identifier</span>
<span class="sd">            </span>
<span class="sd">        LineWidth:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Thickness of the line</span>

<span class="sd">        LineColor:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Color of the line</span>

<span class="sd">        MarkerColor:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. color of the dots</span>

<span class="sd">        LineStyle:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Style of line</span>

<span class="sd">        MarkerStyle:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Style of marker</span>

<span class="sd">        DPI:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. </span>
<span class="sd">            </span>
<span class="sd">        XTickRotation:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Rotate x labels</span>
<span class="sd">            </span>
<span class="sd">        TitleWrapSize:</span>
<span class="sd">            Number of characters before word wrapping the title</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_TimeCourse.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>

        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Intervals&#39;</span><span class="p">:</span><span class="s1">&#39;100&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;StepSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.01&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;End&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-6&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-12&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span><span class="s1">&#39;10000&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Start&#39;</span><span class="p">:</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
<span class="c1">#                 &#39;target&#39;: &#39;cheese.txt&#39;, </span>
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SimulationType&#39;</span><span class="p">:</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputEvent&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 
                 <span class="c1">#graph options</span>
                 <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span>      <span class="p">,</span>              
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                 <span class="s1">&#39;LineColor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerColor&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LineStyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerStyle&#39;</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                 <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
                 <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                 <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerSize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;GraphDirectory&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 

                     <span class="p">}</span>
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1">#            kwargs[i]=str(kwargs[i]).lower()</span>
<span class="c1">#            assert isinstance(kwargs[i],str),&#39;all optional arguments passed shold be lower case strings&#39;</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if the below three kwargs are a single entry they can be a string. </span>
<span class="sd">        In this case, put them back into a list to ensure a smooth ride</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>


        
        <span class="c1">#Ensure consistecny for time variables</span>
        <span class="k">assert</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)),</span><span class="s1">&#39;End should equal Interval Size times Number of Intervals but {}!={}*{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>        

        <span class="c1">#make sure Metabolites and ModelValues are lists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument Metabolites should be a Python list&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a Metabolite in this model. These are Metabolites in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument GlobalQuantities should be a Python list&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a global variable in this model. These are global variables in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">())</span>
            
        <span class="c1">#only accept deterministic or stochastic</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span><span class="s1">&#39;stochastic&#39;</span><span class="p">]</span>

<span class="c1">#</span>
        
        <span class="c1">#this bit of code helps keep the keyword arguments consistant</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
            
        <span class="c1">#report arguments</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;PruneHeaders kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Append kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;OutputEvent kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Scheduled kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Plot kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        
        <span class="c1">#convert some numeric kwargs to str</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Intervals&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StepSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;End&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">float</span><span class="p">)</span>
                 
                 
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">)</span> <span class="ow">in</span>   <span class="p">[</span><span class="s1">&#39;-&#39;</span> <span class="p">,</span> <span class="s1">&#39;--&#39;</span> <span class="p">,</span> <span class="s1">&#39;-.&#39;</span> <span class="p">,</span> <span class="s1">&#39;:&#39;</span> <span class="p">,</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">),</span><span class="s1">&#39;{} is not int&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)))</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerStyle&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>

        <span class="n">color_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">}</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                 
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="o">=</span><span class="p">{}</span><span class="c1">#report variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="c1">#self.kwargs.get(&#39;ReportType&#39;)</span>
        
        <span class="c1">#other keywords that are non optional for time course</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)})</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        All methods required for time course are </span>
<span class="sd">        called with run</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_sim_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
        
    <span class="k">def</span> <span class="nf">set_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set parameters for deterministic timecourse</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
        <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic(LSODA)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic (LSODA)&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="c1">#make available to coapsiSE</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Duration&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">)</span>
                        
                    <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepNumber&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)</span>
                        
                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepSize&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TimeSeriesRequested&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>                        

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;OutputStartTime&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output Event&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Continue on Simultaneous Events&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Integrate Reduced Model&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Relative Tolerance&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Absolute Tolerance&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">report_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        cros reference the timecourse task with the newly created</span>
<span class="sd">        time course reort to get the key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span><span class="p">,</span><span class="s1">&#39;have you ran the report_definition method?&#39;</span>
        <span class="k">return</span> <span class="n">key</span>
                
    <span class="k">def</span> <span class="nf">set_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the report defined in self.create_report to tell copasi </span>
<span class="sd">        were to put the results</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">()</span>
        
        <span class="n">arg_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
                 <span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> 
                 <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
        <span class="n">present</span><span class="o">=</span><span class="bp">False</span>
<span class="c1">#        query=&#39;//Report&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">and</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">present</span><span class="o">=</span><span class="bp">True</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg_dct</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">present</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">arg_dct</span><span class="p">)</span>
                <span class="n">i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">report</span><span class="p">)</span>
<span class="c1">#        self.save()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Run a time course. Use keyword argument:</span>
<span class="sd">            SimulationType=&#39;deterministic&#39; #default</span>
<span class="sd">            SumulationType=&#39;stochastic&#39; #still to be written</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;deterministic&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_report</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_deterministic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;stochastic&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;There is space in this class to write code to run a stochastic simulation but it is not yet written&#39;</span>
        <span class="c1">#save to duplicate copasi file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)]</span>
            
        <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">R</span>

        
    <span class="k">def</span> <span class="nf">read_sim_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data_output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">])</span>
        <span class="c1">#trim copasi style headers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> 
        
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">## Create directory for graphs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GraphDirectory&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;TimeCourseGraphs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                         <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
<span class="c1">#                plt.plot(self.data[&#39;Time&#39;],self.data[i],color=self.kwargs.get(&#39;MarkerColor&#39;),marker=self.kwargs.get(&#39;MarkerStyle&#39;))</span>

                
                <span class="c1">#plot labels</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;Time-Course for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration (micromol)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Particle Numbers&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                        
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_time_unit</span><span class="p">()),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
                    
               <span class="c1">#pretty stuff</span>
        
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="c1">#xtick rotation</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
                
                <span class="c1">#options for changing the plot axis</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
        
                <span class="k">def</span> <span class="nf">save_plot</span><span class="p">():</span>
                    <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                                <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
                        <span class="k">return</span> <span class="n">st</span>
                        
                    <span class="n">filename</span><span class="o">=</span><span class="p">{}</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dire</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
                    <span class="k">return</span> <span class="n">filename</span>
        
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    
                <span class="c1">#save figure options</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
                    <span class="n">save_plot</span><span class="p">()</span>
                    
<span class="k">class</span> <span class="nc">PhaseSpace</span><span class="p">(</span><span class="n">TimeCourse</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inherits from TimeCourse</span>
<span class="sd">    </span>
<span class="sd">    Use TimeCourse to get data and replot all n choose 2 combinations</span>
<span class="sd">    of phase space plot</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PhaseSpacePlots</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isolate_species</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_combinations</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">make_phase_dir</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_all_phase</span><span class="p">()</span>
        
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        
            
    <span class="k">def</span> <span class="nf">isolate_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Isolate the species from the time course data </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metabs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metabs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39; {} is an incompatible string that is not supported by PyCoTools. Please modify the string and rerun&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">metabs</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">get_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">make_phase_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;PhasePlots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dire</span>
        
        
    <span class="k">def</span> <span class="nf">plot1phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            
        <span class="k">if</span> <span class="n">y</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
               
        <span class="n">x_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">y_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
                    
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;{} Vs {} Phase Plot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
        <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
            
            
        <span class="c1">#pretty stuff</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
            <span class="c1">#xtick rotation</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
            
        <span class="c1">#options for changing the plot axis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
            <span class="k">return</span> <span class="n">st</span>    
            
        <span class="n">y_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;{}_Vs_{}_PhasePlot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
    <span class="k">def</span> <span class="nf">plot_all_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot1phase</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#                                </span>
            
            
<span class="c1">#==============================================================================</span>
<span class="k">class</span> <span class="nc">ParameterEstimation</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set up and run a parameter estimation in copasi. Since each parameter estimation</span>
<span class="sd">    problem is different, this process cannot be done in a single line of code. </span>
<span class="sd">    Instead the user should initialize an instance of the ParameterEstimation </span>
<span class="sd">    class with all the relevant keyword arguments. Subsequently use the </span>
<span class="sd">    write_item_template() method and modify the resulting xlsx in your copasi file</span>
<span class="sd">    directory. Save the file then close and run the set_up() method to define your</span>
<span class="sd">    optimization problem. When Run is set to &#39;true&#39;, the parameter estimation will</span>
<span class="sd">    automatically run in CopasiSE. If Plot is also set to &#39;true&#39;, a plot comparing </span>
<span class="sd">    experimental and simulated profiles are produced. Profiles are saved</span>
<span class="sd">    to file with SaveFig=&#39;true&#39;</span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        </span>
<span class="sd">        copasi_file: </span>
<span class="sd">            The file path for the copasi file you want to perform parameter estimation on</span>
<span class="sd">            </span>
<span class="sd">        experiment_files:</span>
<span class="sd">            Either a single experiment file path or a list of experiment file paths </span>
<span class="sd">            </span>
<span class="sd">    **Kwargs:</span>
<span class="sd">        </span>
<span class="sd">        Metabolites:</span>
<span class="sd">            Which metabolites (ICs) to include in parameter esitmation. Default = all of them. </span>
<span class="sd">            </span>
<span class="sd">        GlobalQuantities:</span>
<span class="sd">            Which global values to include in the parameter estimation. Default= all</span>
<span class="sd">        </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            either &#39;concentration&#39; or particle numbers</span>

<span class="sd">        ReportName:</span>
<span class="sd">            name of the output report</span>
<span class="sd">            </span>
<span class="sd">        Append:</span>
<span class="sd">            Append to report or not,&#39;true&#39; or &#39;false&#39;</span>

<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, overwrite report or not</span>
<span class="sd">            </span>
<span class="sd">        ItemTemplateFilename:</span>
<span class="sd">            Filename for the fitItem template</span>
<span class="sd">            </span>
<span class="sd">        OverwriteItemTemplate:,</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, overwrite the template each time program is run</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Update model parameters after parameter estimation</span>

<span class="sd">        RandomizeStartValues:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the randomize start values box or not. Default &#39;true&#39;</span>

<span class="sd">        CreateParameterSets:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the create parameter sets box or not. Default &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        CalculateStatistics&#39;:str(1),</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the calcualte statistics box or not. Default &#39;false&#39;</span>

<span class="sd">        Method:</span>
<span class="sd">            Name of one of the copasi parameter estimation algorithms. Valid arguments: </span>
<span class="sd">            [&#39;CurrentSolutionStatistics&#39;,&#39;DifferentialEvolution&#39;,&#39;EvolutionaryStrategySR&#39;,&#39;EvolutionaryProgram&#39;,</span>
<span class="sd">             &#39;HookeJeeves&#39;,&#39;LevenbergMarquardt&#39;,&#39;NelderMead&#39;,&#39;ParticleSwarm&#39;,&#39;Praxis&#39;,</span>
<span class="sd">             &#39;RandomSearch&#39;,&#39;ScatterSearch&#39;,&#39;SimulatedAnnealing&#39;,&#39;SteepestDescent&#39;,</span>
<span class="sd">             &#39;TruncatedNewton&#39;,&#39;GeneticAlgorithm&#39;,&#39;GeneticAlgorithmSR&#39;],</span>
<span class="sd">             Default=GeneticAlgorithm</span>

<span class="sd">        NumberOfGenerations:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=200</span>

<span class="sd">        PopulationSize:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        RandomNumberGenerator:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=1</span>

<span class="sd">        Seed:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0</span>

<span class="sd">        Pf:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.475</span>

<span class="sd">        IterationLimit:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        Tolerance:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.00001</span>

<span class="sd">        Rho;</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.2</span>

<span class="sd">        Scale:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=10</span>

<span class="sd">        SwarmSize:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        StdDeviation:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.000001</span>

<span class="sd">        NumberOfIterations:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=100000</span>

<span class="sd">        StartTemperature:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=1</span>

<span class="sd">        CoolingFactor:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.85</span>

<span class="sd">        RowOrientation:</span>
<span class="sd">            1 means data is row oriented, 0 means its column oriented</span>
<span class="sd">                         </span>
<span class="sd">        ExperimentType:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is either &#39;timecourse&#39; or &#39;steady_state&#39; and describes the type of </span>
<span class="sd">            data at that element in the experiment_files argument </span>

<span class="sd">        FirstRow:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is the starting line for data as an integer. Default is a list of 1&#39;s and this</span>
<span class="sd">            rarely needs to be changed.</span>
<span class="sd">            </span>
<span class="sd">        NormalizeWeightsPerExperiment&#39;:[&#39;true&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is &#39;true&#39; or &#39;false&#39; and correlates to ticking the</span>
<span class="sd">            normalize wieghts per experiment box in the copasi gui. Default [true]*len(experiments)</span>
<span class="sd">            </span>
<span class="sd">        RowContainingNames:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is an integer value corresponding to the row in the data containing names. The default</span>
<span class="sd">            is 1 for all experiment files [1]*len(experiment_files)</span>
<span class="sd">                        </span>

<span class="sd">        Separator&#39;:[&#39;\t&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is the separator used in the data files. Defaults to a tab (\\t) for all files </span>
<span class="sd">            though commas are also common</span>
<span class="sd">            </span>
<span class="sd">        WeightMethod&#39;:[&#39;mean_squared&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is a list of the name of the normalization algorithm to use for that data set. </span>
<span class="sd">            This should probably be the same for each experiment file and defaults to mean_squared. </span>
<span class="sd">            Options are: [&#39;mean&#39;,&#39;mean_squared&#39;,&#39;stardard_deviation&#39;,&#39;value_scaling&#39;]</span>
<span class="sd">            </span>
<span class="sd">        Save: </span>
<span class="sd">            One of &#39;false&#39;,&#39;duplicate&#39; or &#39;overwrite&#39;. If duplicate, use the name in </span>
<span class="sd">            the keyword argument OutputML to save the file.</span>

<span class="sd">        OutputML:</span>
<span class="sd">            When Save is set to &#39;duplicate&#39;, this is the new name of the cps file</span>
<span class="sd">        </span>
<span class="sd">        PruneHeaders:</span>
<span class="sd">            Copasi uses references to distinguish between variable types. The report</span>
<span class="sd">            output usually contains these references in variable names. &#39;true&#39; removes </span>
<span class="sd">            the references while &#39;false&#39; leaves them in. </span>
<span class="sd">        Scheduled&#39;:&#39;false&#39;</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the box called &#39;executable&#39; in the top right hand</span>
<span class="sd">            corner of the Copasi GUI. This tells Copasi to shedule a parameter estimation </span>
<span class="sd">            task when using CopasiSE. This should be &#39;true&#39; of you are running a parameter</span>
<span class="sd">            estimation from the parameter estimation task via the pycopi but &#39;false&#39; when you </span>
<span class="sd">            want to set up a repeat item in the scan task with the parameter estimation subtask</span>
<span class="sd">            </span>
<span class="sd">        UseTemplateStartValues:</span>
<span class="sd">            Default set to &#39;false&#39;. Determines whether the starting parameters </span>
<span class="sd">            from within the fitItemTemplate.xlsx are use for starting values</span>
<span class="sd">            in the parameter estimation or not</span>
<span class="sd">                 </span>
<span class="sd">        LowerBound:</span>
<span class="sd">            Value of the default lower bound for the FitItemTemplate. Default 0.000001</span>
<span class="sd">        </span>
<span class="sd">        UpperBound:</span>
<span class="sd">            Value of default upper bound for FitItemTemplate. Default=1000000</span>
<span class="sd">            </span>
<span class="sd">#        Run:</span>
<span class="sd">#            Run the parameter estimation using CopasiSE. When running via the parameter</span>
<span class="sd">#            estimation task, the output is a matrix of function evaluation progression over</span>
<span class="sd">#            time. When running via the scan&#39;s repeat task, output is lines of parameter</span>
<span class="sd">#            estimation runs</span>
<span class="sd">            </span>
<span class="sd">        Plot:</span>
<span class="sd">            Whether to plot result or not. Defualt=&#39;true&#39;</span>
<span class="sd">            </span>
<span class="sd">        FontSize:</span>
<span class="sd">            Control graph label font size</span>

<span class="sd">        AxisSize:</span>
<span class="sd">            Control graph axis font size</span>

<span class="sd">        ExtraTitle:</span>
<span class="sd">            When SaveFig=&#39;true&#39;, given the saved</span>
<span class="sd">            file an extra label in the file path</span>

<span class="sd">        LineWidth:</span>
<span class="sd">            Control graph LineWidth</span>
<span class="sd">            </span>
<span class="sd">        DotSize:</span>
<span class="sd">            How big to plot the dots on the graph</span>

<span class="sd">        SaveFig:</span>
<span class="sd">            Save graphs to file labelled after the index</span>


<span class="sd">        TitleWrapSize:</span>
<span class="sd">            When graph titles are long, how many characters to have per </span>
<span class="sd">            line before word wrap. Default=30. </span>
<span class="sd">            </span>
<span class="sd">        Show:</span>
<span class="sd">            When not using iPython, use Show=&#39;true&#39; to display graphs</span>
<span class="sd">            </span>
<span class="sd">        Ylimit: default==None, restrict amount of data shown on y axis. </span>
<span class="sd">        Useful for honing in on small confidence intervals</span>

<span class="sd">        Xlimit: default==None, restrict amount of data shown on x axis. </span>
<span class="sd">        Useful for honing in on small confidence intervals</span>
<span class="sd">        </span>
<span class="sd">        DPI:</span>
<span class="sd">            How big saved figure should be. Default=125</span>
<span class="sd">        </span>
<span class="sd">        XTickRotation:</span>
<span class="sd">            How many degrees to rotate the X tick labels</span>
<span class="sd">            of the output. Useful if you have very small or large</span>
<span class="sd">            numbers that overlay when plotting. </span>
<span class="sd">            </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;The experiment_files argument needs to be a list&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span>
                                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span><span class="p">)</span>
        <span class="n">item_template_filename</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;fitItemTemplate.xlsx&#39;</span><span class="p">)</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;SetReport&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">:</span><span class="n">item_template_filename</span><span class="p">,</span>
                 <span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="c1">#method options</span>
                 <span class="s1">&#39;Method&#39;</span><span class="p">:</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
                 <span class="c1">#&#39;DifferentialEvolution&#39;,</span>
                 <span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                 <span class="s1">&#39;PopulationSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                 <span class="s1">&#39;Seed&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;Pf&#39;</span><span class="p">:</span><span class="mf">0.475</span><span class="p">,</span>
                 <span class="s1">&#39;IterationLimit&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;Tolerance&#39;</span><span class="p">:</span><span class="mf">0.00001</span><span class="p">,</span>
                 <span class="s1">&#39;Rho&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="s1">&#39;Scale&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;SwarmSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;StdDeviation&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
                 <span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">:</span><span class="mi">100000</span><span class="p">,</span>
                 <span class="s1">&#39;StartTemperature&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                 <span class="s1">&#39;CoolingFactor&#39;</span><span class="p">:</span><span class="mf">0.85</span><span class="p">,</span>
                 <span class="c1">#experiment definition options</span>
                 <span class="c1">#need to include options for defining multiple experimental files at once</span>
                 <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>  
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Verbose&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LowerBound&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
                 <span class="s1">&#39;UpperBound&#39;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">,</span>
<span class="c1">#                 &#39;Run&#39;:&#39;false&#39;,</span>
                 <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                 The below arguments get passed to the parameter</span>
<span class="sd">                 estimation plotting class</span>
<span class="sd">                 &#39;&#39;&#39;</span>
                 
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                 <span class="c1">#graph features</span>
                 <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
                 <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                 <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                 <span class="s1">&#39;Show&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                 <span class="s1">&#39;Ylimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;Xlimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
                 <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                 <span class="s1">&#39;DotSize&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                 <span class="s1">&#39;LegendLoc&#39;</span><span class="p">:</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
                 <span class="p">}</span>
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for ParameterEstimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        <span class="c1">#second dict to separate arguments for the experiment mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        
<span class="c1">#        for i in self.kwargs_experiment.keys():</span>
<span class="c1">#            assert len(self.experiment_files)==len(self.kwargs_experiment.get(i)),&#39;{} is {} and {} is {}&#39;.format(self.experiment_files,len(self.experiment_files),(self.kwargs_experiment.get(i)),len(self.kwargs_experiment.get(i)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="p">,</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="p">,</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;HookeJeeves&#39;</span><span class="p">,</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="p">,</span><span class="s1">&#39;NelderMead&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ParticleSwarm&#39;</span><span class="p">,</span><span class="s1">&#39;Praxis&#39;</span><span class="p">,</span><span class="s1">&#39;RandomSearch&#39;</span><span class="p">,</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="p">,</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;SteepestDescent&#39;</span><span class="p">,</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="p">,</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">],</span><span class="s1">&#39;{} is not a copasi PE Method. Choose one of: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Verbose&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
            
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;currentsolutionstatistics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Cannot run current solution statistics with </span><span class="se">\&#39;</span><span class="s1">RandomizeStartValues</span><span class="se">\&#39;</span><span class="s1"> set to </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="p">)</span>
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>  
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; Argument to the UseTemplateStartValues must be </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> not {}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]))</span>


            
        <span class="c1">#determine which Method to use        </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Current Solution Statistics&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Differential Evolution&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;DifferentialEvolution&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolution Strategy (SRES)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolutionary Programming&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryProgram&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Hooke &amp;amp; Jeeves&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;HookeJeeves&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Levenberg - Marquardt&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;LevenbergMarquardt&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Nelder - Mead&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;NelderMead&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Particle Swarm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ParticleSwarm&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Random Search&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;RandomSearch&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Simulated Annealing&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SimulatedAnnealing&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Steepest Descent&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SteepestDescent&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Truncated Newton&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;TruncatedNewton&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Scatter Search&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ScatterSearch&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithm&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm SR&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span>
    

            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>



        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Seed&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Pf&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Rho&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartValue&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">))</span>
        
        
        <span class="c1">#report specific arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
<span class="c1">#        assert self.kwargs.get(&#39;Run&#39;) in [&#39;true&#39;,&#39;false&#39;]</span>
        
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        PlotPEDataKwargs plotting specific kwargs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;FontSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Show&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DotSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DotSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">clear_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert a number to a string        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#                    d[match2]=j.attrib</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">remove_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_items</span><span class="p">,</span><span class="s1">&#39;{} is not a fit item. These are the fit items: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">all_items</span><span class="p">)</span>
        <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="c1">#locate references</span>
                    <span class="c1">#remove local parameters from PE task</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                                <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                    <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1">#rempve global parameters from PE task </span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Values\[(.*)\].*Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1">#remove IC parameters from PE task</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Metabolites\[(.*)\],Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="k">if</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                                <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                                    <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                        <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Parameter {} is not a local parameter, initial concentration parameter or a global parameter.initial_value&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

 
    <span class="k">def</span> <span class="nf">remove_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        

        
    <span class="k">def</span> <span class="nf">write_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
        <span class="k">return</span>  <span class="s1">&#39;writing template. {} set to {} and {} is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">),</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>

        
    <span class="k">def</span> <span class="nf">read_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_item_template</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">True</span><span class="p">,</span><span class="s1">&#39;ItemTemplate file does not exist. Run </span><span class="se">\&#39;</span><span class="s1">write_item_template</span><span class="se">\&#39;</span><span class="s1"> method and modify it how you like then rerun this method&#39;</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">add_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        need 5 elements, each with their own attributes. Their names are:</span>
<span class="sd">            Affected Cross Validation Experiments</span>
<span class="sd">            Affected Experiments</span>
<span class="sd">            LowerBound</span>
<span class="sd">            ObjectCN</span>
<span class="sd">            StartValue</span>
<span class="sd">            UpperBound</span>
<span class="sd">            </span>
<span class="sd">        the element name is &lt;ParameterGroup name=&quot;FitItem&quot;&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#initialize new element</span>
        <span class="n">new_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;FitItem&#39;</span><span class="p">})</span>
        <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="s1">&#39;{} is not in your ItemTemplate. You item template contains: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">item</span><span class="o">=</span> <span class="n">all_items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">subA1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Cross Validation Experiments&#39;</span><span class="p">}</span>
        <span class="n">subA2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Experiments&#39;</span><span class="p">}</span>
        <span class="n">subA3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">])}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">subA5</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;StartValue&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">])}</span>
        
        <span class="n">subA6</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">])}</span>
        
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA1</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA2</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA5</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA6</span><span class="p">)</span>
        
        <span class="c1">#for IC parameters</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="c1">#fill in the attributes</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>


        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ReactionParameter&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
<span class="c1">#            logger.info(&#39;{} is an assignment and can therefore not be estimated!&#39;.format(list(item.index)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="p">}</span>


        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
 
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>           
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid parameter for estimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA4</span><span class="p">)</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;OptimizationItemList&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">insert_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameter_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parameter_list</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="s1">&#39;nan&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">set_PE_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Choose PE algorithm and set algorithm specific parameters </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Build XML for method. Root=Method for now. Will be merged with CoapsiML later</span>
        <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="p">}</span>
        <span class="n">method_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">method_params</span><span class="p">)</span>

        <span class="c1">#list of attribute dictionaries </span>
        <span class="c1">#Evolutionary strategy parametery</span>
        <span class="n">NumberOfGenerations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Generations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">)}</span>
        <span class="n">PopulationSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Population Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">)}</span>
        <span class="n">RandomNumberGenerator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Random Number Generator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">)}</span>
        <span class="n">Seed</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Seed&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">)}</span>
        <span class="n">Pf</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">)}</span>
        <span class="c1">#local method parameters</span>
        <span class="n">IterationLimit</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Iteration Limit&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">)}</span>
        <span class="n">Tolerance</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Tolerance&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">)}</span>
        <span class="n">Rho</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Rho&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">)}</span>
        <span class="n">Scale</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">)}</span>
        <span class="c1">#Particle Swarm parmeters</span>
        <span class="n">SwarmSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Swarm Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">)}</span>
        <span class="n">StdDeviation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Std. Deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">)}</span>
        <span class="c1">#Random Search parameters</span>
        <span class="n">NumberOfIterations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Iterations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">)}</span>
        <span class="c1">#Simulated Annealing parameters</span>
        <span class="n">StartTemperature</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Start Temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">)}</span>
        <span class="n">CoolingFactor</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Factor&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">)}</span>


        <span class="c1">#build the appropiate XML, with method at root (for now)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">pass</span> <span class="c1">#no additional parameter elements required</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Rho</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">SwarmSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StdDeviation</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StartTemperature</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">CoolingFactor</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="c1">#required no additonal paraemters</span>
            <span class="k">pass</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>            

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>  
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>  

        
        <span class="n">tasks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">)</span>

        <span class="n">method</span><span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">method_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span>
        <span class="k">return</span> <span class="n">key</span>
        
    <span class="k">def</span> <span class="nf">set_PE_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">scheluled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span>
                          <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
                          
        <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                       <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>

        <span class="n">randomize_start_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">)}</span>
        <span class="n">calculate_stats</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)}</span>
        <span class="n">create_parameter_sets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)}</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Parameter Estimation&quot;]&#39;</span> <span class="ow">and</span> <span class="s1">&#39;//*[@type=&quot;parameterFitting&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheluled_attrib</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">!=</span><span class="p">[]:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">randomize_start_values</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">calculate_stats</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">create_parameter_sets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
      
    <span class="k">def</span> <span class="nf">get_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        <span class="n">global_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">IC_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="n">df_list_local</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">df_list_global</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">df_list_ICs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_list_local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">global_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_list_global</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Quantitytype&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">df_list_ICs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">l</span><span class="o">=</span><span class="n">df_list_local</span><span class="o">+</span><span class="n">df_list_global</span><span class="o">+</span><span class="n">df_list_ICs</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;No ICs, local or global quantities in your model&#39;</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;StartValue&#39;</span><span class="p">})</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#        df[&#39;startValue&#39;]=[self.kwargs.get(&#39;StartValue&#39;)]*df.shape[0]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Parameter&#39;</span>
        <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">,</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span><span class="s1">&#39;simulationType&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
            
    <span class="k">def</span> <span class="nf">set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EM</span><span class="o">=</span><span class="n">ExperimentMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">EM</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_all_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_method</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_all_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the PlotPEData class to plot results </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_temp.cps&#39;</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">)</span>
<span class="c1">#        cps_copy=shutil.copy</span>
        <span class="k">print</span> <span class="n">copasi_file</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PL</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">PlotPEData</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">)</span>

<span class="c1">#==============================================================================</span>

<span class="k">class</span> <span class="nc">Scan</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Positional Args:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            the copasi file you want to scan</span>

<span class="sd">    **kwargs:</span>
<span class="sd">        ScanType:</span>
<span class="sd">            Which type of scan do you want to set up. </span>
<span class="sd">            Options are [&#39;scan&#39;,&#39;repeat&#39;,&#39;random_sampling&#39;]</span>

<span class="sd">        Metabolites:</span>
<span class="sd">            Metabolites to pass to report </span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities:</span>
<span class="sd">            global wuantities to pass to report</span>
<span class="sd">            </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            either &#39;concentration&#39; or &#39;particle_number&#39;</span>
<span class="sd">        </span>
<span class="sd">        ReportName:</span>
<span class="sd">            Name the output report</span>
<span class="sd">            </span>
<span class="sd">        Append:</span>
<span class="sd">            Check the Append button in copasi scan task.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            Check the confirm overwrite button in copasi scan.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>

<span class="sd">        OutputML:</span>
<span class="sd">            If Save set to duplicate, this is the name of </span>
<span class="sd">            the duplicated copasi file.Options are [&#39;true&#39; or &#39;false&#39;], </span>
<span class="sd">            default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Check the update model button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        SubTask:</span>
<span class="sd">            A valid scan subtask. Options are:</span>
<span class="sd">            [&#39;steady_state&#39;,&#39;time_course&#39;,&#39;metabolic_control_nalysis&#39;,</span>
<span class="sd">            &#39;lyapunov_exponents&#39;,&#39;optimiztion&#39;,&#39;parameter_estimation&#39;,</span>
<span class="sd">            &#39;sensitivities&#39;,&#39;linear_noise_approximation&#39;,&#39;cross_section&#39;,</span>
<span class="sd">            &#39;time_scale_separation_analysis&#39;]</span>
<span class="sd">                   </span>
<span class="sd">        ReportType:</span>
<span class="sd">            Which type of report to use. Options are [&#39;none&#39;,</span>
<span class="sd">            &#39;profilelikelihood&#39;,&#39;time_course&#39;,&#39;parameter_estimation&#39;]</span>
<span class="sd">            </span>
<span class="sd">        OutputInSubtask:</span>
<span class="sd">            Check the OutputInSubtask button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>

<span class="sd">        AdjustInitialConditions:</span>
<span class="sd">            Check the AdjustInitialConditions button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        NumberOfSteps:</span>
<span class="sd">            Corresponds to the Intervals box in Copasi GUI or number</span>
<span class="sd">            of repeats in case your using the Task=&#39;repeat&#39; option. Default=10. </span>
<span class="sd">            </span>
<span class="sd">        Maximum: </span>
<span class="sd">            Corresponds to the Maximum box in Copasi GUI. Default=100. </span>

<span class="sd">        Minimum: </span>
<span class="sd">            Corresponds to the Minimum box in Copasi GUI. Default=0.01. </span>

<span class="sd">        Log: </span>
<span class="sd">            Corresponds to the Log box in Copasi GUI.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;.  </span>
<span class="sd">            </span>
<span class="sd">        DistributionType:</span>
<span class="sd">            When ScanType set to &#39;random_sampling&#39;, can be any of</span>
<span class="sd">            [&#39;normal&#39;,&#39;uniform&#39;,&#39;poisson&#39;,&#39;gamma&#39;]. Default=&#39;normal&#39;</span>
<span class="sd">            </span>
<span class="sd">        Variable:</span>
<span class="sd">            The target of the Scan. Must be a valid model entity. </span>
<span class="sd">            Defaults to the first key in the GMQ.get_metabolites() method</span>

<span class="sd">        Scheduled: </span>
<span class="sd">            Corresponds to the Scheduled box in Copasi GUI. Default=&#39;true&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            Can be one of [&#39;duplicate&#39;,&#39;false&#39;,&#39;overwrite&#39;]. Duplicate</span>
<span class="sd">            will copy copasi file to different file name. Default=&#39;overwrite&#39;</span>
<span class="sd">            </span>
<span class="sd">        ClearScans:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. If &#39;true&#39; will remove all scans present before</span>
<span class="sd">            adding scans. If false, will add another scan in addition to any</span>
<span class="sd">            scans alredy present.Default=&#39;true&#39;</span>
<span class="sd">        </span>
<span class="sd">        Variable:</span>
<span class="sd">            Only used when the report is profile likelihood. Corresponds to </span>
<span class="sd">            parameter of interest. Must be a model entity. Default=None</span>
<span class="sd">            </span>
<span class="sd">        Run:</span>
<span class="sd">            Run Scan task or not. &#39;true&#39; or &#39;false&#39; or &#39;SGE&#39;. Default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="c1">#</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SubTask&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;Maximum&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
                 <span class="s1">&#39;Minimum&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="s1">&#39;Log&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;DistributionType&#39;</span><span class="p">:</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ScanType&#39;</span><span class="p">:</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span>
                 <span class="c1">#scan object specific (for scan and random_sampling ScanTypes)</span>
                 <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ClearScans&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="c1">#if true, will remove all scans present then add new scan</span>
                 <span class="s1">&#39;Run&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
                                  
                 
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Scan&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
        <span class="c1">#correct OutputInSubtask and AsjestInitialConditions</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">],</span><span class="s1">&#39;{} is not either </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        
        <span class="n">subtasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;metabolic_control_nalysis&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;lyapunov_exponents&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;optimiztion&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;linear_noise_approximation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;cross_section&#39;</span><span class="p">,</span><span class="s1">&#39;time_scale_separation_analysis&#39;</span><span class="p">]</span>
                   
        <span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
        <span class="n">dist_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
        <span class="n">scan_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;repeat&#39;</span><span class="p">,</span><span class="s1">&#39;random_sampling&#39;</span><span class="p">]</span>
        <span class="n">quantity_type_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_number&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
        
                   
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">subtasks</span>                   
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} is not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">),</span><span class="n">report_types</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist_types</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">scan_types</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_type_list</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;SGE&#39;</span><span class="p">]</span>


        <span class="c1">#numericify the some keyword arguments</span>
        <span class="n">subtask_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subtasks</span><span class="p">,</span><span class="n">subtask_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SubTask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">#numericidy type keywork arguments </span>
        <span class="n">scan_type_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scan_types</span><span class="p">,</span><span class="n">scan_type_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ScanType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   
                
        <span class="n">dist_types_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dist_types</span><span class="p">,</span><span class="n">dist_types_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
                
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        
        <span class="c1">#convert what needs to be a string to a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">))</span>

<span class="c1">#        if self.kwargs.get(&#39;ReportType&#39;)==&#39;time_course&#39;:</span>
<span class="c1">#            self.kwargs[&#39;ReportType&#39;]=&#39;time-course&#39;</span>
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span><span class="p">,</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">),</span><span class="n">write_to_file_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_scans</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_scan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_scan_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
            
<span class="c1">#            PruneCopasiHeaders(self.kwargs[&#39;ReportName&#39;],replace=&#39;true&#39;)</span>
            
            
            
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                
        
    <span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;defining report&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span>
        
        <span class="n">R</span><span class="o">=</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#ammend the time course option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ReportDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;Report doesn</span><span class="se">\&#39;</span><span class="s1">t exist. Check to see if you have either defined the report manually or used the pycopi.Reports class&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span>
        
    <span class="k">def</span> <span class="nf">create_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        need to find a report key which corresponds to the report we want to use</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get cn value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>


        <span class="n">number_of_steps_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of steps&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">)}</span>
        <span class="n">scan_item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cn</span><span class="p">}</span>
        <span class="n">type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)}</span>
        <span class="n">maximum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">)}</span>
        <span class="n">minimum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">)}</span>
        <span class="n">log_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)}</span>
        <span class="n">dist_type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Distribution type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)}</span>

        <span class="n">scanItem_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;ScanItem&#39;</span><span class="p">})</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dist_type_attrib</span><span class="p">)</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">set_scan_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
                       <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span> 
                       <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                       <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
                       
        <span class="n">subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)}</span>
        <span class="n">output_in_subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Output in subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)}</span>
        <span class="n">adjust_initial_conditions_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)}</span>
        <span class="n">scheduled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span> <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
        
        <span class="n">R</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">report_attrib</span><span class="p">)</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Scan&quot;]&#39;</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If scan task already has a report element defined, modify it, </span>
<span class="sd">        otherwise create a new report element directly under the ScanTask </span>
<span class="sd">        element</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">scan_task</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Problem&#39;</span><span class="p">:</span>
            <span class="n">scan_task</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Report&#39;</span><span class="p">:</span>
            <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduled_attrib</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Subtask&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subtask_attrib</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output in subtask&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">output_in_subtask_attrib</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adjust_initial_conditions_attrib</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">i</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            i.getparent().remove(i)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span>
<span class="c1">#==============================================================================            </span>
            
<span class="k">class</span> <span class="nc">Run</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a copasi file using CopasiSE. Run will deactivate all tasks from </span>
<span class="sd">    being executable via CopasiSE then activate the task you want to run, </span>
<span class="sd">    then run it. </span>
<span class="sd">    </span>
<span class="sd">    copasi_file:</span>
<span class="sd">        The copasi file you want to run </span>
<span class="sd">    </span>
<span class="sd">    **kwargs:</span>
<span class="sd">    </span>
<span class="sd">        Task:</span>
<span class="sd">            Any valid copasi task. Default=time_course. Options are </span>
<span class="sd">            [&#39;steady_state&#39;,&#39;time_course&#39;,&#39;scan&#39;,&#39;fluxmode&#39;,&#39;optimization&#39;,</span>
<span class="sd">            &#39;parameter_estimation&#39;,&#39;metaboliccontrolanalysis&#39;,&#39;lyapunovexponents&#39;,</span>
<span class="sd">            &#39;timescaleseparationanalysis&#39;,&#39;sensitivities&#39;,&#39;moieties&#39;,</span>
<span class="sd">            &#39;crosssection&#39;,&#39;linearnoiseapproximation&#39;]</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            Either &#39;false&#39;,&#39;duplicate&#39; or &#39;overwrite&#39;. Should probably remain </span>
<span class="sd">            on &#39;overwrite&#39;, the default. </span>
<span class="sd">            </span>
<span class="sd">        Mode:</span>
<span class="sd">            &#39;true&#39;, &#39;false&#39;,&#39;multiprocess&#39;, or &#39;SGE&#39;. Default is &#39;true&#39; but can be turned off if you </span>
<span class="sd">            want to uncheck all executable boxes then check the Task executable</span>
<span class="sd">            </span>
<span class="sd">        MaxTime:</span>
<span class="sd">            Default None. Max time in seconds for copasi to be allowed to run</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.sh&#39;</span>
        
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Task&#39;</span><span class="p">:</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Mode&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MaxTime&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
                                  
                 
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Run&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>    


        <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
               <span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;fluxmode&#39;</span><span class="p">,</span><span class="s1">&#39;optimization&#39;</span><span class="p">,</span>
               <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="s1">&#39;metaboliccontrolanalysis&#39;</span><span class="p">,</span>
               <span class="s1">&#39;lyapunovexponents&#39;</span><span class="p">,</span><span class="s1">&#39;timescaleseparationanalysis&#39;</span><span class="p">,</span>
               <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;moieties&#39;</span><span class="p">,</span><span class="s1">&#39;crosssection&#39;</span><span class="p">,</span>
               <span class="s1">&#39;linearnoiseapproximation&#39;</span><span class="p">]</span>
                   
        
                  
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid task. Choose from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">),</span><span class="n">tasks</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;MaxTime argument must be float or int&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;timecourse&#39;</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameterfitting&#39;</span>        
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;steady_state&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;steadystate&#39;</span>        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_task</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submit_copasi_job_SGE</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;multiprocess&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multi_run</span><span class="p">()</span>
            
            

    <span class="k">def</span> <span class="nf">multi_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">:</span>
                <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span>


        
    <span class="k">def</span> <span class="nf">set_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;false&#39;</span> <span class="c1">#set all to false</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;true&#39;</span>
                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process the copasi file using CopasiSE</span>
<span class="sd">        Must be Copasi version 16</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="s1">&#39;--maxTime&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span><span class="n">err</span><span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">output</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">err</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">CopasiError</span><span class="p">(</span><span class="s1">&#39;Failed with Copasi error: </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">submit_copasi_job_SGE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Submit copasi file as job to SGE based job scheduler. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#!/bin/bash</span><span class="se">\n</span><span class="s1">#$ -V -cwd</span><span class="se">\n</span><span class="s1">module add apps/COPASI/4.16.104-Linux-64bit</span><span class="se">\n</span><span class="s1">CopasiSE {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="c1">## -N option for job name </span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;qsub {} -N {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">))</span>
        <span class="c1">## remove .sh file after used. </span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">)</span>
    
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        


<span class="c1">#==============================================================================</span>
        
<span class="k">class</span> <span class="nc">InsertParameters</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Insert parameters from a file, dictionary or a pandas dataframe into a copasi</span>
<span class="sd">    file. </span>
<span class="sd">    </span>
<span class="sd">    Positional Arguments:</span>
<span class="sd">    </span>
<span class="sd">        copasi_file:</span>
<span class="sd">            The copasi file you want to enter parameters into</span>
<span class="sd">    </span>
<span class="sd">    **Kwargs</span>
<span class="sd">        Index:</span>
<span class="sd">            Index of parameter estimation run to input into the copasi file. </span>
<span class="sd">            The index is ordered by rank of best fit, with 0 being the best.</span>
<span class="sd">            Default=0            </span>
<span class="sd">            </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            Either &#39;particle_number&#39; or &#39;concentration&#39;. Default=&#39;concentration&#39;</span>
<span class="sd">            </span>
<span class="sd">        ReportName;</span>
<span class="sd">            Unused. Delete?</span>
<span class="sd">            </span>
<span class="sd">        OutputML:</span>
<span class="sd">            If Save set to &#39;duplicate&#39;, this is the duplicate filename</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;,default=overwrite</span>
<span class="sd">            </span>
<span class="sd">        ParameterDict:</span>
<span class="sd">            A python dictionary with keys correponding to parameters in the model</span>
<span class="sd">            and values the parameters (dict[parameter_name]=parameter value). </span>
<span class="sd">            Default=None</span>
<span class="sd">            </span>
<span class="sd">        DF:</span>
<span class="sd">            A pandas dataframe with parameters being column names matching </span>
<span class="sd">            parameters in your model and RSS values and rows being individual </span>
<span class="sd">            parameter estimationruns. In this case, ensure you have set the </span>
<span class="sd">            Index parameter to the index you want to use. Dataframes are </span>
<span class="sd">            automatically sorted by the RSS column. </span>
<span class="sd">            </span>
<span class="sd">        ParameterPath:</span>
<span class="sd">            Full path to a parameter estimation file (&#39;.txt&#39;,&#39;.xls&#39;,&#39;.xlsx&#39; or </span>
<span class="sd">            &#39;.csv&#39;) or a folder containing parameter estimation files. </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        coapsi_file = file you want to insert</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Index: If not specified default to -1</span>
<span class="sd">                    can be int or list of ints</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>

        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Index&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;ParameterDict&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DF&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;ParameterPath&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 
                 <span class="p">}</span>
                     
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for InsertParameters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
<span class="c1">#        assert os.path.exists(self.parameter_path),&#39;{} doesn\&#39;t exist&#39;.format(self.parameter_path)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Argument to </span><span class="se">\&#39;</span><span class="s1">ParameterDict</span><span class="se">\&#39;</span><span class="s1"> keyword needs to be of type dict&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Parameter </span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> is not in your model. </span><span class="se">\n\n</span><span class="s1">These are in your model:</span><span class="se">\n</span><span class="s1">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to give at least one of ParameterDict,ParameterPath or DF keyword arguments&#39;</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">)</span>
                
            
        <span class="c1">#make sure user gives the right number of arguments</span>
        <span class="n">num</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">num</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to supply exactly one of ParameterDict,ParameterPath or df keyord argument. You cannot give two or three.&#39;</span><span class="p">)</span>
        
<span class="c1">#        self.check_parameter_consistancy()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_gl_and_lt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_all</span><span class="p">()</span>
        <span class="c1">#change</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">check_parameter_consistancy_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        raise an error if no parameters in the PE header match </span>
<span class="sd">        parameters in model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">Please check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">check_parameter_consistancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        raise an error if no parameters in the PE header match </span>
<span class="sd">        parameters in model</span>
<span class="sd">        </span>
<span class="sd">        args:</span>
<span class="sd">            df:</span>
<span class="sd">                containing parameters to compare with parameters</span>
<span class="sd">                in the model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">Please check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>            
            
    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get parameters depending on the type of input. </span>
<span class="sd">        Converge on a pandas dataframe. </span>
<span class="sd">        Columns = parameters, rows = parameter sets</span>
<span class="sd">        </span>
<span class="sd">        Use check parameter consistency to see</span>
<span class="sd">        whether headers have been pruned or not. If not try pruning them</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">),</span><span class="s1">&#39;The ParameterDict argument takes a Python dictionary&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a parameter. These are your parameters:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">PED</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">ParsePEData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">insert_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#first isolate the local parameters </span>
        <span class="n">local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span> <span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                    
    <span class="k">def</span> <span class="nf">insert_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">insert_ICs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">IC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                        <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">convert_molar_to_particles</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="nb">float</span><span class="p">(</span><span class="n">IC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]))</span><span class="c1">#,self.GMQ.get_volume_unit())</span>
<span class="c1">##                        particles=self.parameters[i]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                        <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>



    <span class="k">def</span> <span class="nf">insert_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        insert parameters into fit items</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;OptimizationItemList&#39;]&quot;</span>
        <span class="n">ICs_and_global</span><span class="o">=</span><span class="bp">None</span>
        <span class="n">reaction</span><span class="o">=</span><span class="bp">None</span>
        <span class="n">parameter</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                        <span class="n">pattern1</span><span class="o">=</span><span class="s1">&#39;Vector=(?!Reactions).*\[(.*)\]&#39;</span><span class="c1">#match global and IC parameters but not local</span>
                        <span class="n">search1</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        
                        <span class="k">if</span> <span class="n">search1</span> <span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">ICs_and_global</span><span class="o">=</span><span class="n">search1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">ICs_and_global</span><span class="p">]))</span>
                    <span class="c1">#now again for local parameters</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                        <span class="n">pattern2</span><span class="o">=</span><span class="s1">&#39;Vector=Reactions\[(.*)\].*Parameter=(.*),&#39;</span>
                        <span class="n">search2</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">search2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="o">=</span> <span class="n">search2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">local</span><span class="o">=</span> <span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">reaction</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">local</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">local</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">continue</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">get_current_parameters_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deprecated. Just use self.GMQ.get_all_model_variables()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        


    <span class="k">def</span> <span class="nf">replace_gl_and_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        replace greater than and less than symbols for XML purposes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">i</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&lt;&#39;</span><span class="p">)</span>
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&gt;&#39;</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
            
        
    <span class="k">def</span> <span class="nf">insert_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_locals</span><span class="p">()</span>
<span class="c1">#        self.save() </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_global</span><span class="p">()</span>
<span class="c1">#        self.save()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_ICs</span><span class="p">()</span>
<span class="c1">#        self.save()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="c1">#        os.chdir(os.path.dirname(self.copasi_file))</span>
               
<span class="c1">#==============================================================================</span>
<span class="k">class</span> <span class="nc">PruneCopasiHeaders</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    COPASI uses references to distinguish model components (like InitialConcentration </span>
<span class="sd">    or InitialParticleNumber). These are printed to file with copasi results and</span>
<span class="sd">    its therefore useful to have a way to remove these references, leaving only the </span>
<span class="sd">    model component as it is in the model. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        for_pruning: either a full path to the file you want to prune or </span>
<span class="sd">        a pandas dataframe</span>
<span class="sd">    </span>
<span class="sd">    kwargs:</span>
<span class="sd">        replace:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, if &#39;true&#39; will overwrite the filename. If &#39;false&#39;</span>
<span class="sd">            write new file to new_path. If for_pruning a dataframe this argument is</span>
<span class="sd">            ignored. </span>
<span class="sd">            </span>
<span class="sd">        new_path: </span>
<span class="sd">            When replace=&#39;false &#39;new_path&#39; is the output filename. Ignored when </span>
<span class="sd">            for_pruning is a pandas dataframe.</span>
<span class="sd">        </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="n">new_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="o">=</span><span class="n">for_pruning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span>
        
<span class="c1">#        assert self.mode in [&#39;singlePE&#39;,&#39;multiPE,&#39;time_course&#39;]</span>
        
        <span class="k">if</span> <span class="n">replace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">replace</span><span class="se">\&#39;</span><span class="s1"> keyword should be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> &#39;</span><span class="p">)</span>

            
        <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">True</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_path</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_pruned_titles.txt&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="n">new_path</span>
        
<span class="c1">#        if self.mode==&#39;time_course&#39;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
    
    
    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        for time course we&#39;re using index but for PE were not. Need to make this consistant!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
        <span class="n">l</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">new_titles</span><span class="o">=</span><span class="p">[]</span> 
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="c1">#match anything between two square brackets with regex</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="c1">#we need the residual sum of squares value to be called &#39;RSS&#39;</span>
            <span class="c1">#and everything else to be an exact match to the corresponding</span>
            <span class="c1">#model element</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Parameter Estimation&#39;</span><span class="p">:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">new_titles</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">new_titles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>

<span class="c1">#==============================================================================</span>

            
        
            
<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">pass</span>
        
</pre></div>

  </div>

  </header>

  <section id="section-items">


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="pycopi.CopasiMLParser" class="name">class <span class="ident">CopasiMLParser</span></p>
      
  
    <div class="desc"><p>Parse a copasi file into xml.etree. </p>
<p>Positional arguments:
    copasi_file:
        A full path to a copasi file</p>
<p>Attributes:
    copasiML=the copasi model parsed into etree</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.CopasiMLParser', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.CopasiMLParser" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CopasiMLParser</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse a copasi file into xml.etree. </span>
<span class="sd">    </span>
<span class="sd">    Positional arguments:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            A full path to a copasi file</span>
<span class="sd">        </span>
<span class="sd">    Attributes:</span>
<span class="sd">        copasiML=the copasi model parsed into etree</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">FileDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;{} is not a copasi file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_copasiML</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Recently changed this class to use lxml built in functions</span>
<span class="sd">        rather that pythons standard write and read methods. Hopefully this</span>
<span class="sd">        should help some of the performance issues. The below two comments are required for</span>
<span class="sd">        the old class. Keep them commented out until you remove the deprecations fully </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#self.dir=os.path.dirname(self.copasi_file)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">_parse_copasiML_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        deprecated in favor of using etree.parse</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">copasiML_str</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">copasiML_str</span><span class="p">)</span>
        


    <span class="k">def</span> <span class="nf">write_copasi_file_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Often you need to delete a copasi file and rewrite it</span>
<span class="sd">        directly from the string. This function does this.</span>
<span class="sd">        </span>
<span class="sd">        copasi_filename = a valid .cps file</span>
<span class="sd">        copasiML = an xml string. Convert to xml string</span>
<span class="sd">        before using this function using etree.fromstring(xml_string)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">copasiML</span><span class="p">,</span><span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>    
            
    <span class="k">def</span> <span class="nf">_parse_copasiML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parse xml doc with lxml </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        write to file with lxml write function</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">##first convert the copasiML to a root element tree</span>
        <span class="n">root</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.CopasiMLParser">CopasiMLParser</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.CopasiMLParser.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
    <div class="desc"><p>Recently changed this class to use lxml built in functions
rather that pythons standard write and read methods. Hopefully this
should help some of the performance issues. The below two comments are required for
the old class. Keep them commented out until you remove the deprecations fully</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.CopasiMLParser.copasiMLTree" class="name">var <span class="ident">copasiMLTree</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.CopasiMLParser.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.CopasiMLParser.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.CopasiMLParser.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.CopasiMLParser.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">FileDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;{} is not a copasi file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_copasiML</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiMLTree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Recently changed this class to use lxml built in functions</span>
<span class="sd">    rather that pythons standard write and read methods. Hopefully this</span>
<span class="sd">    should help some of the performance issues. The below two comments are required for</span>
<span class="sd">    the old class. Keep them commented out until you remove the deprecations fully </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#self.dir=os.path.dirname(self.copasi_file)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.CopasiMLParser.write_copasi_file">
    <p>def <span class="ident">write_copasi_file</span>(</p><p>self, copasi_filename, copasiML)</p>
    </div>
    

    
  
    <div class="desc"><p>write to file with lxml write function</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.CopasiMLParser.write_copasi_file', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.CopasiMLParser.write_copasi_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    write to file with lxml write function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">##first convert the copasiML to a root element tree</span>
    <span class="n">root</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.CopasiMLParser.write_copasi_file_deprecated">
    <p>def <span class="ident">write_copasi_file_deprecated</span>(</p><p>self, copasi_filename, copasiML)</p>
    </div>
    

    
  
    <div class="desc"><p>Often you need to delete a copasi file and rewrite it
directly from the string. This function does this.</p>
<p>copasi_filename = a valid .cps file
copasiML = an xml string. Convert to xml string
before using this function using etree.fromstring(xml_string)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.CopasiMLParser.write_copasi_file_deprecated', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.CopasiMLParser.write_copasi_file_deprecated" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_copasi_file_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_filename</span><span class="p">,</span><span class="n">copasiML</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Often you need to delete a copasi file and rewrite it</span>
<span class="sd">    directly from the string. This function does this.</span>
<span class="sd">    </span>
<span class="sd">    copasi_filename = a valid .cps file</span>
<span class="sd">    copasiML = an xml string. Convert to xml string</span>
<span class="sd">    before using this function using etree.fromstring(xml_string)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">copasi_filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">copasiML</span><span class="p">,</span><span class="n">pretty_print</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>    
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.ExperimentMapper" class="name">class <span class="ident">ExperimentMapper</span></p>
      
  
    <div class="desc"><p>Class to map variables from a parameter estimation item template which 
is written using the ParameterEstimation.Write_item_template method, to model 
variables. Variable names must match exactly. You cannot have more than 
1 species with the same name, regardless of compartment. Generally
this class is used within the parameter estimation class so the user doesn't
need to bother with it.      </p>
<p>args:
    copasi_file: 
        Copasi file path 
    experiment_files:
        list of experiment file paths</p>
<p>See documentation for ParameterEstimation for
details on each keyword argument</p>
<p>kwargs:
    RowOrientation</p>
<div class="codehilite"><pre><span></span>ExperimentType

FirstRow

NormalizeWeightsPerExperiment

RowContainingNames

Separator

WeightMethod

Save

OutputML
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ExperimentMapper</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to map variables from a parameter estimation item template which </span>
<span class="sd">    is written using the ParameterEstimation.Write_item_template method, to model </span>
<span class="sd">    variables. Variable names must match exactly. You cannot have more than </span>
<span class="sd">    1 species with the same name, regardless of compartment. Generally</span>
<span class="sd">    this class is used within the parameter estimation class so the user doesn&#39;t</span>
<span class="sd">    need to bother with it.      </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file: </span>
<span class="sd">            Copasi file path </span>
<span class="sd">        experiment_files:</span>
<span class="sd">            list of experiment file paths</span>
<span class="sd">            </span>
<span class="sd">    See documentation for ParameterEstimation for</span>
<span class="sd">    details on each keyword argument</span>
<span class="sd">    </span>
<span class="sd">    kwargs:</span>
<span class="sd">        RowOrientation</span>
<span class="sd">        </span>
<span class="sd">        ExperimentType</span>
<span class="sd">        </span>
<span class="sd">        FirstRow</span>
<span class="sd">        </span>
<span class="sd">        NormalizeWeightsPerExperiment</span>
<span class="sd">        </span>
<span class="sd">        RowContainingNames</span>
<span class="sd">        </span>
<span class="sd">        Separator</span>
<span class="sd">        </span>
<span class="sd">        WeightMethod</span>
<span class="sd">        </span>
<span class="sd">        Save</span>
<span class="sd">        </span>
<span class="sd">        OutputML        </span>
<span class="sd">             </span>
<span class="sd">                 </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>

        <span class="n">options</span><span class="o">=</span><span class="p">{</span>    
                 <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span> <span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">}</span>
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>

        <span class="c1">#assign numberic values to WeightMethod   </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">))):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">,</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">,</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
        
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">))):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;steadystate&#39;</span><span class="p">,</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;steadystate&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span> 
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
        
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">],</span><span class="s1">&#39;{} should be true or false&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

                
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>

        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>        


        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;separator should be given asa python list&#39;</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">]</span>
        
        <span class="c1">#run the experiment mapper        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_experiments</span><span class="p">()</span>
        
        <span class="c1">#save the copasi file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">get_existing_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">existing_experiment_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">existing_experiment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">existing_experiment_list</span>

    <span class="k">def</span> <span class="nf">remove_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        name attribute of experiment. usually Experiment_1 or something</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">experiment_name</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_all_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_existing_experiments</span><span class="p">():</span>
            <span class="n">experiment_name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    
    <span class="k">def</span> <span class="nf">create_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Adds a single experiment set to the parameter estimation task</span>
<span class="sd">        exp_file is an experiment filename with exactly matching headers (independent variablies need &#39;_indep&#39; appended to the end)</span>
<span class="sd">        since this method is intended to be used in a loop in another function to </span>
<span class="sd">        deal with all experiment sets, the second argument &#39;i&#39; is the index for the current experiment</span>
<span class="sd">        </span>
<span class="sd">        i is the exeriment_file index        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1">#get observables from data. Must be exact match        </span>
        <span class="n">obs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        
        <span class="c1">#prune any observables that are contained within square brackets (like the outout from copasu)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">!=</span><span class="p">[]:</span>
                <span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">num_rows</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">num_columns</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#plus 1 to account for 0 indexed</span>
        
        
        <span class="c1">#if exp_file is in the same directory as copasi_file only use relative path</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="n">exp</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                
<span class="c1">#        key_value= len(self.get_existing_experiments())+1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Experiment_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#necessary XML attributes</span>
        <span class="n">Exp</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">})</span>
        
        <span class="n">RowOrientation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Data is Row Oriented&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">ExperimentType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Experiment Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">ExpFile</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;File Name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="p">}</span>
        <span class="n">FirstRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;First Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">}</span>
        <span class="n">LastRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Last Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span> <span class="c1">#add 1 to account for 0 indexed python </span>
        <span class="n">NormalizeWeightsPerExperiment</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Normalize Weights per Experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">NumberOfColumns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Columns&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">num_columns</span><span class="p">}</span>
        <span class="n">ObjectMap</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object Map&#39;</span><span class="p">}</span>
        <span class="n">RowContainingNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Row containing Names&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">Separator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Separator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
        <span class="n">WeightMethod</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weight Method&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>

        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowOrientation</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExperimentType</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExpFile</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">FirstRow</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Key</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">LastRow</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NormalizeWeightsPerExperiment</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfColumns</span><span class="p">)</span>
        <span class="n">Map</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ObjectMap</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowContainingNames</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Separator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">WeightMethod</span><span class="p">)</span>
        
        <span class="c1">#get handle to the cn&#39;s</span>
        <span class="n">ICs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        
        <span class="c1">#define object role attributes</span>
        <span class="n">TimeRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
        <span class="n">DepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span>
        <span class="n">IndepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_columns</span><span class="p">)):</span>
            <span class="n">map_group</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Map</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#when Experiment type is set to time course it should be 1</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">TimeRole</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                    Need to duplicate the below block for ease. Could be more sophisticated </span>
<span class="sd">                    but this is less effort. </span>
<span class="sd">                    &#39;&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                            <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                            
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                            <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>
    
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                            <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                            
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                            Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                            out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                            &#39;&#39;&#39;</span>
                        <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                            <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Region of duplicated code</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                        <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                        <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                        <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                        Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                        out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                        &#39;&#39;&#39;</span>
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>
            

        <span class="k">return</span> <span class="n">Exp</span>

    <span class="k">def</span> <span class="nf">add_experiment_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">map_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_experiments</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)):</span>
            <span class="n">Experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_experiment_set</span><span class="p">(</span><span class="n">Experiment</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.ExperimentMapper">ExperimentMapper</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.ExperimentMapper.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ExperimentMapper.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ExperimentMapper.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ExperimentMapper.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ExperimentMapper.experiment_files" class="name">var <span class="ident">experiment_files</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ExperimentMapper.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, experiment_files, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>    
             <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span> <span class="p">,</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">}</span>
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    <span class="c1">#assign numberic values to WeightMethod   </span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">))):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">,</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">,</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;stardard_deviation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;value_scaling&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
    
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">))):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;steadystate&#39;</span><span class="p">,</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;steadystate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="mi">0</span> 
        <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
    
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">],</span><span class="s1">&#39;{} should be true or false&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
            
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>        
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;separator should be given asa python list&#39;</span>
    
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">]</span>
    
    <span class="c1">#run the experiment mapper        </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">map_experiments</span><span class="p">()</span>
    
    <span class="c1">#save the copasi file</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.add_experiment_set">
    <p>def <span class="ident">add_experiment_set</span>(</p><p>self, experiment_element)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.add_experiment_set', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.add_experiment_set" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_experiment_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">):</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">j</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">experiment_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.create_experiment">
    <p>def <span class="ident">create_experiment</span>(</p><p>self, index)</p>
    </div>
    

    
  
    <div class="desc"><p>Adds a single experiment set to the parameter estimation task
exp_file is an experiment filename with exactly matching headers (independent variablies need '_indep' appended to the end)
since this method is intended to be used in a loop in another function to 
deal with all experiment sets, the second argument 'i' is the index for the current experiment</p>
<p>i is the exeriment_file index</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.create_experiment', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.create_experiment" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds a single experiment set to the parameter estimation task</span>
<span class="sd">    exp_file is an experiment filename with exactly matching headers (independent variablies need &#39;_indep&#39; appended to the end)</span>
<span class="sd">    since this method is intended to be used in a loop in another function to </span>
<span class="sd">    deal with all experiment sets, the second argument &#39;i&#39; is the index for the current experiment</span>
<span class="sd">    </span>
<span class="sd">    i is the exeriment_file index        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">])</span>
    <span class="c1">#get observables from data. Must be exact match        </span>
    <span class="n">obs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    
    <span class="c1">#prune any observables that are contained within square brackets (like the outout from copasu)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\[(.*)\]&#39;</span><span class="p">,</span><span class="n">obs</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">num_rows</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">num_columns</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#plus 1 to account for 0 indexed</span>
    
    
    <span class="c1">#if exp_file is in the same directory as copasi_file only use relative path</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
        <span class="n">exp</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            
     <span class="n">key_value</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_existing_experiments</span><span class="p">())</span><span class="o">+</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;Experiment_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    
    <span class="c1">#necessary XML attributes</span>
    <span class="n">Exp</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">})</span>
    
    <span class="n">RowOrientation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Data is Row Oriented&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">ExperimentType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Experiment Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">ExpFile</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;File Name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="p">}</span>
    <span class="n">FirstRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;First Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">Key</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Key&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">}</span>
    <span class="n">LastRow</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Last Row&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span> <span class="c1">#add 1 to account for 0 indexed python </span>
    <span class="n">NormalizeWeightsPerExperiment</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Normalize Weights per Experiment&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">NumberOfColumns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Columns&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">num_columns</span><span class="p">}</span>
    <span class="n">ObjectMap</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object Map&#39;</span><span class="p">}</span>
    <span class="n">RowContainingNames</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Row containing Names&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">Separator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Separator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">WeightMethod</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weight Method&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]}</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowOrientation</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExperimentType</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ExpFile</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">FirstRow</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Key</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">LastRow</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NormalizeWeightsPerExperiment</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfColumns</span><span class="p">)</span>
    <span class="n">Map</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">ObjectMap</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RowContainingNames</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Separator</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">WeightMethod</span><span class="p">)</span>
    
    <span class="c1">#get handle to the cn&#39;s</span>
    <span class="n">ICs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
    <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
    <span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
    
    <span class="c1">#define object role attributes</span>
    <span class="n">TimeRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">}</span>
    <span class="n">DepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span>
    <span class="n">IndepentantVariableRole</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num_columns</span><span class="p">)):</span>
        <span class="n">map_group</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">Map</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#when Experiment type is set to time course it should be 1</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">TimeRole</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                Need to duplicate the below block for ease. Could be more sophisticated </span>
<span class="sd">                but this is less effort. </span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                        <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                        <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                        <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                        Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                        out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                        &#39;&#39;&#39;</span>
                    <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                        <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Region of duplicated code</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span><span class="o">==</span><span class="s1">&#39;_indep&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                    <span class="n">independent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_ICs</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                    <span class="n">independent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_globs</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">6</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                    <span class="n">independent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">independent_locs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;{} not in ICs, global vars or local variables&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IndepentantVariableRole</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ICs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">ICs</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                    <span class="n">dependent_ICs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_ICs</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">glob</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                    <span class="n">dependent_globs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span> 
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_globs</span><span class="p">)</span>
                    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                    Note that you don&#39;t ever map data to reaction parameters therefore the commented</span>
<span class="sd">                    out block below is not needed. Don&#39;t delete until you are sure of it though...</span>
<span class="sd">                    &#39;&#39;&#39;</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">loc</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">cn</span><span class="o">=</span><span class="n">loc</span><span class="p">[</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                    <span class="n">dependent_locs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object CN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">}</span>
                    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dependent_locs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ExperimentMappingError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> mapping error. In the copasi GUI its possible to have same name for two species provided they are in different compartments. In this API, having non-unique species identifiers leads to errors in mapping experimental to model variables&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">map_group</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">DepentantVariableRole</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Exp</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.get_existing_experiments">
    <p>def <span class="ident">get_existing_experiments</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.get_existing_experiments', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.get_existing_experiments" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_existing_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">existing_experiment_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">existing_experiment_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">existing_experiment_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.map_experiments">
    <p>def <span class="ident">map_experiments</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.map_experiments', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.map_experiments" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">map_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_experiments</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)):</span>
        <span class="n">Experiment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_experiment</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_experiment_set</span><span class="p">(</span><span class="n">Experiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.remove_all_experiments">
    <p>def <span class="ident">remove_all_experiments</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.remove_all_experiments', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.remove_all_experiments" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_all_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_existing_experiments</span><span class="p">():</span>
        <span class="n">experiment_name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_experiment</span><span class="p">(</span><span class="n">experiment_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.remove_experiment">
    <p>def <span class="ident">remove_experiment</span>(</p><p>self, experiment_name)</p>
    </div>
    

    
  
    <div class="desc"><p>name attribute of experiment. usually Experiment_1 or something</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.remove_experiment', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.remove_experiment" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    name attribute of experiment. usually Experiment_1 or something</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Experiment Set&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">experiment_name</span><span class="p">:</span>
                <span class="n">j</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ExperimentMapper.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ExperimentMapper.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ExperimentMapper.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.GetModelQuantities" class="name">class <span class="ident">GetModelQuantities</span></p>
      
  
    <div class="desc"><p>Positional arguments:
    copasi_file:
        Full path to copasi file</p>
<p>keywords:
    Quantitytype:
        either 'concentration' (default) or 'particle_numbers'.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GetModelQuantities</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Positional arguments:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            Full path to copasi file</span>
<span class="sd">            </span>
<span class="sd">    keywords:</span>
<span class="sd">        Quantitytype:</span>
<span class="sd">            either &#39;concentration&#39; (default) or &#39;particle_numbers&#39;. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">QuantityType</span><span class="o">=</span><span class="s1">&#39;concentration&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">=</span><span class="n">QuantityType</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span>
                
<span class="c1">#        self.all_params=self.get_global_quantities_cns().keys()+self.get_IC_cns().keys()+self.get_local_kinetic_parameters_cns().keys()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">convert_particles_to_molar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">particles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span><span class="c1">#,vol_unit):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts particle numbers to Molarity. </span>
<span class="sd">        particles=number of particles you want to convert</span>
<span class="sd">        mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
            <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
            <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span>
        <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
        <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
        <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span>
            <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">molarity</span><span class="p">,</span><span class="mi">33</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">convert_molar_to_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">moles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Converts particle numbers to Molarity. </span>
<span class="sd">        particles=number of particles you want to convert</span>
<span class="sd">        mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compartment_volume</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;compartment_volume is the volume of the compartment for species and must be either a float or a int&#39;</span><span class="p">)</span>

        <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
            <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
            <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
        <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
        <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
        <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span><span class="o">*</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="c1"># or &#39;#&#39;:</span>
            <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">particles</span>        

    <span class="k">def</span> <span class="nf">get_quantity_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get model quantity units (nM for example)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">quantity_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;quantityUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">quantity_unit</span>
        
    <span class="k">def</span> <span class="nf">get_volume_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model volume units. ml for example</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">vol_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;volumeUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vol_unit</span>
        
    <span class="k">def</span> <span class="nf">get_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model time units</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">time_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;timeUnit&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">time_unit</span>
        
    <span class="k">def</span> <span class="nf">check_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Non-ascii characters are not currently supported. </span>
<span class="sd">        Check for non-ascii characters</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">()</span><span class="o">.</span><span class="n">is_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39;Your model name contains non-ascii characters which are not currently supported by PyCoTools.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>
        
    <span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get model name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">name</span>     
        
        


    <span class="k">def</span> <span class="nf">get_model_name_cn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        get reference to model name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">first</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">string</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">first</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
        <span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Model=(.*),Vector=C&#39;</span><span class="p">,</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">get_metabolites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deprecated. Use get_ICs_cns() inst</span>
<span class="sd">        returns dict of metabolites in the &#39;species&#39; menu</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metab_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Vector=Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                                
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compartment_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\],&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                    
                    <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                        <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">{}</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                    <span class="n">concentration</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">concentration</span>
                    <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">compartment_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metab_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">NoMetabolitesError</span><span class="p">(</span><span class="s1">&#39;There are no metabolites in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_name</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">metab_dct</span>
        

    <span class="k">def</span> <span class="nf">get_global_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a dict of global quantities</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
        <span class="n">model_val_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">model_val_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">model_val_dct</span>
<span class="c1">#        </span>
                        
    <span class="k">def</span> <span class="nf">get_local_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return dict of local parameters used in your model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                            <span class="k">return</span> <span class="bp">False</span>
                        <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">get_compartments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a dict of compartments in your model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Compartment Sizes&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>
        
        
    <span class="k">def</span> <span class="nf">compartment_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metab</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        metab=a single metabolite dict from the get_metabolites method</span>
<span class="sd">        look metab up in the compartment definitions </span>
<span class="sd">        and get the name corresponding to it&#39;s key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">m_comp</span><span class="o">=</span> <span class="n">metab</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span> <span class="n">m_comp</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  

    <span class="k">def</span> <span class="nf">get_IC_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for initial condition parameters. </span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} is not a string but a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>  
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
                <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">molar</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">molar</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">compartment_vol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
        
        
    <span class="k">def</span> <span class="nf">get_global_quantities_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for global kinetic parameters. </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} should be a string but is instead a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">get_local_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for local kinetic parameters. </span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">get_global_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the xml segment for global parameters that are used as</span>
<span class="sd">        kinetic parameters. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                        <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                        <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                        <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return all parameters that are present in the fit items of the</span>
<span class="sd">        parameter estimation task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
        <span class="k">return</span> <span class="n">d</span>
        

    <span class="k">def</span> <span class="nf">get_all_model_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        concatonate the output of the three functions that give model variables</span>
<span class="sd">        Return list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">l</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        <span class="n">p</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="o">**</span><span class="n">g</span><span class="p">)</span>
        <span class="n">p</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">p</span>
        
    <span class="k">def</span> <span class="nf">get_experiment_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get any parameter estimation data files that are defined </span>
<span class="sd">        within copasi parameter estimation task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;File Name&quot;]&#39;</span>
        <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">files</span>
        
    <span class="k">def</span> <span class="nf">get_all_params_dict_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">        global and IC parameters in copasi_file</span>
<span class="sd">        </span>
<span class="sd">        Use get_all_model_variables</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            now format the local parameters</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">var_dct</span>
        
        
    <span class="k">def</span> <span class="nf">get_all_params_dict_deprecated2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">        global and IC parameters in copasi_file</span>
<span class="sd">        </span>
<span class="sd">        get_all_model_variables</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            now format the local parameters</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">var_dct</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.GetModelQuantities">GetModelQuantities</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.GetModelQuantities.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.GetModelQuantities.QuantityType" class="name">var <span class="ident">QuantityType</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.GetModelQuantities.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.GetModelQuantities.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, QuantityType=&#39;concentration&#39;)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">QuantityType</span><span class="o">=</span><span class="s1">&#39;concentration&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">=</span><span class="n">QuantityType</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span>
            
     <span class="bp">self</span><span class="o">.</span><span class="n">all_params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.check_ascii">
    <p>def <span class="ident">check_ascii</span>(</p><p>self, string)</p>
    </div>
    

    
  
    <div class="desc"><p>Non-ascii characters are not currently supported. 
Check for non-ascii characters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.check_ascii', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.check_ascii" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">check_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Non-ascii characters are not currently supported. </span>
<span class="sd">    Check for non-ascii characters</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">()</span><span class="o">.</span><span class="n">is_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39;Your model name contains non-ascii characters which are not currently supported by PyCoTools.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.compartment_lookup">
    <p>def <span class="ident">compartment_lookup</span>(</p><p>self, metab)</p>
    </div>
    

    
  
    <div class="desc"><p>metab=a single metabolite dict from the get_metabolites method
look metab up in the compartment definitions 
and get the name corresponding to it's key</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.compartment_lookup', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.compartment_lookup" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">compartment_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metab</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    metab=a single metabolite dict from the get_metabolites method</span>
<span class="sd">    look metab up in the compartment definitions </span>
<span class="sd">    and get the name corresponding to it&#39;s key</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">m_comp</span><span class="o">=</span> <span class="n">metab</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span> <span class="n">m_comp</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.convert_molar_to_particles">
    <p>def <span class="ident">convert_molar_to_particles</span>(</p><p>self, moles, mol_unit, compartment_volume)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts particle numbers to Molarity. 
particles=number of particles you want to convert
mol_unit=one of, 'fmol, pmol, nmol, umol, mmol or mol'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.convert_molar_to_particles', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.convert_molar_to_particles" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">convert_molar_to_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">moles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts particle numbers to Molarity. </span>
<span class="sd">    particles=number of particles you want to convert</span>
<span class="sd">    mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compartment_volume</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;compartment_volume is the volume of the compartment for species and must be either a float or a int&#39;</span><span class="p">)</span>
    <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
        <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
        <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
        <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
        <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
    <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
    <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
    <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span><span class="o">*</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span>
    <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="c1"># or &#39;#&#39;:</span>
        <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
        <span class="n">particles</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">moles</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">particles</span>        
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.convert_particles_to_molar">
    <p>def <span class="ident">convert_particles_to_molar</span>(</p><p>self, particles, mol_unit, compartment_volume)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts particle numbers to Molarity. 
particles=number of particles you want to convert
mol_unit=one of, 'fmol, pmol, nmol, umol, mmol or mol'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.convert_particles_to_molar', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.convert_particles_to_molar" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">convert_particles_to_molar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">particles</span><span class="p">,</span><span class="n">mol_unit</span><span class="p">,</span><span class="n">compartment_volume</span><span class="p">):</span><span class="c1">#,vol_unit):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts particle numbers to Molarity. </span>
<span class="sd">    particles=number of particles you want to convert</span>
<span class="sd">    mol_unit=one of, &#39;fmol, pmol, nmol, umol, mmol or mol&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mol_dct</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;fmol&#39;</span><span class="p">:</span><span class="mf">1e-15</span><span class="p">,</span>
        <span class="s1">&#39;pmol&#39;</span><span class="p">:</span><span class="mf">1e-12</span><span class="p">,</span>
        <span class="s1">&#39;nmol&#39;</span><span class="p">:</span><span class="mf">1e-9</span><span class="p">,</span>
        <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">mol&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
        <span class="s1">&#39;mmol&#39;</span><span class="p">:</span><span class="mf">1e-3</span><span class="p">,</span>
        <span class="s1">&#39;mol&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="s1">&#39;#&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)}</span>
    <span class="n">mol_unit_value</span><span class="o">=</span><span class="n">mol_dct</span><span class="p">[</span><span class="n">mol_unit</span><span class="p">]</span>
    <span class="n">avagadro</span><span class="o">=</span><span class="mf">6.02214179e+023</span>
    <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">avagadro</span><span class="o">*</span><span class="n">mol_unit_value</span><span class="o">*</span><span class="n">compartment_volume</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">:</span>
        <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol_unit</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
        <span class="n">molarity</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">molarity</span><span class="p">,</span><span class="mi">33</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_IC_cns">
    <p>def <span class="ident">get_IC_cns</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the xml segment for initial condition parameters.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_IC_cns', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_IC_cns" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_IC_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the xml segment for initial condition parameters. </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} is not a string but a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
            <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>  
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
            <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">molar</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">molar</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">compartment_vol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_all_model_variables">
    <p>def <span class="ident">get_all_model_variables</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>concatonate the output of the three functions that give model variables
Return list</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_all_model_variables', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_all_model_variables" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_all_model_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    concatonate the output of the three functions that give model variables</span>
<span class="sd">    Return list</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">g</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
    <span class="n">l</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
    <span class="n">p</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="o">**</span><span class="n">g</span><span class="p">)</span>
    <span class="n">p</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_all_params_dict_deprecated">
    <p>def <span class="ident">get_all_params_dict_deprecated</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns dict[parameter_name]=parameter_value for all local, 
global and IC parameters in copasi_file</p>
<p>Use get_all_model_variables</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_all_params_dict_deprecated', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_all_params_dict_deprecated" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_all_params_dict_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">    global and IC parameters in copasi_file</span>
<span class="sd">    </span>
<span class="sd">    Use get_all_model_variables</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
    <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
         <span class="n">now</span> <span class="n">format</span> <span class="n">the</span> <span class="n">local</span> <span class="n">parameters</span>
        <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
            <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">var_dct</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_all_params_dict_deprecated2">
    <p>def <span class="ident">get_all_params_dict_deprecated2</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns dict[parameter_name]=parameter_value for all local, 
global and IC parameters in copasi_file</p>
<p>get_all_model_variables</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_all_params_dict_deprecated2', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_all_params_dict_deprecated2" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_all_params_dict_deprecated2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns dict[parameter_name]=parameter_value for all local, </span>
<span class="sd">    global and IC parameters in copasi_file</span>
<span class="sd">    </span>
<span class="sd">    get_all_model_variables</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">var_dct</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
    <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;.*Values\[(.*)\]|.*Reactions\[(.*)\].*Parameter=(.*)|.*Metabolites\[(.*)\]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
         <span class="n">now</span> <span class="n">format</span> <span class="n">the</span> <span class="n">local</span> <span class="n">parameters</span>
        <span class="n">local</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">local</span><span class="o">=</span><span class="bp">True</span>
            <span class="n">local_param</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="n">local</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">var_dct</span><span class="p">[</span><span class="n">local_param</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_dct</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">var_dct</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_compartments">
    <p>def <span class="ident">get_compartments</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns a dict of compartments in your model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_compartments', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_compartments" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_compartments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a dict of compartments in your model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Compartment Sizes&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_experiment_files">
    <p>def <span class="ident">get_experiment_files</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get any parameter estimation data files that are defined 
within copasi parameter estimation task</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_experiment_files', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_experiment_files" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_experiment_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get any parameter estimation data files that are defined </span>
<span class="sd">    within copasi parameter estimation task</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;File Name&quot;]&#39;</span>
    <span class="n">files</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">files</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_fit_items">
    <p>def <span class="ident">get_fit_items</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>return all parameters that are present in the fit items of the
parameter estimation task</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_fit_items', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_fit_items" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    return all parameters that are present in the fit items of the</span>
<span class="sd">    parameter estimation task</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_global_kinetic_parameters_cns">
    <p>def <span class="ident">get_global_kinetic_parameters_cns</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the xml segment for global parameters that are used as
kinetic parameters.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_global_kinetic_parameters_cns', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_global_kinetic_parameters_cns" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_global_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the xml segment for global parameters that are used as</span>
<span class="sd">    kinetic parameters. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                    <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                    <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                    <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">][</span><span class="s1">&#39;mapping&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">l</span><span class="o">.</span><span class="n">text</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_global_quantities">
    <p>def <span class="ident">get_global_quantities</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns a dict of global quantities</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_global_quantities', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_global_quantities" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_global_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a dict of global quantities</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
    <span class="n">model_val_dct</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model_val_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">model_val_dct</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_global_quantities_cns">
    <p>def <span class="ident">get_global_quantities_cns</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the xml segment for global kinetic parameters.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_global_quantities_cns', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_global_quantities_cns" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_global_quantities_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the xml segment for global kinetic parameters. </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Global Quantities&quot;]&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;{} should be a string but is instead a {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
            <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
            <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_local_kinetic_parameters_cns">
    <p>def <span class="ident">get_local_kinetic_parameters_cns</span>(</p><p>self, names_only=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Get the xml segment for local kinetic parameters.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_local_kinetic_parameters_cns', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_local_kinetic_parameters_cns" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_local_kinetic_parameters_cns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">names_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the xml segment for local kinetic parameters. </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="nb">tuple</span><span class="p">),</span><span class="s1">&#39;get species regex hasn</span><span class="se">\&#39;</span><span class="s1">t been found. Do you have species in your model?&#39;</span>
                    <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="bp">None</span>
                    <span class="k">assert</span> <span class="n">match</span> <span class="o">!=</span><span class="p">[]</span>                
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span>
                    <span class="n">match</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">match</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_local_parameters">
    <p>def <span class="ident">get_local_parameters</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>return dict of local parameters used in your model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_local_parameters', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_local_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_local_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    return dict of local parameters used in your model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Kinetic Parameters&quot;]&#39;</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span>  <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*Parameter=(.*)&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                        <span class="k">return</span> <span class="bp">False</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span><span class="o">=</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">parameters</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_metabolites">
    <p>def <span class="ident">get_metabolites</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Deprecated. Use get_ICs_cns() inst
returns dict of metabolites in the 'species' menu</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_metabolites', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_metabolites" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_metabolites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deprecated. Use get_ICs_cns() inst</span>
<span class="sd">    returns dict of metabolites in the &#39;species&#39; menu</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">metab_dct</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;String=Initial Species Values&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*Vector=Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                            
            <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compartment_match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*)\],&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
                
                <span class="n">comp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Compartments\[(.*?)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">QuantityType</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compartments</span><span class="p">()[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">compartment_vol</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">{}</span>
                <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                <span class="n">concentration</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_particles_to_molar</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="n">compartment_vol</span><span class="p">)</span>
                <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">concentration</span>
                <span class="n">metab_dct</span><span class="p">[</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">compartment_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metab_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">NoMetabolitesError</span><span class="p">(</span><span class="s1">&#39;There are no metabolites in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_model_name</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">metab_dct</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_model_name">
    <p>def <span class="ident">get_model_name</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get model name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_model_name', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_model_name" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get model name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">name</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>            
    <span class="k">return</span> <span class="n">name</span>     
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_model_name_cn">
    <p>def <span class="ident">get_model_name_cn</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get reference to model name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_model_name_cn', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_model_name_cn" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_model_name_cn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get reference to model name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">first</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">string</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">first</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
    <span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_ascii</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Model=(.*),Vector=C&#39;</span><span class="p">,</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_quantity_units">
    <p>def <span class="ident">get_quantity_units</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get model quantity units (nM for example)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_quantity_units', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_quantity_units" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_quantity_units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get model quantity units (nM for example)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">quantity_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;quantityUnit&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">quantity_unit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_time_unit">
    <p>def <span class="ident">get_time_unit</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get model time units</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_time_unit', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_time_unit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_time_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get model time units</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">time_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;timeUnit&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">time_unit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.GetModelQuantities.get_volume_unit">
    <p>def <span class="ident">get_volume_unit</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get model volume units. ml for example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.GetModelQuantities.get_volume_unit', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.GetModelQuantities.get_volume_unit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_volume_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    get model volume units. ml for example</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@avogadroConstant]&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">vol_unit</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;volumeUnit&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">vol_unit</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.InsertParameters" class="name">class <span class="ident">InsertParameters</span></p>
      
  
    <div class="desc"><p>Insert parameters from a file, dictionary or a pandas dataframe into a copasi
file. </p>
<p>Positional Arguments:</p>
<div class="codehilite"><pre><span></span><span class="n">copasi_file</span><span class="o">:</span>
    <span class="n">The</span> <span class="n">copasi</span> <span class="n">file</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">enter</span> <span class="n">parameters</span> <span class="n">into</span>
</pre></div>


<p>**Kwargs
    Index:
        Index of parameter estimation run to input into the copasi file. 
        The index is ordered by rank of best fit, with 0 being the best.
        Default=0            </p>
<div class="codehilite"><pre><span></span><span class="n">QuantityType</span><span class="o">:</span>
    <span class="n">Either</span> <span class="s1">&#39;particle_number&#39;</span> <span class="n">or</span> <span class="s1">&#39;concentration&#39;</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;concentration&#39;</span>

<span class="n">ReportName</span><span class="o">;</span>
    <span class="n">Unused</span><span class="o">.</span> <span class="n">Delete</span><span class="o">?</span>

<span class="n">OutputML</span><span class="o">:</span>
    <span class="n">If</span> <span class="n">Save</span> <span class="kd">set</span> <span class="n">to</span> <span class="s1">&#39;duplicate&#39;</span><span class="o">,</span> <span class="k">this</span> <span class="k">is</span> <span class="n">the</span> <span class="n">duplicate</span> <span class="n">filename</span>

<span class="n">Save</span><span class="o">:</span>
    <span class="n">either</span> <span class="s1">&#39;false&#39;</span><span class="o">,</span><span class="s1">&#39;overwrite&#39;</span> <span class="n">or</span> <span class="s1">&#39;duplicate&#39;</span><span class="o">,</span><span class="k">default</span><span class="o">=</span><span class="n">overwrite</span>

<span class="n">ParameterDict</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">python</span> <span class="n">dictionary</span> <span class="k">with</span> <span class="n">keys</span> <span class="n">correponding</span> <span class="n">to</span> <span class="n">parameters</span> <span class="k">in</span> <span class="n">the</span> <span class="n">model</span>
    <span class="n">and</span> <span class="n">values</span> <span class="n">the</span> <span class="n">parameters</span> <span class="o">(</span><span class="n">dict</span><span class="o">[</span><span class="n">parameter_name</span><span class="o">]=</span><span class="n">parameter</span> <span class="n">value</span><span class="o">).</span> 
    <span class="n">Default</span><span class="o">=</span><span class="n">None</span>

<span class="n">DF</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">pandas</span> <span class="n">dataframe</span> <span class="k">with</span> <span class="n">parameters</span> <span class="n">being</span> <span class="n">column</span> <span class="n">names</span> <span class="n">matching</span> 
    <span class="n">parameters</span> <span class="k">in</span> <span class="n">your</span> <span class="n">model</span> <span class="n">and</span> <span class="n">RSS</span> <span class="n">values</span> <span class="n">and</span> <span class="n">rows</span> <span class="n">being</span> <span class="n">individual</span> 
    <span class="n">parameter</span> <span class="n">estimationruns</span><span class="o">.</span> <span class="n">In</span> <span class="k">this</span> <span class="k">case</span><span class="o">,</span> <span class="n">ensure</span> <span class="n">you</span> <span class="n">have</span> <span class="kd">set</span> <span class="n">the</span> 
    <span class="n">Index</span> <span class="n">parameter</span> <span class="n">to</span> <span class="n">the</span> <span class="n">index</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span> <span class="n">Dataframes</span> <span class="n">are</span> 
    <span class="n">automatically</span> <span class="n">sorted</span> <span class="n">by</span> <span class="n">the</span> <span class="n">RSS</span> <span class="n">column</span><span class="o">.</span>

<span class="n">ParameterPath</span><span class="o">:</span>
    <span class="n">Full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">a</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">file</span> <span class="o">(</span><span class="s1">&#39;.txt&#39;</span><span class="o">,</span><span class="s1">&#39;.xls&#39;</span><span class="o">,</span><span class="s1">&#39;.xlsx&#39;</span> <span class="n">or</span> 
    <span class="s1">&#39;.csv&#39;</span><span class="o">)</span> <span class="n">or</span> <span class="n">a</span> <span class="n">folder</span> <span class="n">containing</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">files</span><span class="o">.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">InsertParameters</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Insert parameters from a file, dictionary or a pandas dataframe into a copasi</span>
<span class="sd">    file. </span>
<span class="sd">    </span>
<span class="sd">    Positional Arguments:</span>
<span class="sd">    </span>
<span class="sd">        copasi_file:</span>
<span class="sd">            The copasi file you want to enter parameters into</span>
<span class="sd">    </span>
<span class="sd">    **Kwargs</span>
<span class="sd">        Index:</span>
<span class="sd">            Index of parameter estimation run to input into the copasi file. </span>
<span class="sd">            The index is ordered by rank of best fit, with 0 being the best.</span>
<span class="sd">            Default=0            </span>
<span class="sd">            </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            Either &#39;particle_number&#39; or &#39;concentration&#39;. Default=&#39;concentration&#39;</span>
<span class="sd">            </span>
<span class="sd">        ReportName;</span>
<span class="sd">            Unused. Delete?</span>
<span class="sd">            </span>
<span class="sd">        OutputML:</span>
<span class="sd">            If Save set to &#39;duplicate&#39;, this is the duplicate filename</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;,default=overwrite</span>
<span class="sd">            </span>
<span class="sd">        ParameterDict:</span>
<span class="sd">            A python dictionary with keys correponding to parameters in the model</span>
<span class="sd">            and values the parameters (dict[parameter_name]=parameter value). </span>
<span class="sd">            Default=None</span>
<span class="sd">            </span>
<span class="sd">        DF:</span>
<span class="sd">            A pandas dataframe with parameters being column names matching </span>
<span class="sd">            parameters in your model and RSS values and rows being individual </span>
<span class="sd">            parameter estimationruns. In this case, ensure you have set the </span>
<span class="sd">            Index parameter to the index you want to use. Dataframes are </span>
<span class="sd">            automatically sorted by the RSS column. </span>
<span class="sd">            </span>
<span class="sd">        ParameterPath:</span>
<span class="sd">            Full path to a parameter estimation file (&#39;.txt&#39;,&#39;.xls&#39;,&#39;.xlsx&#39; or </span>
<span class="sd">            &#39;.csv&#39;) or a folder containing parameter estimation files. </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        coapsi_file = file you want to insert</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Index: If not specified default to -1</span>
<span class="sd">                    can be int or list of ints</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>

        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Index&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;ParameterDict&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DF&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;ParameterPath&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 
                 <span class="p">}</span>
                     
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for InsertParameters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
<span class="c1">#        assert os.path.exists(self.parameter_path),&#39;{} doesn\&#39;t exist&#39;.format(self.parameter_path)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Argument to </span><span class="se">\&#39;</span><span class="s1">ParameterDict</span><span class="se">\&#39;</span><span class="s1"> keyword needs to be of type dict&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Parameter </span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> is not in your model. </span><span class="se">\n\n</span><span class="s1">These are in your model:</span><span class="se">\n</span><span class="s1">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to give at least one of ParameterDict,ParameterPath or DF keyword arguments&#39;</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">)</span>
                
            
        <span class="c1">#make sure user gives the right number of arguments</span>
        <span class="n">num</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">num</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to supply exactly one of ParameterDict,ParameterPath or df keyord argument. You cannot give two or three.&#39;</span><span class="p">)</span>
        
<span class="c1">#        self.check_parameter_consistancy()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_gl_and_lt</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_all</span><span class="p">()</span>
        <span class="c1">#change</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">check_parameter_consistancy_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        raise an error if no parameters in the PE header match </span>
<span class="sd">        parameters in model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">Please check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">check_parameter_consistancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        raise an error if no parameters in the PE header match </span>
<span class="sd">        parameters in model</span>
<span class="sd">        </span>
<span class="sd">        args:</span>
<span class="sd">            df:</span>
<span class="sd">                containing parameters to compare with parameters</span>
<span class="sd">                in the model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">Please check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>            
            
    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get parameters depending on the type of input. </span>
<span class="sd">        Converge on a pandas dataframe. </span>
<span class="sd">        Columns = parameters, rows = parameter sets</span>
<span class="sd">        </span>
<span class="sd">        Use check parameter consistency to see</span>
<span class="sd">        whether headers have been pruned or not. If not try pruning them</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">),</span><span class="s1">&#39;The ParameterDict argument takes a Python dictionary&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a parameter. These are your parameters:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">PED</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">ParsePEData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">insert_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#first isolate the local parameters </span>
        <span class="n">local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span> <span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                    
    <span class="k">def</span> <span class="nf">insert_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">insert_ICs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">IC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC</span><span class="p">:</span>
            <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                        <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">convert_molar_to_particles</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="nb">float</span><span class="p">(</span><span class="n">IC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]))</span><span class="c1">#,self.GMQ.get_volume_unit())</span>
<span class="c1">##                        particles=self.parameters[i]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                        <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>



    <span class="k">def</span> <span class="nf">insert_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        insert parameters into fit items</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;OptimizationItemList&#39;]&quot;</span>
        <span class="n">ICs_and_global</span><span class="o">=</span><span class="bp">None</span>
        <span class="n">reaction</span><span class="o">=</span><span class="bp">None</span>
        <span class="n">parameter</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                        <span class="n">pattern1</span><span class="o">=</span><span class="s1">&#39;Vector=(?!Reactions).*\[(.*)\]&#39;</span><span class="c1">#match global and IC parameters but not local</span>
                        <span class="n">search1</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        
                        <span class="k">if</span> <span class="n">search1</span> <span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">ICs_and_global</span><span class="o">=</span><span class="n">search1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">ICs_and_global</span><span class="p">]))</span>
                    <span class="c1">#now again for local parameters</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                        <span class="n">pattern2</span><span class="o">=</span><span class="s1">&#39;Vector=Reactions\[(.*)\].*Parameter=(.*),&#39;</span>
                        <span class="n">search2</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">search2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="o">=</span> <span class="n">search2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">local</span><span class="o">=</span> <span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">reaction</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">local</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">local</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">continue</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">get_current_parameters_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Deprecated. Just use self.GMQ.get_all_model_variables()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
        


    <span class="k">def</span> <span class="nf">replace_gl_and_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        replace greater than and less than symbols for XML purposes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">i</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&lt;&#39;</span><span class="p">)</span>
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&gt;&#39;</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
            
        
    <span class="k">def</span> <span class="nf">insert_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_locals</span><span class="p">()</span>
<span class="c1">#        self.save() </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_global</span><span class="p">()</span>
<span class="c1">#        self.save()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_ICs</span><span class="p">()</span>
<span class="c1">#        self.save()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.InsertParameters">InsertParameters</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.InsertParameters.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.InsertParameters.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.InsertParameters.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.InsertParameters.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.InsertParameters.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.InsertParameters.parameters" class="name">var <span class="ident">parameters</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>coapsi_file = file you want to insert
kwargs:
    Index: If not specified default to -1
            can be int or list of ints</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    coapsi_file = file you want to insert</span>
<span class="sd">    kwargs:</span>
<span class="sd">        Index: If not specified default to -1</span>
<span class="sd">                can be int or list of ints</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
             <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Index&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
             <span class="s1">&#39;ParameterDict&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;DF&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;ParameterPath&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             
             <span class="p">}</span>
                 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for InsertParameters&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    
     <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span><span class="p">),</span><span class="s1">&#39;{} doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_path</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Argument to </span><span class="se">\&#39;</span><span class="s1">ParameterDict</span><span class="se">\&#39;</span><span class="s1"> keyword needs to be of type dict&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Parameter </span><span class="se">\&#39;</span><span class="s1">{}</span><span class="se">\&#39;</span><span class="s1"> is not in your model. </span><span class="se">\n\n</span><span class="s1">These are in your model:</span><span class="se">\n</span><span class="s1">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to give at least one of ParameterDict,ParameterPath or DF keyword arguments&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">)</span>
            
        
    <span class="c1">#make sure user gives the right number of arguments</span>
    <span class="n">num</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">num</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;You need to supply exactly one of ParameterDict,ParameterPath or df keyord argument. You cannot give two or three.&#39;</span><span class="p">)</span>
    
     <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>   
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_gl_and_lt</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">insert_all</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.check_parameter_consistancy">
    <p>def <span class="ident">check_parameter_consistancy</span>(</p><p>self, df)</p>
    </div>
    

    
  
    <div class="desc"><p>raise an error if no parameters in the PE header match 
parameters in model</p>
<p>args:
    df:
        containing parameters to compare with parameters
        in the model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.check_parameter_consistancy', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.check_parameter_consistancy" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">check_parameter_consistancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    raise an error if no parameters in the PE header match </span>
<span class="sd">    parameters in model</span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        df:</span>
<span class="sd">            containing parameters to compare with parameters</span>
<span class="sd">            in the model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">se check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>            
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.check_parameter_consistancy_deprecated">
    <p>def <span class="ident">check_parameter_consistancy_deprecated</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>raise an error if no parameters in the PE header match 
parameters in model</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.check_parameter_consistancy_deprecated', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.check_parameter_consistancy_deprecated" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">check_parameter_consistancy_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    raise an error if no parameters in the PE header match </span>
<span class="sd">    parameters in model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">model_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">input_parameter_names</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">intersection</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">model_parameter_names</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">input_parameter_names</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">intersection</span><span class="o">==</span><span class="p">[]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;The parameters in your parameter estimation data are not in your model.</span><span class="se">\</span>
<span class="s1">se check the headers of your PE data are consistent with your model parameter names.&#39;&#39;&#39;</span> <span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.get_current_parameters_deprecated">
    <p>def <span class="ident">get_current_parameters_deprecated</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Deprecated. Just use self.GMQ.get_all_model_variables()</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.get_current_parameters_deprecated', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.get_current_parameters_deprecated" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_current_parameters_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deprecated. Just use self.GMQ.get_all_model_variables()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.get_parameters">
    <p>def <span class="ident">get_parameters</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Get parameters depending on the type of input. 
Converge on a pandas dataframe. 
Columns = parameters, rows = parameter sets</p>
<p>Use check parameter consistency to see
whether headers have been pruned or not. If not try pruning them</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.get_parameters', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.get_parameters" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get parameters depending on the type of input. </span>
<span class="sd">    Converge on a pandas dataframe. </span>
<span class="sd">    Columns = parameters, rows = parameter sets</span>
<span class="sd">    </span>
<span class="sd">    Use check parameter consistency to see</span>
<span class="sd">    whether headers have been pruned or not. If not try pruning them</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="nb">dict</span><span class="p">),</span><span class="s1">&#39;The ParameterDict argument takes a Python dictionary&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a parameter. These are your parameters:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterDict&#39;</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">PED</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">ParsePEData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ParameterPath&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="n">PED</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DF&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">:</span>
        <span class="n">df</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistancy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.insert_ICs">
    <p>def <span class="ident">insert_ICs</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.insert_ICs', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.insert_ICs" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_ICs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">IC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC</span><span class="p">:</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">convert_molar_to_particles</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">(),</span><span class="nb">float</span><span class="p">(</span><span class="n">IC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;compartment_volume&#39;</span><span class="p">]))</span><span class="c1">#,self.GMQ.get_volume_unit())</span>
                      <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">particles</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.insert_all">
    <p>def <span class="ident">insert_all</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.insert_all', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.insert_all" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_locals</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_global</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_ICs</span><span class="p">()</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_fit_items</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.insert_fit_items">
    <p>def <span class="ident">insert_fit_items</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>insert parameters into fit items</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.insert_fit_items', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.insert_fit_items" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    insert parameters into fit items</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;OptimizationItemList&#39;]&quot;</span>
    <span class="n">ICs_and_global</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">reaction</span><span class="o">=</span><span class="bp">None</span>
    <span class="n">parameter</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">pattern1</span><span class="o">=</span><span class="s1">&#39;Vector=(?!Reactions).*\[(.*)\]&#39;</span><span class="c1">#match global and IC parameters but not local</span>
                    <span class="n">search1</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern1</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    
                    <span class="k">if</span> <span class="n">search1</span> <span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">ICs_and_global</span><span class="o">=</span><span class="n">search1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ICs_and_global</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">ICs_and_global</span><span class="p">]))</span>
                <span class="c1">#now again for local parameters</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">pattern2</span><span class="o">=</span><span class="s1">&#39;Vector=Reactions\[(.*)\].*Parameter=(.*),&#39;</span>
                    <span class="n">search2</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern2</span><span class="p">,</span><span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">search2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="o">=</span> <span class="n">search2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">local</span><span class="o">=</span> <span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span><span class="n">parameter</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StartValue&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">reaction</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">parameter</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">local</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">local</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.insert_global">
    <p>def <span class="ident">insert_global</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.insert_global', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.insert_global" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">glob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">:</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.insert_locals">
    <p>def <span class="ident">insert_locals</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.insert_locals', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.insert_locals" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_locals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#first isolate the local parameters </span>
    <span class="n">local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local</span><span class="p">:</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@cn=&quot;{}&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span> <span class="n">query</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.replace_gl_and_lt">
    <p>def <span class="ident">replace_gl_and_lt</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>replace greater than and less than symbols for XML purposes</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.replace_gl_and_lt', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.replace_gl_and_lt" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">replace_gl_and_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    replace greater than and less than symbols for XML purposes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">i</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&lt;&#39;</span><span class="p">)</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;\&gt;&#39;</span><span class="p">)</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.InsertParameters.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.InsertParameters.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.InsertParameters.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.ParameterEstimation" class="name">class <span class="ident">ParameterEstimation</span></p>
      
  
    <div class="desc"><p>Set up and run a parameter estimation in copasi. Since each parameter estimation
    problem is different, this process cannot be done in a single line of code. 
    Instead the user should initialize an instance of the ParameterEstimation 
    class with all the relevant keyword arguments. Subsequently use the 
    write_item_template() method and modify the resulting xlsx in your copasi file
    directory. Save the file then close and run the set_up() method to define your
    optimization problem. When Run is set to 'true', the parameter estimation will
    automatically run in CopasiSE. If Plot is also set to 'true', a plot comparing 
    experimental and simulated profiles are produced. Profiles are saved
    to file with SaveFig='true'</p>
<div class="codehilite"><pre><span></span><span class="n">args</span><span class="o">:</span>

    <span class="n">copasi_file</span><span class="o">:</span> 
        <span class="n">The</span> <span class="n">file</span> <span class="n">path</span> <span class="k">for</span> <span class="n">the</span> <span class="n">copasi</span> <span class="n">file</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">on</span>

    <span class="n">experiment_files</span><span class="o">:</span>
        <span class="n">Either</span> <span class="n">a</span> <span class="n">single</span> <span class="n">experiment</span> <span class="n">file</span> <span class="n">path</span> <span class="n">or</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">experiment</span> <span class="n">file</span> <span class="n">paths</span>

<span class="o">**</span><span class="n">Kwargs</span><span class="o">:</span>

    <span class="n">Metabolites</span><span class="o">:</span>
        <span class="n">Which</span> <span class="n">metabolites</span> <span class="o">(</span><span class="n">ICs</span><span class="o">)</span> <span class="n">to</span> <span class="k">include</span> <span class="k">in</span> <span class="n">parameter</span> <span class="n">esitmation</span><span class="o">.</span> <span class="n">Default</span> <span class="o">=</span> <span class="n">all</span> <span class="n">of</span> <span class="n">them</span><span class="o">.</span>

    <span class="n">GlobalQuantities</span><span class="o">:</span>
        <span class="n">Which</span> <span class="n">global</span> <span class="n">values</span> <span class="n">to</span> <span class="k">include</span> <span class="k">in</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">estimation</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span> <span class="n">all</span>

    <span class="n">QuantityType</span><span class="o">:</span>
        <span class="n">either</span> <span class="s1">&#39;concentration&#39;</span> <span class="n">or</span> <span class="n">particle</span> <span class="n">numbers</span>

    <span class="n">ReportName</span><span class="o">:</span>
        <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">output</span> <span class="n">report</span>

    <span class="n">Append</span><span class="o">:</span>
        <span class="n">Append</span> <span class="n">to</span> <span class="n">report</span> <span class="n">or</span> <span class="n">not</span><span class="o">,</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span>

    <span class="n">ConfirmOverwrite</span><span class="o">:</span>
        <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">,</span> <span class="n">overwrite</span> <span class="n">report</span> <span class="n">or</span> <span class="n">not</span>

    <span class="n">ItemTemplateFilename</span><span class="o">:</span>
        <span class="n">Filename</span> <span class="k">for</span> <span class="n">the</span> <span class="n">fitItem</span> <span class="n">template</span>

    <span class="n">OverwriteItemTemplate</span><span class="o">:,</span>
        <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">,</span> <span class="n">overwrite</span> <span class="n">the</span> <span class="n">template</span> <span class="k">each</span> <span class="n">time</span> <span class="n">program</span> <span class="k">is</span> <span class="n">run</span>

    <span class="n">UpdateModel</span><span class="o">:</span>
        <span class="n">Update</span> <span class="n">model</span> <span class="n">parameters</span> <span class="n">after</span> <span class="n">parameter</span> <span class="n">estimation</span>

    <span class="n">RandomizeStartValues</span><span class="o">:</span>
        <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">randomize</span> <span class="n">start</span> <span class="n">values</span> <span class="n">box</span> <span class="n">or</span> <span class="n">not</span><span class="o">.</span> <span class="n">Default</span> <span class="s1">&#39;true&#39;</span>

    <span class="n">CreateParameterSets</span><span class="o">:</span>
        <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">create</span> <span class="n">parameter</span> <span class="n">sets</span> <span class="n">box</span> <span class="n">or</span> <span class="n">not</span><span class="o">.</span> <span class="n">Default</span> <span class="s1">&#39;false&#39;</span>

    <span class="n">CalculateStatistics</span><span class="s1">&#39;:str(1),</span>
<span class="s1">        &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39;. Check the calcualte statistics box or not. Default &#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">    Method:</span>
<span class="s1">        Name of one of the copasi parameter estimation algorithms. Valid arguments: </span>
<span class="s1">        [&#39;</span><span class="n">CurrentSolutionStatistics</span><span class="s1">&#39;,&#39;</span><span class="n">DifferentialEvolution</span><span class="s1">&#39;,&#39;</span><span class="n">EvolutionaryStrategySR</span><span class="s1">&#39;,&#39;</span><span class="n">EvolutionaryProgram</span><span class="s1">&#39;,</span>
<span class="s1">         &#39;</span><span class="n">HookeJeeves</span><span class="s1">&#39;,&#39;</span><span class="n">LevenbergMarquardt</span><span class="s1">&#39;,&#39;</span><span class="n">NelderMead</span><span class="s1">&#39;,&#39;</span><span class="n">ParticleSwarm</span><span class="s1">&#39;,&#39;</span><span class="n">Praxis</span><span class="s1">&#39;,</span>
<span class="s1">         &#39;</span><span class="n">RandomSearch</span><span class="s1">&#39;,&#39;</span><span class="n">ScatterSearch</span><span class="s1">&#39;,&#39;</span><span class="n">SimulatedAnnealing</span><span class="s1">&#39;,&#39;</span><span class="n">SteepestDescent</span><span class="s1">&#39;,</span>
<span class="s1">         &#39;</span><span class="n">TruncatedNewton</span><span class="s1">&#39;,&#39;</span><span class="n">GeneticAlgorithm</span><span class="s1">&#39;,&#39;</span><span class="n">GeneticAlgorithmSR</span><span class="s1">&#39;],</span>
<span class="s1">         Default=GeneticAlgorithm</span>

<span class="s1">    NumberOfGenerations:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=200</span>

<span class="s1">    PopulationSize:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=50</span>

<span class="s1">    RandomNumberGenerator:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=1</span>

<span class="s1">    Seed:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0</span>

<span class="s1">    Pf:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0.475</span>

<span class="s1">    IterationLimit:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=50</span>

<span class="s1">    Tolerance:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0.00001</span>

<span class="s1">    Rho;</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0.2</span>

<span class="s1">    Scale:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=10</span>

<span class="s1">    SwarmSize:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=50</span>

<span class="s1">    StdDeviation:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0.000001</span>

<span class="s1">    NumberOfIterations:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=100000</span>

<span class="s1">    StartTemperature:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=1</span>

<span class="s1">    CoolingFactor:</span>
<span class="s1">        A parameter for parameter estimation algorithms. Default=0.85</span>

<span class="s1">    RowOrientation:</span>
<span class="s1">        1 means data is row oriented, 0 means its column oriented</span>

<span class="s1">    ExperimentType:</span>
<span class="s1">        List with the same number elements as you have experiment files. Each element</span>
<span class="s1">        is either &#39;</span><span class="n">timecourse</span><span class="s1">&#39; or &#39;</span><span class="n">steady_state</span><span class="s1">&#39; and describes the type of </span>
<span class="s1">        data at that element in the experiment_files argument</span>

<span class="s1">    FirstRow:</span>
<span class="s1">        List with the same number elements as you have experiment files. Each element</span>
<span class="s1">        is the starting line for data as an integer. Default is a list of 1&#39;</span><span class="n">s</span> <span class="n">and</span> <span class="k">this</span>
        <span class="n">rarely</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span> <span class="n">changed</span><span class="o">.</span>

    <span class="n">NormalizeWeightsPerExperiment</span><span class="s1">&#39;:[&#39;</span><span class="kc">true</span><span class="s1">&#39;]*len(self.experiment_files),</span>
<span class="s1">        List with the same number elements as you have experiment files. Each element</span>
<span class="s1">        is &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39; and correlates to ticking the</span>
<span class="s1">        normalize wieghts per experiment box in the copasi gui. Default [true]*len(experiments)</span>

<span class="s1">    RowContainingNames:</span>
<span class="s1">        List with the same number elements as you have experiment files. Each element</span>
<span class="s1">        is an integer value corresponding to the row in the data containing names. The default</span>
<span class="s1">        is 1 for all experiment files [1]*len(experiment_files)</span>


<span class="s1">    Separator&#39;</span><span class="o">:[</span><span class="s1">&#39;   &#39;</span><span class="o">]*</span><span class="n">len</span><span class="o">(</span><span class="n">self</span><span class="o">.</span><span class="na">experiment_files</span><span class="o">),</span>
        <span class="n">List</span> <span class="k">with</span> <span class="n">the</span> <span class="n">same</span> <span class="n">number</span> <span class="n">elements</span> <span class="k">as</span> <span class="n">you</span> <span class="n">have</span> <span class="n">experiment</span> <span class="n">files</span><span class="o">.</span> <span class="n">Each</span> <span class="n">element</span>
        <span class="k">is</span> <span class="n">the</span> <span class="n">separator</span> <span class="n">used</span> <span class="k">in</span> <span class="n">the</span> <span class="n">data</span> <span class="n">files</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="n">a</span> <span class="n">tab</span> <span class="o">(\</span><span class="n">t</span><span class="o">)</span> <span class="k">for</span> <span class="n">all</span> <span class="n">files</span> 
        <span class="n">though</span> <span class="n">commas</span> <span class="n">are</span> <span class="n">also</span> <span class="n">common</span>

    <span class="n">WeightMethod</span><span class="s1">&#39;:[&#39;</span><span class="n">mean_squared</span><span class="s1">&#39;]*len(self.experiment_files),</span>
<span class="s1">        List with the same number elements as you have experiment files. Each element</span>
<span class="s1">        is a list of the name of the normalization algorithm to use for that data set. </span>
<span class="s1">        This should probably be the same for each experiment file and defaults to mean_squared. </span>
<span class="s1">        Options are: [&#39;</span><span class="n">mean</span><span class="s1">&#39;,&#39;</span><span class="n">mean_squared</span><span class="s1">&#39;,&#39;</span><span class="n">stardard_deviation</span><span class="s1">&#39;,&#39;</span><span class="n">value_scaling</span><span class="s1">&#39;]</span>

<span class="s1">    Save: </span>
<span class="s1">        One of &#39;</span><span class="kc">false</span><span class="s1">&#39;,&#39;</span><span class="n">duplicate</span><span class="s1">&#39; or &#39;</span><span class="n">overwrite</span><span class="s1">&#39;. If duplicate, use the name in </span>
<span class="s1">        the keyword argument OutputML to save the file.</span>

<span class="s1">    OutputML:</span>
<span class="s1">        When Save is set to &#39;</span><span class="n">duplicate</span><span class="s1">&#39;, this is the new name of the cps file</span>

<span class="s1">    PruneHeaders:</span>
<span class="s1">        Copasi uses references to distinguish between variable types. The report</span>
<span class="s1">        output usually contains these references in variable names. &#39;</span><span class="kc">true</span><span class="s1">&#39; removes </span>
<span class="s1">        the references while &#39;</span><span class="kc">false</span><span class="s1">&#39; leaves them in. </span>
<span class="s1">    Scheduled&#39;</span><span class="o">:</span><span class="s1">&#39;false&#39;</span>
        <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">.</span> <span class="n">Check</span> <span class="n">the</span> <span class="n">box</span> <span class="n">called</span> <span class="s1">&#39;executable&#39;</span> <span class="k">in</span> <span class="n">the</span> <span class="n">top</span> <span class="n">right</span> <span class="n">hand</span>
        <span class="n">corner</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Copasi</span> <span class="n">GUI</span><span class="o">.</span> <span class="n">This</span> <span class="n">tells</span> <span class="n">Copasi</span> <span class="n">to</span> <span class="n">shedule</span> <span class="n">a</span> <span class="n">parameter</span> <span class="n">estimation</span> 
        <span class="n">task</span> <span class="n">when</span> <span class="n">using</span> <span class="n">CopasiSE</span><span class="o">.</span> <span class="n">This</span> <span class="n">should</span> <span class="n">be</span> <span class="s1">&#39;true&#39;</span> <span class="n">of</span> <span class="n">you</span> <span class="n">are</span> <span class="n">running</span> <span class="n">a</span> <span class="n">parameter</span>
        <span class="n">estimation</span> <span class="n">from</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">task</span> <span class="n">via</span> <span class="n">the</span> <span class="n">pycopi</span> <span class="n">but</span> <span class="s1">&#39;false&#39;</span> <span class="n">when</span> <span class="n">you</span> 
        <span class="n">want</span> <span class="n">to</span> <span class="kd">set</span> <span class="n">up</span> <span class="n">a</span> <span class="n">repeat</span> <span class="n">item</span> <span class="k">in</span> <span class="n">the</span> <span class="n">scan</span> <span class="n">task</span> <span class="k">with</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">subtask</span>

    <span class="n">UseTemplateStartValues</span><span class="o">:</span>
        <span class="n">Default</span> <span class="kd">set</span> <span class="n">to</span> <span class="s1">&#39;false&#39;</span><span class="o">.</span> <span class="n">Determines</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">starting</span> <span class="n">parameters</span> 
        <span class="n">from</span> <span class="n">within</span> <span class="n">the</span> <span class="n">fitItemTemplate</span><span class="o">.</span><span class="na">xlsx</span> <span class="n">are</span> <span class="n">use</span> <span class="k">for</span> <span class="n">starting</span> <span class="n">values</span>
        <span class="k">in</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">estimation</span> <span class="n">or</span> <span class="n">not</span>

    <span class="n">LowerBound</span><span class="o">:</span>
        <span class="n">Value</span> <span class="n">of</span> <span class="n">the</span> <span class="k">default</span> <span class="n">lower</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">the</span> <span class="n">FitItemTemplate</span><span class="o">.</span> <span class="n">Default</span> <span class="mf">0.000001</span>

    <span class="n">UpperBound</span><span class="o">:</span>
        <span class="n">Value</span> <span class="n">of</span> <span class="k">default</span> <span class="n">upper</span> <span class="n">bound</span> <span class="k">for</span> <span class="n">FitItemTemplate</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mi">1000000</span>
</pre></div>


<h1>Run:</h1>
<h1>Run the parameter estimation using CopasiSE. When running via the parameter</h1>
<h1>estimation task, the output is a matrix of function evaluation progression over</h1>
<h1>time. When running via the scan's repeat task, output is lines of parameter</h1>
<h1>estimation runs</h1>
<div class="codehilite"><pre><span></span>    Plot:
        Whether to plot result or not. Defualt=&#39;true&#39;

    FontSize:
        Control graph label font size

    AxisSize:
        Control graph axis font size

    ExtraTitle:
        When SaveFig=&#39;true&#39;, given the saved
        file an extra label in the file path

    LineWidth:
        Control graph LineWidth

    DotSize:
        How big to plot the dots on the graph

    SaveFig:
        Save graphs to file labelled after the index


    TitleWrapSize:
        When graph titles are long, how many characters to have per 
        line before word wrap. Default=30.

    Show:
        When not using iPython, use Show=&#39;true&#39; to display graphs

    Ylimit: default==None, restrict amount of data shown on y axis. 
    Useful for honing in on small confidence intervals

    Xlimit: default==None, restrict amount of data shown on x axis. 
    Useful for honing in on small confidence intervals

    DPI:
        How big saved figure should be. Default=125

    XTickRotation:
        How many degrees to rotate the X tick labels
        of the output. Useful if you have very small or large
        numbers that overlay when plotting.
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ParameterEstimation</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set up and run a parameter estimation in copasi. Since each parameter estimation</span>
<span class="sd">    problem is different, this process cannot be done in a single line of code. </span>
<span class="sd">    Instead the user should initialize an instance of the ParameterEstimation </span>
<span class="sd">    class with all the relevant keyword arguments. Subsequently use the </span>
<span class="sd">    write_item_template() method and modify the resulting xlsx in your copasi file</span>
<span class="sd">    directory. Save the file then close and run the set_up() method to define your</span>
<span class="sd">    optimization problem. When Run is set to &#39;true&#39;, the parameter estimation will</span>
<span class="sd">    automatically run in CopasiSE. If Plot is also set to &#39;true&#39;, a plot comparing </span>
<span class="sd">    experimental and simulated profiles are produced. Profiles are saved</span>
<span class="sd">    to file with SaveFig=&#39;true&#39;</span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        </span>
<span class="sd">        copasi_file: </span>
<span class="sd">            The file path for the copasi file you want to perform parameter estimation on</span>
<span class="sd">            </span>
<span class="sd">        experiment_files:</span>
<span class="sd">            Either a single experiment file path or a list of experiment file paths </span>
<span class="sd">            </span>
<span class="sd">    **Kwargs:</span>
<span class="sd">        </span>
<span class="sd">        Metabolites:</span>
<span class="sd">            Which metabolites (ICs) to include in parameter esitmation. Default = all of them. </span>
<span class="sd">            </span>
<span class="sd">        GlobalQuantities:</span>
<span class="sd">            Which global values to include in the parameter estimation. Default= all</span>
<span class="sd">        </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            either &#39;concentration&#39; or particle numbers</span>

<span class="sd">        ReportName:</span>
<span class="sd">            name of the output report</span>
<span class="sd">            </span>
<span class="sd">        Append:</span>
<span class="sd">            Append to report or not,&#39;true&#39; or &#39;false&#39;</span>

<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, overwrite report or not</span>
<span class="sd">            </span>
<span class="sd">        ItemTemplateFilename:</span>
<span class="sd">            Filename for the fitItem template</span>
<span class="sd">            </span>
<span class="sd">        OverwriteItemTemplate:,</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, overwrite the template each time program is run</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Update model parameters after parameter estimation</span>

<span class="sd">        RandomizeStartValues:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the randomize start values box or not. Default &#39;true&#39;</span>

<span class="sd">        CreateParameterSets:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the create parameter sets box or not. Default &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        CalculateStatistics&#39;:str(1),</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the calcualte statistics box or not. Default &#39;false&#39;</span>

<span class="sd">        Method:</span>
<span class="sd">            Name of one of the copasi parameter estimation algorithms. Valid arguments: </span>
<span class="sd">            [&#39;CurrentSolutionStatistics&#39;,&#39;DifferentialEvolution&#39;,&#39;EvolutionaryStrategySR&#39;,&#39;EvolutionaryProgram&#39;,</span>
<span class="sd">             &#39;HookeJeeves&#39;,&#39;LevenbergMarquardt&#39;,&#39;NelderMead&#39;,&#39;ParticleSwarm&#39;,&#39;Praxis&#39;,</span>
<span class="sd">             &#39;RandomSearch&#39;,&#39;ScatterSearch&#39;,&#39;SimulatedAnnealing&#39;,&#39;SteepestDescent&#39;,</span>
<span class="sd">             &#39;TruncatedNewton&#39;,&#39;GeneticAlgorithm&#39;,&#39;GeneticAlgorithmSR&#39;],</span>
<span class="sd">             Default=GeneticAlgorithm</span>

<span class="sd">        NumberOfGenerations:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=200</span>

<span class="sd">        PopulationSize:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        RandomNumberGenerator:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=1</span>

<span class="sd">        Seed:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0</span>

<span class="sd">        Pf:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.475</span>

<span class="sd">        IterationLimit:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        Tolerance:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.00001</span>

<span class="sd">        Rho;</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.2</span>

<span class="sd">        Scale:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=10</span>

<span class="sd">        SwarmSize:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=50</span>

<span class="sd">        StdDeviation:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.000001</span>

<span class="sd">        NumberOfIterations:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=100000</span>

<span class="sd">        StartTemperature:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=1</span>

<span class="sd">        CoolingFactor:</span>
<span class="sd">            A parameter for parameter estimation algorithms. Default=0.85</span>

<span class="sd">        RowOrientation:</span>
<span class="sd">            1 means data is row oriented, 0 means its column oriented</span>
<span class="sd">                         </span>
<span class="sd">        ExperimentType:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is either &#39;timecourse&#39; or &#39;steady_state&#39; and describes the type of </span>
<span class="sd">            data at that element in the experiment_files argument </span>

<span class="sd">        FirstRow:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is the starting line for data as an integer. Default is a list of 1&#39;s and this</span>
<span class="sd">            rarely needs to be changed.</span>
<span class="sd">            </span>
<span class="sd">        NormalizeWeightsPerExperiment&#39;:[&#39;true&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is &#39;true&#39; or &#39;false&#39; and correlates to ticking the</span>
<span class="sd">            normalize wieghts per experiment box in the copasi gui. Default [true]*len(experiments)</span>
<span class="sd">            </span>
<span class="sd">        RowContainingNames:</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is an integer value corresponding to the row in the data containing names. The default</span>
<span class="sd">            is 1 for all experiment files [1]*len(experiment_files)</span>
<span class="sd">                        </span>

<span class="sd">        Separator&#39;:[&#39;\t&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is the separator used in the data files. Defaults to a tab (\\t) for all files </span>
<span class="sd">            though commas are also common</span>
<span class="sd">            </span>
<span class="sd">        WeightMethod&#39;:[&#39;mean_squared&#39;]*len(self.experiment_files),</span>
<span class="sd">            List with the same number elements as you have experiment files. Each element</span>
<span class="sd">            is a list of the name of the normalization algorithm to use for that data set. </span>
<span class="sd">            This should probably be the same for each experiment file and defaults to mean_squared. </span>
<span class="sd">            Options are: [&#39;mean&#39;,&#39;mean_squared&#39;,&#39;stardard_deviation&#39;,&#39;value_scaling&#39;]</span>
<span class="sd">            </span>
<span class="sd">        Save: </span>
<span class="sd">            One of &#39;false&#39;,&#39;duplicate&#39; or &#39;overwrite&#39;. If duplicate, use the name in </span>
<span class="sd">            the keyword argument OutputML to save the file.</span>

<span class="sd">        OutputML:</span>
<span class="sd">            When Save is set to &#39;duplicate&#39;, this is the new name of the cps file</span>
<span class="sd">        </span>
<span class="sd">        PruneHeaders:</span>
<span class="sd">            Copasi uses references to distinguish between variable types. The report</span>
<span class="sd">            output usually contains these references in variable names. &#39;true&#39; removes </span>
<span class="sd">            the references while &#39;false&#39; leaves them in. </span>
<span class="sd">        Scheduled&#39;:&#39;false&#39;</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Check the box called &#39;executable&#39; in the top right hand</span>
<span class="sd">            corner of the Copasi GUI. This tells Copasi to shedule a parameter estimation </span>
<span class="sd">            task when using CopasiSE. This should be &#39;true&#39; of you are running a parameter</span>
<span class="sd">            estimation from the parameter estimation task via the pycopi but &#39;false&#39; when you </span>
<span class="sd">            want to set up a repeat item in the scan task with the parameter estimation subtask</span>
<span class="sd">            </span>
<span class="sd">        UseTemplateStartValues:</span>
<span class="sd">            Default set to &#39;false&#39;. Determines whether the starting parameters </span>
<span class="sd">            from within the fitItemTemplate.xlsx are use for starting values</span>
<span class="sd">            in the parameter estimation or not</span>
<span class="sd">                 </span>
<span class="sd">        LowerBound:</span>
<span class="sd">            Value of the default lower bound for the FitItemTemplate. Default 0.000001</span>
<span class="sd">        </span>
<span class="sd">        UpperBound:</span>
<span class="sd">            Value of default upper bound for FitItemTemplate. Default=1000000</span>
<span class="sd">            </span>
<span class="sd">#        Run:</span>
<span class="sd">#            Run the parameter estimation using CopasiSE. When running via the parameter</span>
<span class="sd">#            estimation task, the output is a matrix of function evaluation progression over</span>
<span class="sd">#            time. When running via the scan&#39;s repeat task, output is lines of parameter</span>
<span class="sd">#            estimation runs</span>
<span class="sd">            </span>
<span class="sd">        Plot:</span>
<span class="sd">            Whether to plot result or not. Defualt=&#39;true&#39;</span>
<span class="sd">            </span>
<span class="sd">        FontSize:</span>
<span class="sd">            Control graph label font size</span>

<span class="sd">        AxisSize:</span>
<span class="sd">            Control graph axis font size</span>

<span class="sd">        ExtraTitle:</span>
<span class="sd">            When SaveFig=&#39;true&#39;, given the saved</span>
<span class="sd">            file an extra label in the file path</span>

<span class="sd">        LineWidth:</span>
<span class="sd">            Control graph LineWidth</span>
<span class="sd">            </span>
<span class="sd">        DotSize:</span>
<span class="sd">            How big to plot the dots on the graph</span>

<span class="sd">        SaveFig:</span>
<span class="sd">            Save graphs to file labelled after the index</span>


<span class="sd">        TitleWrapSize:</span>
<span class="sd">            When graph titles are long, how many characters to have per </span>
<span class="sd">            line before word wrap. Default=30. </span>
<span class="sd">            </span>
<span class="sd">        Show:</span>
<span class="sd">            When not using iPython, use Show=&#39;true&#39; to display graphs</span>
<span class="sd">            </span>
<span class="sd">        Ylimit: default==None, restrict amount of data shown on y axis. </span>
<span class="sd">        Useful for honing in on small confidence intervals</span>

<span class="sd">        Xlimit: default==None, restrict amount of data shown on x axis. </span>
<span class="sd">        Useful for honing in on small confidence intervals</span>
<span class="sd">        </span>
<span class="sd">        DPI:</span>
<span class="sd">            How big saved figure should be. Default=125</span>
<span class="sd">        </span>
<span class="sd">        XTickRotation:</span>
<span class="sd">            How many degrees to rotate the X tick labels</span>
<span class="sd">            of the output. Useful if you have very small or large</span>
<span class="sd">            numbers that overlay when plotting. </span>
<span class="sd">            </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;The experiment_files argument needs to be a list&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span>
                                         <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span><span class="p">)</span>
        <span class="n">item_template_filename</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;fitItemTemplate.xlsx&#39;</span><span class="p">)</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;SetReport&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">:</span><span class="n">item_template_filename</span><span class="p">,</span>
                 <span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="c1">#method options</span>
                 <span class="s1">&#39;Method&#39;</span><span class="p">:</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
                 <span class="c1">#&#39;DifferentialEvolution&#39;,</span>
                 <span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                 <span class="s1">&#39;PopulationSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                 <span class="s1">&#39;Seed&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;Pf&#39;</span><span class="p">:</span><span class="mf">0.475</span><span class="p">,</span>
                 <span class="s1">&#39;IterationLimit&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;Tolerance&#39;</span><span class="p">:</span><span class="mf">0.00001</span><span class="p">,</span>
                 <span class="s1">&#39;Rho&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="s1">&#39;Scale&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;SwarmSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                 <span class="s1">&#39;StdDeviation&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
                 <span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">:</span><span class="mi">100000</span><span class="p">,</span>
                 <span class="s1">&#39;StartTemperature&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                 <span class="s1">&#39;CoolingFactor&#39;</span><span class="p">:</span><span class="mf">0.85</span><span class="p">,</span>
                 <span class="c1">#experiment definition options</span>
                 <span class="c1">#need to include options for defining multiple experimental files at once</span>
                 <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>  
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Verbose&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LowerBound&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
                 <span class="s1">&#39;UpperBound&#39;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">,</span>
<span class="c1">#                 &#39;Run&#39;:&#39;false&#39;,</span>
                 <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                 The below arguments get passed to the parameter</span>
<span class="sd">                 estimation plotting class</span>
<span class="sd">                 &#39;&#39;&#39;</span>
                 
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                 <span class="c1">#graph features</span>
                 <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
                 <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                 <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                 <span class="s1">&#39;Show&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                 <span class="s1">&#39;Ylimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;Xlimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
                 <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                 <span class="s1">&#39;DotSize&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                 <span class="s1">&#39;LegendLoc&#39;</span><span class="p">:</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
                 <span class="p">}</span>
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for ParameterEstimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        <span class="c1">#second dict to separate arguments for the experiment mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        
<span class="c1">#        for i in self.kwargs_experiment.keys():</span>
<span class="c1">#            assert len(self.experiment_files)==len(self.kwargs_experiment.get(i)),&#39;{} is {} and {} is {}&#39;.format(self.experiment_files,len(self.experiment_files),(self.kwargs_experiment.get(i)),len(self.kwargs_experiment.get(i)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="p">,</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="p">,</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;HookeJeeves&#39;</span><span class="p">,</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="p">,</span><span class="s1">&#39;NelderMead&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ParticleSwarm&#39;</span><span class="p">,</span><span class="s1">&#39;Praxis&#39;</span><span class="p">,</span><span class="s1">&#39;RandomSearch&#39;</span><span class="p">,</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="p">,</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;SteepestDescent&#39;</span><span class="p">,</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="p">,</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">],</span><span class="s1">&#39;{} is not a copasi PE Method. Choose one of: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Verbose&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
            
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;currentsolutionstatistics&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Cannot run current solution statistics with </span><span class="se">\&#39;</span><span class="s1">RandomizeStartValues</span><span class="se">\&#39;</span><span class="s1"> set to </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="p">)</span>
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>  
        
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; Argument to the UseTemplateStartValues must be </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> not {}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]))</span>


            
        <span class="c1">#determine which Method to use        </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Current Solution Statistics&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Differential Evolution&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;DifferentialEvolution&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolution Strategy (SRES)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolutionary Programming&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryProgram&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Hooke &amp;amp; Jeeves&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;HookeJeeves&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Levenberg - Marquardt&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;LevenbergMarquardt&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Nelder - Mead&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;NelderMead&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Particle Swarm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ParticleSwarm&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Random Search&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;RandomSearch&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Simulated Annealing&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SimulatedAnnealing&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Steepest Descent&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SteepestDescent&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Truncated Newton&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;TruncatedNewton&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Scatter Search&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ScatterSearch&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithm&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm SR&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span>
    

            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>



        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Seed&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Pf&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Rho&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartValue&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">))</span>
        
        
        <span class="c1">#report specific arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
<span class="c1">#        assert self.kwargs.get(&#39;Run&#39;) in [&#39;true&#39;,&#39;false&#39;]</span>
        
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        PlotPEDataKwargs plotting specific kwargs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;FontSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Show&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DotSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DotSize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">clear_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">)</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        convert a number to a string        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#                    d[match2]=j.attrib</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
        <span class="k">return</span> <span class="n">d</span>
        
    <span class="k">def</span> <span class="nf">remove_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
        <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_items</span><span class="p">,</span><span class="s1">&#39;{} is not a fit item. These are the fit items: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">all_items</span><span class="p">)</span>
        <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                    <span class="c1">#locate references</span>
                    <span class="c1">#remove local parameters from PE task</span>
                    <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                                <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                    <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1">#rempve global parameters from PE task </span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Values\[(.*)\].*Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1">#remove IC parameters from PE task</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                        <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Metabolites\[(.*)\],Reference=(.*)&#39;</span>
                        <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="k">if</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                                <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                                    <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                        <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Parameter {} is not a local parameter, initial concentration parameter or a global parameter.initial_value&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

 
    <span class="k">def</span> <span class="nf">remove_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        

        
    <span class="k">def</span> <span class="nf">write_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
        <span class="k">return</span>  <span class="s1">&#39;writing template. {} set to {} and {} is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">),</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>

        
    <span class="k">def</span> <span class="nf">read_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_item_template</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">True</span><span class="p">,</span><span class="s1">&#39;ItemTemplate file does not exist. Run </span><span class="se">\&#39;</span><span class="s1">write_item_template</span><span class="se">\&#39;</span><span class="s1"> method and modify it how you like then rerun this method&#39;</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">add_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        need 5 elements, each with their own attributes. Their names are:</span>
<span class="sd">            Affected Cross Validation Experiments</span>
<span class="sd">            Affected Experiments</span>
<span class="sd">            LowerBound</span>
<span class="sd">            ObjectCN</span>
<span class="sd">            StartValue</span>
<span class="sd">            UpperBound</span>
<span class="sd">            </span>
<span class="sd">        the element name is &lt;ParameterGroup name=&quot;FitItem&quot;&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#initialize new element</span>
        <span class="n">new_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;FitItem&#39;</span><span class="p">})</span>
        <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="s1">&#39;{} is not in your ItemTemplate. You item template contains: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">item</span><span class="o">=</span> <span class="n">all_items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">subA1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Cross Validation Experiments&#39;</span><span class="p">}</span>
        <span class="n">subA2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Experiments&#39;</span><span class="p">}</span>
        <span class="n">subA3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">])}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">subA5</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;StartValue&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">])}</span>
        
        <span class="n">subA6</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">])}</span>
        
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA1</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA2</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA5</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA6</span><span class="p">)</span>
        
        <span class="c1">#for IC parameters</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="c1">#fill in the attributes</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>


        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ReactionParameter&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
<span class="c1">#            logger.info(&#39;{} is an assignment and can therefore not be estimated!&#39;.format(list(item.index)))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="p">}</span>


        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
 
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>           
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid parameter for estimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA4</span><span class="p">)</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;OptimizationItemList&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">insert_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameter_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parameter_list</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="s1">&#39;nan&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">set_PE_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Choose PE algorithm and set algorithm specific parameters </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Build XML for method. Root=Method for now. Will be merged with CoapsiML later</span>
        <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="p">}</span>
        <span class="n">method_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">method_params</span><span class="p">)</span>

        <span class="c1">#list of attribute dictionaries </span>
        <span class="c1">#Evolutionary strategy parametery</span>
        <span class="n">NumberOfGenerations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Generations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">)}</span>
        <span class="n">PopulationSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Population Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">)}</span>
        <span class="n">RandomNumberGenerator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Random Number Generator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">)}</span>
        <span class="n">Seed</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Seed&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">)}</span>
        <span class="n">Pf</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">)}</span>
        <span class="c1">#local method parameters</span>
        <span class="n">IterationLimit</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Iteration Limit&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">)}</span>
        <span class="n">Tolerance</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Tolerance&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">)}</span>
        <span class="n">Rho</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Rho&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">)}</span>
        <span class="n">Scale</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">)}</span>
        <span class="c1">#Particle Swarm parmeters</span>
        <span class="n">SwarmSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Swarm Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">)}</span>
        <span class="n">StdDeviation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Std. Deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">)}</span>
        <span class="c1">#Random Search parameters</span>
        <span class="n">NumberOfIterations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Iterations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">)}</span>
        <span class="c1">#Simulated Annealing parameters</span>
        <span class="n">StartTemperature</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Start Temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">)}</span>
        <span class="n">CoolingFactor</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Factor&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">)}</span>


        <span class="c1">#build the appropiate XML, with method at root (for now)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">pass</span> <span class="c1">#no additional parameter elements required</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Rho</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">SwarmSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StdDeviation</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StartTemperature</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">CoolingFactor</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="c1">#required no additonal paraemters</span>
            <span class="k">pass</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>            

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>  
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>  

        
        <span class="n">tasks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">)</span>

        <span class="n">method</span><span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">method_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span>
        <span class="k">return</span> <span class="n">key</span>
        
    <span class="k">def</span> <span class="nf">set_PE_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">scheluled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span>
                          <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
                          
        <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                       <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>

        <span class="n">randomize_start_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">)}</span>
        <span class="n">calculate_stats</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)}</span>
        <span class="n">create_parameter_sets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)}</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Parameter Estimation&quot;]&#39;</span> <span class="ow">and</span> <span class="s1">&#39;//*[@type=&quot;parameterFitting&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheluled_attrib</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">!=</span><span class="p">[]:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">randomize_start_values</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">calculate_stats</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">:</span>
                            <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">create_parameter_sets</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
      
    <span class="k">def</span> <span class="nf">get_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        <span class="n">global_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
        <span class="n">IC_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
        <span class="n">df_list_local</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">df_list_global</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">df_list_ICs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_list_local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">global_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_list_global</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Quantitytype&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">df_list_ICs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">l</span><span class="o">=</span><span class="n">df_list_local</span><span class="o">+</span><span class="n">df_list_global</span><span class="o">+</span><span class="n">df_list_ICs</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;No ICs, local or global quantities in your model&#39;</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;StartValue&#39;</span><span class="p">})</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#        df[&#39;startValue&#39;]=[self.kwargs.get(&#39;StartValue&#39;)]*df.shape[0]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Parameter&#39;</span>
        <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">,</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span><span class="s1">&#39;simulationType&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
            
    <span class="k">def</span> <span class="nf">set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">EM</span><span class="o">=</span><span class="n">ExperimentMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">EM</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_all_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_method</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_all_fit_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the PlotPEData class to plot results </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_temp.cps&#39;</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">)</span>
<span class="c1">#        cps_copy=shutil.copy</span>
        <span class="k">print</span> <span class="n">copasi_file</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PL</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">PlotPEData</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.ParameterEstimation">ParameterEstimation</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.ParameterEstimation.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.PlotPEDataKwargs" class="name">var <span class="ident">PlotPEDataKwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.experiment_files" class="name">var <span class="ident">experiment_files</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.kwargs_experiment" class="name">var <span class="ident">kwargs_experiment</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.method_list" class="name">var <span class="ident">method_list</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParameterEstimation.report_dict" class="name">var <span class="ident">report_dict</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, experiment_files, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="n">experiment_files</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span><span class="s1">&#39;{} is not a real file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;The experiment_files argument needs to be a list&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    
    <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span>
                                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span><span class="p">)</span>
    <span class="n">item_template_filename</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;fitItemTemplate.xlsx&#39;</span><span class="p">)</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
             <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
             <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;SetReport&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">:</span><span class="n">item_template_filename</span><span class="p">,</span>
             <span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
             <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="c1">#method options</span>
             <span class="s1">&#39;Method&#39;</span><span class="p">:</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
             <span class="c1">#&#39;DifferentialEvolution&#39;,</span>
             <span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
             <span class="s1">&#39;PopulationSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
             <span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
             <span class="s1">&#39;Seed&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
             <span class="s1">&#39;Pf&#39;</span><span class="p">:</span><span class="mf">0.475</span><span class="p">,</span>
             <span class="s1">&#39;IterationLimit&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
             <span class="s1">&#39;Tolerance&#39;</span><span class="p">:</span><span class="mf">0.00001</span><span class="p">,</span>
             <span class="s1">&#39;Rho&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span>
             <span class="s1">&#39;Scale&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
             <span class="s1">&#39;SwarmSize&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
             <span class="s1">&#39;StdDeviation&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
             <span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">:</span><span class="mi">100000</span><span class="p">,</span>
             <span class="s1">&#39;StartTemperature&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
             <span class="s1">&#39;CoolingFactor&#39;</span><span class="p">:</span><span class="mf">0.85</span><span class="p">,</span>
             <span class="c1">#experiment definition options</span>
             <span class="c1">#need to include options for defining multiple experimental files at once</span>
             <span class="s1">&#39;RowOrientation&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;ExperimentType&#39;</span><span class="p">:[</span><span class="s1">&#39;timecourse&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;FirstRow&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">:[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;RowContainingNames&#39;</span><span class="p">:[</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;Separator&#39;</span><span class="p">:[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;WeightMethod&#39;</span><span class="p">:[</span><span class="s1">&#39;mean_squared&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>  
             <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Verbose&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;LowerBound&#39;</span><span class="p">:</span><span class="mf">0.000001</span><span class="p">,</span>
             <span class="s1">&#39;UpperBound&#39;</span><span class="p">:</span><span class="mi">1000000</span><span class="p">,</span>
              <span class="s1">&#39;Run&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">             The below arguments get passed to the parameter</span>
<span class="sd">             estimation plotting class</span>
<span class="sd">             &#39;&#39;&#39;</span>
             
             <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
             <span class="c1">#graph features</span>
             <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
             <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
             <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
             <span class="s1">&#39;Show&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
             <span class="s1">&#39;Ylimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;Xlimit&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
             <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
             <span class="s1">&#39;DotSize&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
             <span class="s1">&#39;LegendLoc&#39;</span><span class="p">:</span><span class="s1">&#39;best&#39;</span><span class="p">,</span>
             <span class="p">}</span>
                 
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for ParameterEstimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    <span class="c1">#second dict to separate arguments for the experiment mapper</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowOrientation&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExperimentType&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FirstRow&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NormalizeWeightsPerExperiment&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RowContainingNames&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Separator&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WeightMethod&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
    
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
         <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="s1">&#39;{} is {} and {} is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">),(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="p">,</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="p">,</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;HookeJeeves&#39;</span><span class="p">,</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="p">,</span><span class="s1">&#39;NelderMead&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ParticleSwarm&#39;</span><span class="p">,</span><span class="s1">&#39;Praxis&#39;</span><span class="p">,</span><span class="s1">&#39;RandomSearch&#39;</span><span class="p">,</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="p">,</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SteepestDescent&#39;</span><span class="p">,</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="p">,</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">],</span><span class="s1">&#39;{} is not a copasi PE Method. Choose one of: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">method_list</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Verbose&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
        
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Method&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;currentsolutionstatistics&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Cannot run current solution statistics with </span><span class="se">\&#39;</span><span class="s1">RandomizeStartValues</span><span class="se">\&#39;</span><span class="s1"> set to </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">.&#39;</span> <span class="p">)</span>
    <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>  
    
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39; Argument to the UseTemplateStartValues must be </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> not {}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">]))</span>
        
    <span class="c1">#determine which Method to use        </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Current Solution Statistics&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Differential Evolution&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;DifferentialEvolution&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolution Strategy (SRES)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Evolutionary Programming&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;EvolutionaryProgram&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Hooke &amp;amp; Jeeves&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;HookeJeeves&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Levenberg - Marquardt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;LevenbergMarquardt&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Nelder - Mead&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;NelderMead&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Particle Swarm&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ParticleSwarm&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;Praxis&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Random Search&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;RandomSearch&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Simulated Annealing&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SimulatedAnnealing&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Steepest Descent&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;SteepestDescent&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Truncated Newton&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;TruncatedNewton&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Scatter Search&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;ScatterSearch&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithm&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="o">=</span><span class="s1">&#39;Genetic Algorithm SR&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="o">=</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span>

        
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Seed&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Pf&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Rho&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scale&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartValue&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">))</span>
    
    
    <span class="c1">#report specific arguments</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span>
    
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
     <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    PlotPEDataKwargs plotting specific kwargs</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="o">=</span><span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;FontSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Show&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Xlimit&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;DotSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DotSize&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LegendLoc&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">[</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.add_fit_item">
    <p>def <span class="ident">add_fit_item</span>(</p><p>self, item)</p>
    </div>
    

    
  
    <div class="desc"><p>need 5 elements, each with their own attributes. Their names are:
    Affected Cross Validation Experiments
    Affected Experiments
    LowerBound
    ObjectCN
    StartValue
    UpperBound</p>
<p>the element name is <ParameterGroup name="FitItem"></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.add_fit_item', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.add_fit_item" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    need 5 elements, each with their own attributes. Their names are:</span>
<span class="sd">        Affected Cross Validation Experiments</span>
<span class="sd">        Affected Experiments</span>
<span class="sd">        LowerBound</span>
<span class="sd">        ObjectCN</span>
<span class="sd">        StartValue</span>
<span class="sd">        UpperBound</span>
<span class="sd">        </span>
<span class="sd">    the element name is &lt;ParameterGroup name=&quot;FitItem&quot;&gt;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#initialize new element</span>
    <span class="n">new_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;FitItem&#39;</span><span class="p">})</span>
    <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="s1">&#39;{} is not in your ItemTemplate. You item template contains: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">all_items</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="n">item</span><span class="o">=</span> <span class="n">all_items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="n">subA1</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Cross Validation Experiments&#39;</span><span class="p">}</span>
    <span class="n">subA2</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Affected Experiments&#39;</span><span class="p">}</span>
    <span class="n">subA3</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">])}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">subA5</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;StartValue&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">])}</span>
    
    <span class="n">subA6</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">])}</span>
    
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA1</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA2</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA3</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UseTemplateStartValues&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA5</span><span class="p">)</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA6</span><span class="p">)</span>
    
    <span class="c1">#for IC parameters</span>
    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;reactions&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
        <span class="c1">#fill in the attributes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ode&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ReactionParameter&#39;</span><span class="p">:</span>
        <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;{} is an assignment and can therefore not be estimated!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">index</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ModelValue&#39;</span><span class="p">:</span>
        <span class="n">subA4</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ObjectCN&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;assignment&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;simulationType&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;fixed&#39;</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Species&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>           
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid parameter for estimation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">)))</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">new_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">subA4</span><span class="p">)</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;OptimizationItemList&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.clear_pe">
    <p>def <span class="ident">clear_pe</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.clear_pe', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.clear_pe" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clear_pe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.convert_to_string">
    <p>def <span class="ident">convert_to_string</span>(</p><p>self, num)</p>
    </div>
    

    
  
    <div class="desc"><p>convert a number to a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.convert_to_string', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.convert_to_string" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">convert_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    convert a number to a string        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.define_report">
    <p>def <span class="ident">define_report</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.define_report', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.define_report" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.get_fit_items">
    <p>def <span class="ident">get_fit_items</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.get_fit_items', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.get_fit_items" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="s1">&#39;({}).{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                 <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Values\[(.*)\]&#39;</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span><span class="p">:</span>
                    <span class="n">match2</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Metabolites\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">match2</span><span class="o">=</span><span class="n">match2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match2</span><span class="o">!=</span><span class="p">[]:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">match2</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span>    
    <span class="k">return</span> <span class="n">d</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.get_item_template">
    <p>def <span class="ident">get_item_template</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.get_item_template', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.get_item_template" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">local_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
    <span class="n">global_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span>
    <span class="n">IC_params</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span>
    <span class="n">df_list_local</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">df_list_global</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">df_list_ICs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">local_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">df_list_local</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">global_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">global_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">df_list_global</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">IC_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">IC_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Quantitytype&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df_list_ICs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">l</span><span class="o">=</span><span class="n">df_list_local</span><span class="o">+</span><span class="n">df_list_global</span><span class="o">+</span><span class="n">df_list_ICs</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;No ICs, local or global quantities in your model&#39;</span>
    <span class="n">df</span><span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="s1">&#39;StartValue&#39;</span><span class="p">})</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
     <span class="n">df</span><span class="p">[</span><span class="s1">&#39;startValue&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartValue&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">)]</span><span class="o">*</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Parameter&#39;</span>
    <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;StartValue&#39;</span><span class="p">,</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span><span class="s1">&#39;simulationType&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.get_report_key">
    <p>def <span class="ident">get_report_key</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.get_report_key', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.get_report_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span>
    <span class="k">return</span> <span class="n">key</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.insert_all_fit_items">
    <p>def <span class="ident">insert_all_fit_items</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.insert_all_fit_items', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.insert_all_fit_items" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameter_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parameter_list</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">i</span><span class="o">!=</span><span class="s1">&#39;nan&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.plot">
    <p>def <span class="ident">plot</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the PlotPEData class to plot results</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.plot', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use the PlotPEData class to plot results </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copasi_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_temp.cps&#39;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">)</span>
     <span class="n">cps_copy</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span>
    <span class="k">print</span> <span class="n">copasi_file</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">PL</span><span class="o">=</span><span class="n">PEAnalysis</span><span class="o">.</span><span class="n">PlotPEData</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">PlotPEDataKwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.read_item_template">
    <p>def <span class="ident">read_item_template</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.read_item_template', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.read_item_template" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_item_template</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">True</span><span class="p">,</span><span class="s1">&#39;ItemTemplate file does not exist. Run </span><span class="se">\&#39;</span><span class="s1">write_item_template</span><span class="se">\&#39;</span><span class="s1"> method and modify it how you like then rerun this method&#39;</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.remove_all_fit_items">
    <p>def <span class="ident">remove_all_fit_items</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.remove_all_fit_items', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.remove_all_fit_items" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_all_fit_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_fit_item</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.remove_fit_item">
    <p>def <span class="ident">remove_fit_item</span>(</p><p>self, item)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.remove_fit_item', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.remove_fit_item" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_fit_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;FitItem&quot;]&#39;</span>
    <span class="n">all_items</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">all_items</span><span class="p">,</span><span class="s1">&#39;{} is not a fit item. These are the fit items: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">all_items</span><span class="p">)</span>
    <span class="n">item</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fit_items</span><span class="p">()[</span><span class="n">item</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ObjectCN&#39;</span><span class="p">:</span>
                <span class="c1">#locate references</span>
                <span class="c1">#remove local parameters from PE task</span>
                <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;Reference=(.*)&#39;</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;Value&#39;</span><span class="p">:</span>
                    <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Reactions\[(.*)\].*Parameter=(.*),Reference=(.*)&#39;</span>
                    <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="c1">#rempve global parameters from PE task </span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialValue&#39;</span><span class="p">:</span>
                    <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Values\[(.*)\].*Reference=(.*)&#39;</span>
                    <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                            <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="c1">#remove IC parameters from PE task</span>
                <span class="k">elif</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                    <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;Metabolites\[(.*)\],Reference=(.*)&#39;</span>
                    <span class="n">match2_copasiML</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">match2_copasiML</span><span class="o">!=</span><span class="p">[]:</span>
                        <span class="k">if</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialConcentration&#39;</span> <span class="ow">or</span> <span class="n">match2_copasiML</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;InitialParticleNumber&#39;</span><span class="p">:</span>
                            <span class="n">match2_item</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">match2_item</span><span class="o">!=</span><span class="p">[]:</span>
                                <span class="k">if</span> <span class="n">match2_item</span><span class="o">==</span><span class="n">match2_copasiML</span><span class="p">:</span>
                                    <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Parameter {} is not a local parameter, initial concentration parameter or a global parameter.initial_value&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match2_item</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.set_PE_method">
    <p>def <span class="ident">set_PE_method</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Choose PE algorithm and set algorithm specific parameters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.set_PE_method', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.set_PE_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_PE_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Choose PE algorithm and set algorithm specific parameters </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#Build XML for method. Root=Method for now. Will be merged with CoapsiML later</span>
    <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">method_type</span><span class="p">}</span>
    <span class="n">method_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">method_params</span><span class="p">)</span>
    <span class="c1">#list of attribute dictionaries </span>
    <span class="c1">#Evolutionary strategy parametery</span>
    <span class="n">NumberOfGenerations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Generations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfGenerations&#39;</span><span class="p">)}</span>
    <span class="n">PopulationSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Population Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PopulationSize&#39;</span><span class="p">)}</span>
    <span class="n">RandomNumberGenerator</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Random Number Generator&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomNumberGenerator&#39;</span><span class="p">)}</span>
    <span class="n">Seed</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Seed&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Seed&#39;</span><span class="p">)}</span>
    <span class="n">Pf</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Pf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Pf&#39;</span><span class="p">)}</span>
    <span class="c1">#local method parameters</span>
    <span class="n">IterationLimit</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Iteration Limit&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;IterationLimit&#39;</span><span class="p">)}</span>
    <span class="n">Tolerance</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Tolerance&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Tolerance&#39;</span><span class="p">)}</span>
    <span class="n">Rho</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Rho&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Rho&#39;</span><span class="p">)}</span>
    <span class="n">Scale</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">)}</span>
    <span class="c1">#Particle Swarm parmeters</span>
    <span class="n">SwarmSize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Swarm Size&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SwarmSize&#39;</span><span class="p">)}</span>
    <span class="n">StdDeviation</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Std. Deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StdDeviation&#39;</span><span class="p">)}</span>
    <span class="c1">#Random Search parameters</span>
    <span class="n">NumberOfIterations</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of Iterations&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfIterations&#39;</span><span class="p">)}</span>
    <span class="c1">#Simulated Annealing parameters</span>
    <span class="n">StartTemperature</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Start Temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StartTemperature&#39;</span><span class="p">)}</span>
    <span class="n">CoolingFactor</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedFloat&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Factor&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CoolingFactor&#39;</span><span class="p">)}</span>
    <span class="c1">#build the appropiate XML, with method at root (for now)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;CurrentSolutionStatistics&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="k">pass</span> <span class="c1">#no additional parameter elements required</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;DifferentialEvolution&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryStrategySR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;EvolutionaryProgram&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;HookeJeeves&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Rho</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;LevenbergMarquardt&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;NelderMead&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Scale</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ParticleSwarm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">SwarmSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StdDeviation</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;Praxis&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;RandomSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SimulatedAnnealing&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">StartTemperature</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">CoolingFactor</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SteepestDescent&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">IterationLimit</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Tolerance</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;TruncatedNewton&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="c1">#required no additonal paraemters</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;ScatterSearch&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfIterations</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithm&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Method&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;GeneticAlgorithmSR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">NumberOfGenerations</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">PopulationSize</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">RandomNumberGenerator</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Seed</span><span class="p">)</span>  
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">method_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">Pf</span><span class="p">)</span>  
    
    <span class="n">tasks</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">)</span>
    <span class="n">method</span><span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">parent</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">method_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.set_PE_options">
    <p>def <span class="ident">set_PE_options</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.set_PE_options', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.set_PE_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_PE_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">scheluled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span>
                      <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
                      
    <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span>
                   <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                   <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                   <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
    <span class="n">randomize_start_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RandomizeStartValues&#39;</span><span class="p">)}</span>
    <span class="n">calculate_stats</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CalculateStatistics&#39;</span><span class="p">)}</span>
    <span class="n">create_parameter_sets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CreateParameterSets&#39;</span><span class="p">)}</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Parameter Estimation&quot;]&#39;</span> <span class="ow">and</span> <span class="s1">&#39;//*[@type=&quot;parameterFitting&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheluled_attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SetReport&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">!=</span><span class="p">[]:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Randomize Start Values&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">randomize_start_values</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Calculate Statistics&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">calculate_stats</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Create Parameter Sets&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">create_parameter_sets</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.set_up">
    <p>def <span class="ident">set_up</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.set_up', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.set_up" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">EM</span><span class="o">=</span><span class="n">ExperimentMapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_files</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs_experiment</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">EM</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_all_fit_items</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_method</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_PE_options</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_all_fit_items</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParameterEstimation.write_item_template">
    <p>def <span class="ident">write_item_template</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParameterEstimation.write_item_template', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParameterEstimation.write_item_template" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_item_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span><span class="o">==</span><span class="bp">False</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_item_template</span><span class="p">()</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
    <span class="k">return</span>  <span class="s1">&#39;writing template. {} set to {} and {} is {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwriteItemTemplate&#39;</span><span class="p">),</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ItemTemplateFilename&#39;</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.ParsePEDataDeprecated" class="name">class <span class="ident">ParsePEDataDeprecated</span></p>
      
  
    <div class="desc"><p>Deprecated on 28-01-2017. Keep until you know it 
wont mess up the rest of your code. </p>
<p>parse parameter estimation data from file</p>
<p>Positional args:
    results_path:
        Full path to a results file or folder of files containing 
        parameter estimation results</p>
<p>NOTE: this class is functional but will be replaced by PEAnalysis.ParsePEData</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ParsePEDataDeprecated</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Deprecated on 28-01-2017. Keep until you know it </span>
<span class="sd">    wont mess up the rest of your code. </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    parse parameter estimation data from file</span>
<span class="sd">    </span>
<span class="sd">    Positional args:</span>
<span class="sd">        results_path:</span>
<span class="sd">            Full path to a results file or folder of files containing </span>
<span class="sd">            parameter estimation results</span>
<span class="sd">            </span>
<span class="sd">    NOTE: this class is functional but will be replaced by PEAnalysis.ParsePEData</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">results_path</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="o">=</span><span class="n">results_path</span> <span class="c1">#either file or folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData.pickle&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path_log</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData_log.pickle&#39;</span><span class="p">)</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span>
                 <span class="s1">&#39;FromPickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                 <span class="s1">&#39;OverwritePickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>   
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span> <span class="n">options</span>
        
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;folder&#39;</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
            
        
        <span class="c1">#main methods of class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_copasi_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        

      
    <span class="k">def</span> <span class="nf">remove_copasi_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the PruneCopasiHeaders class to truncate copasi style formatting </span>
<span class="sd">        conventions        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#We minus 1 to account for not counting the parameter estimation header 3 lines down</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span><span class="p">:</span>
                <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">df</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">read_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        read folder of tab separated csv files i.e. the output from copasi</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} is not a real directory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="n">df_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
            <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        change the RSS from copasi output to RSS</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">b</span><span class="o">=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">b</span><span class="p">:</span><span class="s1">&#39;RSS&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">data</span>

        
    <span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        sort data in order of increasing RSS</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

        
    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;mode not file&#39;</span>
        <span class="n">_</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.xls&#39;</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">],</span><span class="s1">&#39;parameter file is not .txt, .xlsx, .xls, .csv&#39;</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;xlsx&#39;</span> <span class="ow">or</span> <span class="s1">&#39;xls&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>     
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
                
            
    <span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">),</span><span class="s1">&#39;pickle path does</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
            
    
    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_folder</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.ParsePEDataDeprecated">ParsePEDataDeprecated</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.cwd" class="name">var <span class="ident">cwd</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.data" class="name">var <span class="ident">data</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.pickle_path" class="name">var <span class="ident">pickle_path</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.pickle_path_log" class="name">var <span class="ident">pickle_path_log</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.ParsePEDataDeprecated.results_path" class="name">var <span class="ident">results_path</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, results_path, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">results_path</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="o">=</span><span class="n">results_path</span> <span class="c1">#either file or folder</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData.pickle&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pickle_path_log</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">,</span><span class="s1">&#39;PEData_log.pickle&#39;</span><span class="p">)</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span>
             <span class="s1">&#39;FromPickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
             <span class="s1">&#39;OverwritePickle&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>   
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span> <span class="n">options</span>
    
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;folder&#39;</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;file&#39;</span>
        
    
    <span class="c1">#main methods of class</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_copasi_headers</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.read_data">
    <p>def <span class="ident">read_data</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.read_data', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.read_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;folder&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_folder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.read_file">
    <p>def <span class="ident">read_file</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.read_file', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.read_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;mode not file&#39;</span>
    <span class="n">_</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="s1">&#39;.xls&#39;</span><span class="p">,</span><span class="s1">&#39;.csv&#39;</span><span class="p">],</span><span class="s1">&#39;parameter file is not .txt, .xlsx, .xls, .csv&#39;</span>
    <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;xlsx&#39;</span> <span class="ow">or</span> <span class="s1">&#39;xls&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.read_folder">
    <p>def <span class="ident">read_folder</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>read folder of tab separated csv files i.e. the output from copasi</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.read_folder', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.read_folder" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read folder of tab separated csv files i.e. the output from copasi</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">),</span><span class="s1">&#39;{} is not a real directory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">)</span>
    <span class="n">df_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">):</span>
        <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_path</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;.txt&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.read_pickle">
    <p>def <span class="ident">read_pickle</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.read_pickle', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.read_pickle" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">),</span><span class="s1">&#39;pickle path does</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.remove_copasi_headers">
    <p>def <span class="ident">remove_copasi_headers</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the PruneCopasiHeaders class to truncate copasi style formatting 
conventions</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.remove_copasi_headers', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.remove_copasi_headers" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_copasi_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use the PruneCopasiHeaders class to truncate copasi style formatting </span>
<span class="sd">    conventions        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#We minus 1 to account for not counting the parameter estimation header 3 lines down</span>
    <span class="n">l</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span><span class="p">:</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\].*&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">data</span><span class="o">=</span><span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">df</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.rename_RSS">
    <p>def <span class="ident">rename_RSS</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>change the RSS from copasi output to RSS</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.rename_RSS', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.rename_RSS" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rename_RSS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    change the RSS from copasi output to RSS</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">b</span><span class="o">=</span><span class="s1">&#39;TaskList[Parameter Estimation].(Problem)Parameter Estimation.Best Value&#39;</span>
    <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">b</span><span class="p">:</span><span class="s1">&#39;RSS&#39;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.sort_data">
    <p>def <span class="ident">sort_data</span>(</p><p>self, data)</p>
    </div>
    

    
  
    <div class="desc"><p>sort data in order of increasing RSS</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.sort_data', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.sort_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">sort_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    sort data in order of increasing RSS</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.ParsePEDataDeprecated.write_pickle">
    <p>def <span class="ident">write_pickle</span>(</p><p>self, data)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.ParsePEDataDeprecated.write_pickle', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.ParsePEDataDeprecated.write_pickle" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>     
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pickle_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OverwritePickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FromPickle&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.PhaseSpace" class="name">class <span class="ident">PhaseSpace</span></p>
      
  
    <div class="desc"><p>Inherits from TimeCourse</p>
<p>Use TimeCourse to get data and replot all n choose 2 combinations
of phase space plot</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PhaseSpace</span><span class="p">(</span><span class="n">TimeCourse</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inherits from TimeCourse</span>
<span class="sd">    </span>
<span class="sd">    Use TimeCourse to get data and replot all n choose 2 combinations</span>
<span class="sd">    of phase space plot</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PhaseSpacePlots</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isolate_species</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_combinations</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">make_phase_dir</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_all_phase</span><span class="p">()</span>
        
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        
            
    <span class="k">def</span> <span class="nf">isolate_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Isolate the species from the time course data </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">metabs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metabs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39; {} is an incompatible string that is not supported by PyCoTools. Please modify the string and rerun&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">metabs</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">get_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">make_phase_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;PhasePlots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dire</span>
        
        
    <span class="k">def</span> <span class="nf">plot1phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            
        <span class="k">if</span> <span class="n">y</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
               
        <span class="n">x_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="n">y_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
                    
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;{} Vs {} Phase Plot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
        <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
            
            
        <span class="c1">#pretty stuff</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
            <span class="c1">#xtick rotation</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
            
        <span class="c1">#options for changing the plot axis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                    <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
            <span class="k">return</span> <span class="n">st</span>    
            
        <span class="n">y_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;{}_Vs_{}_PhasePlot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
    <span class="k">def</span> <span class="nf">plot_all_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot1phase</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.PhaseSpace">PhaseSpace</a></li>
          <li><a href="#pycopi.TimeCourse">TimeCourse</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.PhaseSpace.CParser" class="name">var <span class="ident">CParser</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.CParser">CParser</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.GMQ" class="name">var <span class="ident">GMQ</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.GMQ">GMQ</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.combinations" class="name">var <span class="ident">combinations</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.copasiML" class="name">var <span class="ident">copasiML</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.copasiML">copasiML</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.copasi_file">copasi_file</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.data" class="name">var <span class="ident">data</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.data">data</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.kwargs" class="name">var <span class="ident">kwargs</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.kwargs">kwargs</a></code>
    </p>

            
  
    <div class="desc inherited"><p>if the below three kwargs are a single entry they can be a string. 
In this case, put them back into a list to ensure a smooth ride</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.new_options" class="name">var <span class="ident">new_options</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.report_options" class="name">var <span class="ident">report_options</span></p>
            
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.report_options">report_options</a></code>
    </p>

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PhaseSpace.species_data" class="name">var <span class="ident">species_data</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PhaseSpacePlots</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
    <span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_options</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isolate_species</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_combinations</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">make_phase_dir</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_dir</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_all_phase</span><span class="p">()</span>
    
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.get_combinations">
    <p>def <span class="ident">get_combinations</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.get_combinations', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.get_combinations" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.get_report_key">
    <p>def <span class="ident">get_report_key</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.get_report_key">get_report_key</a></code>
    </p>

    
  
    <div class="desc inherited"><p>cros reference the timecourse task with the newly created
time course reort to get the key</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.get_report_key', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.get_report_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    cros reference the timecourse task with the newly created</span>
<span class="sd">    time course reort to get the key</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
            <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span><span class="p">,</span><span class="s1">&#39;have you ran the report_definition method?&#39;</span>
    <span class="k">return</span> <span class="n">key</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.isolate_species">
    <p>def <span class="ident">isolate_species</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Isolate the species from the time course data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.isolate_species', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.isolate_species" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">isolate_species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Isolate the species from the time course data </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">metabs</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">metabs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">IncompatibleStringError</span><span class="p">(</span><span class="s1">&#39; {} is an incompatible string that is not supported by PyCoTools. Please modify the string and rerun&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">metabs</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.make_phase_dir">
    <p>def <span class="ident">make_phase_dir</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.make_phase_dir', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.make_phase_dir" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">make_phase_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;PhasePlots&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dire</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.plot">
    <p>def <span class="ident">plot</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.plot">plot</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.plot', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">## Create directory for graphs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GraphDirectory&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;TimeCourseGraphs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
             <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerStyle&#39;</span><span class="p">))</span>
            
            <span class="c1">#plot labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;Time-Course for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration (micromol)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Particle Numbers&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                    
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_time_unit</span><span class="p">()),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
                
           <span class="c1">#pretty stuff</span>
    
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="c1">#xtick rotation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
            
            <span class="c1">#options for changing the plot axis</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
    
            <span class="k">def</span> <span class="nf">save_plot</span><span class="p">():</span>
                <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                            <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
                    <span class="k">return</span> <span class="n">st</span>
                    
                <span class="n">filename</span><span class="o">=</span><span class="p">{}</span>
                <span class="n">name</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dire</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
                <span class="k">return</span> <span class="n">filename</span>
    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                
            <span class="c1">#save figure options</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
                <span class="n">save_plot</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.plot1phase">
    <p>def <span class="ident">plot1phase</span>(</p><p>self, x, y)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.plot1phase', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.plot1phase" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot1phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        
    <span class="k">if</span> <span class="n">y</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not in your model species: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
           
    <span class="n">x_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">y_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">species_data</span><span class="p">[</span><span class="n">y</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span><span class="n">y_data</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span>
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span>
                <span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
                
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;{} Vs {} Phase Plot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="s1">&#39;({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;micromol&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
        
        
    <span class="c1">#pretty stuff</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    
        <span class="c1">#xtick rotation</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
        
    <span class="c1">#options for changing the plot axis</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">st</span>    
        
    <span class="n">y_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">x_new</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;{}_Vs_{}_PhasePlot&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span><span class="n">y_new</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.plot_all_phase">
    <p>def <span class="ident">plot_all_phase</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.plot_all_phase', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.plot_all_phase" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_all_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">combinations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot1phase</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.read_sim_data">
    <p>def <span class="ident">read_sim_data</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.read_sim_data">read_sim_data</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.read_sim_data', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.read_sim_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_sim_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data_output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">])</span>
    <span class="c1">#trim copasi style headers</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> 
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.report_definition">
    <p>def <span class="ident">report_definition</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.report_definition">report_definition</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.report_definition', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.report_definition" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">report_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.run">run</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Run a time course. Use keyword argument:
SimulationType='deterministic' #default
SumulationType='stochastic' #still to be written</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a time course. Use keyword argument:</span>
<span class="sd">        SimulationType=&#39;deterministic&#39; #default</span>
<span class="sd">        SumulationType=&#39;stochastic&#39; #still to be written</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;deterministic&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_deterministic</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;stochastic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;There is space in this class to write code to run a stochastic simulation but it is not yet written&#39;</span>
    <span class="c1">#save to duplicate copasi file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)]</span>
        
    <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.save">save</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.set_deterministic">
    <p>def <span class="ident">set_deterministic</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.set_deterministic">set_deterministic</a></code>
    </p>

    
  
    <div class="desc inherited"><p>set parameters for deterministic timecourse</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.set_deterministic', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.set_deterministic" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    set parameters for deterministic timecourse</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
    <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic(LSODA)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic (LSODA)&#39;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="c1">#make available to coapsiSE</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Duration&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">)</span>
                    
                <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepNumber&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)</span>
                    
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepSize&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TimeSeriesRequested&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>                        
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;OutputStartTime&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output Event&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Continue on Simultaneous Events&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Integrate Reduced Model&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Relative Tolerance&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Absolute Tolerance&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PhaseSpace.set_report">
    <p>def <span class="ident">set_report</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#pycopi.TimeCourse">TimeCourse</a></code>.<code><a href="#pycopi.TimeCourse.set_report">set_report</a></code>
    </p>

    
  
    <div class="desc inherited"><p>Use the report defined in self.create_report to tell copasi 
were to put the results</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PhaseSpace.set_report', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PhaseSpace.set_report" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use the report defined in self.create_report to tell copasi </span>
<span class="sd">    were to put the results</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
    <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">()</span>
    
    <span class="n">arg_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
             <span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
             <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> 
             <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
    <span class="n">present</span><span class="o">=</span><span class="bp">False</span>
     <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//Report&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">and</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">present</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg_dct</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">present</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">arg_dct</span><span class="p">)</span>
            <span class="n">i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">report</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.PruneCopasiHeaders" class="name">class <span class="ident">PruneCopasiHeaders</span></p>
      
  
    <div class="desc"><p>COPASI uses references to distinguish model components (like InitialConcentration 
or InitialParticleNumber). These are printed to file with copasi results and
its therefore useful to have a way to remove these references, leaving only the 
model component as it is in the model. </p>
<p>Args:
    for_pruning: either a full path to the file you want to prune or 
    a pandas dataframe</p>
<p>kwargs:
    replace:
        'true' or 'false', if 'true' will overwrite the filename. If 'false'
        write new file to new_path. If for_pruning a dataframe this argument is
        ignored. </p>
<div class="codehilite"><pre><span></span><span class="n">new_path</span><span class="o">:</span> 
    <span class="n">When</span> <span class="n">replace</span><span class="o">=</span><span class="s1">&#39;false &#39;</span><span class="n">new_path</span><span class="err">&#39;</span> <span class="k">is</span> <span class="n">the</span> <span class="n">output</span> <span class="n">filename</span><span class="o">.</span> <span class="n">Ignored</span> <span class="n">when</span> 
    <span class="n">for_pruning</span> <span class="k">is</span> <span class="n">a</span> <span class="n">pandas</span> <span class="n">dataframe</span><span class="o">.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PruneCopasiHeaders', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PruneCopasiHeaders" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PruneCopasiHeaders</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    COPASI uses references to distinguish model components (like InitialConcentration </span>
<span class="sd">    or InitialParticleNumber). These are printed to file with copasi results and</span>
<span class="sd">    its therefore useful to have a way to remove these references, leaving only the </span>
<span class="sd">    model component as it is in the model. </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        for_pruning: either a full path to the file you want to prune or </span>
<span class="sd">        a pandas dataframe</span>
<span class="sd">    </span>
<span class="sd">    kwargs:</span>
<span class="sd">        replace:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, if &#39;true&#39; will overwrite the filename. If &#39;false&#39;</span>
<span class="sd">            write new file to new_path. If for_pruning a dataframe this argument is</span>
<span class="sd">            ignored. </span>
<span class="sd">            </span>
<span class="sd">        new_path: </span>
<span class="sd">            When replace=&#39;false &#39;new_path&#39; is the output filename. Ignored when </span>
<span class="sd">            for_pruning is a pandas dataframe.</span>
<span class="sd">        </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="n">new_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="o">=</span><span class="n">for_pruning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span>
        
<span class="c1">#        assert self.mode in [&#39;singlePE&#39;,&#39;multiPE,&#39;time_course&#39;]</span>
        
        <span class="k">if</span> <span class="n">replace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">replace</span><span class="se">\&#39;</span><span class="s1"> keyword should be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> &#39;</span><span class="p">)</span>

            
        <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">True</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_path</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_pruned_titles.txt&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="n">new_path</span>
        
<span class="c1">#        if self.mode==&#39;time_course&#39;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
    
    
    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        for time course we&#39;re using index but for PE were not. Need to make this consistant!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
        <span class="n">l</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">new_titles</span><span class="o">=</span><span class="p">[]</span> 
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
            <span class="c1">#match anything between two square brackets with regex</span>
            <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="c1">#we need the residual sum of squares value to be called &#39;RSS&#39;</span>
            <span class="c1">#and everything else to be an exact match to the corresponding</span>
            <span class="c1">#model element</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Parameter Estimation&#39;</span><span class="p">:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">new_titles</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">new_titles</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.PruneCopasiHeaders">PruneCopasiHeaders</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.PruneCopasiHeaders.for_pruning" class="name">var <span class="ident">for_pruning</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PruneCopasiHeaders.from_df" class="name">var <span class="ident">from_df</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PruneCopasiHeaders.from_file" class="name">var <span class="ident">from_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.PruneCopasiHeaders.replace" class="name">var <span class="ident">replace</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.PruneCopasiHeaders.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, for_pruning, replace=&#39;false&#39;, new_path=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PruneCopasiHeaders.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PruneCopasiHeaders.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="n">new_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="o">=</span><span class="n">for_pruning</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span>
    
     <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;singlePE&#39;</span><span class="p">,</span><span class="s1">&#39;multiPE,&#39;</span><span class="n">time_course</span><span class="s1">&#39;]</span>
    
    <span class="k">if</span> <span class="n">replace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">replace</span><span class="se">\&#39;</span><span class="s1"> keyword should be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> &#39;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">=</span><span class="bp">True</span>
            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">new_path</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_pruned_titles.txt&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="n">new_path</span>
    
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.PruneCopasiHeaders.prune">
    <p>def <span class="ident">prune</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.PruneCopasiHeaders.prune', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.PruneCopasiHeaders.prune" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    for time course we&#39;re using index but for PE were not. Need to make this consistant!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
    <span class="n">l</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">new_titles</span><span class="o">=</span><span class="p">[]</span> 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="c1">#match anything between two square brackets with regex</span>
        <span class="n">match</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.*\[(.*)\]&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="c1">#we need the residual sum of squares value to be called &#39;RSS&#39;</span>
        <span class="c1">#and everything else to be an exact match to the corresponding</span>
        <span class="c1">#model element</span>
        <span class="k">if</span> <span class="n">match</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Parameter Estimation&#39;</span><span class="p">:</span>
            <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;RSS&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">new_titles</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">new_titles</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_pruning</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_df</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.Reports" class="name">class <span class="ident">Reports</span></p>
      
  
    <div class="desc"><p>Creates reports in copasi output specification section. 
Use: 
    -the ReportType kwarg to specify which type of report you want to make
    -the Metabolites and GlobalQuantities kwargs to specify which parameters
    to include</p>
<p>args:
    copasi_file:
        The copasi file you want to add a report too</p>
<p>**kwargs:</p>
<div class="codehilite"><pre><span></span><span class="n">ReportType</span><span class="o">:</span> 
    <span class="n">Which</span> <span class="n">report</span> <span class="n">to</span> <span class="n">write</span><span class="o">.</span> <span class="n">Options</span><span class="o">:</span>
        <span class="n">profilelikleihood</span><span class="o">:</span>
            <span class="o">-</span> <span class="k">for</span> <span class="n">Pydentify</span><span class="o">,</span> <span class="n">shouldn</span><span class="s1">&#39;t need to manually touch this</span>
<span class="s1">        time_course:</span>
<span class="s1">            -a table of time Vs concentrations. Included values are specified to the Metabolites and//or GlobalQuantities arguments</span>
<span class="s1">    parameter_estimation:</span>
<span class="s1">            -a table of values from a parameter estimation and the residual sum of squares value for each run.</span>


<span class="s1">Metabolites:</span>
<span class="s1">    A list of valid model metabolites you want to include in the report. Default=All metabolites</span>

<span class="s1">GlobalQuantities;</span>
<span class="s1">    List of valid global quantities that you want to include in the report. Default=All global variables</span>

<span class="s1">QuantityType:</span>
<span class="s1">    Either &#39;</span><span class="n">concentration</span><span class="s1">&#39; or &#39;</span><span class="n">particle_number</span><span class="s1">&#39;. Switch between having report output in either concentration of in particle_numbers.</span>

<span class="s1">ReportName:</span>
<span class="s1">    Name of the report. Default depends on kwarg ReportType</span>

<span class="s1">Append: </span>
<span class="s1">    &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39;. Append to report. Default &#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">ConfirmOverwrite: </span>
<span class="s1">    &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39;.  Default= &#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">Save: </span>
<span class="s1">    either &#39;</span><span class="kc">false</span><span class="s1">&#39;,&#39;</span><span class="n">overwrite</span><span class="s1">&#39; or &#39;</span><span class="n">duplicate</span><span class="s1">&#39;. </span>
<span class="s1">    false: don&#39;</span><span class="n">t</span> <span class="n">write</span> <span class="n">to</span> <span class="n">file</span>
    <span class="n">overwrite</span><span class="o">:</span> <span class="n">overwrite</span> <span class="n">copasi_file</span>
    <span class="n">duplicate</span><span class="o">:</span> <span class="n">write</span> <span class="n">a</span> <span class="k">new</span> <span class="n">file</span> <span class="n">named</span> <span class="n">using</span> <span class="n">the</span> <span class="n">kwarg</span> <span class="n">OutputML</span>

<span class="n">OutputML</span><span class="o">:</span> 
    <span class="n">When</span> <span class="n">Save</span> <span class="kd">set</span> <span class="n">to</span> <span class="s1">&#39;duplicate&#39;</span><span class="o">,</span> <span class="k">this</span> <span class="k">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span>


<span class="n">Variable</span><span class="o">:</span> 
    <span class="n">When</span> <span class="n">ReportType</span> <span class="k">is</span> <span class="n">profilelikelihood</span><span class="o">,</span> <span class="n">theta</span> <span class="k">is</span> <span class="n">the</span> <span class="n">parameter</span> <span class="n">of</span> <span class="n">interest</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Reports</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates reports in copasi output specification section. </span>
<span class="sd">    Use: </span>
<span class="sd">        -the ReportType kwarg to specify which type of report you want to make</span>
<span class="sd">        -the Metabolites and GlobalQuantities kwargs to specify which parameters</span>
<span class="sd">        to include</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            The copasi file you want to add a report too</span>
<span class="sd">        </span>
<span class="sd">    **kwargs:</span>

<span class="sd">        ReportType: </span>
<span class="sd">            Which report to write. Options:</span>
<span class="sd">                profilelikleihood:</span>
<span class="sd">                    - for Pydentify, shouldn&#39;t need to manually touch this</span>
<span class="sd">                time_course:</span>
<span class="sd">                    -a table of time Vs concentrations. Included values are specified to the Metabolites and//or GlobalQuantities arguments</span>
<span class="sd">            parameter_estimation:</span>
<span class="sd">                    -a table of values from a parameter estimation and the residual sum of squares value for each run. </span>

<span class="sd">    </span>
<span class="sd">        Metabolites:</span>
<span class="sd">            A list of valid model metabolites you want to include in the report. Default=All metabolites</span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities;</span>
<span class="sd">            List of valid global quantities that you want to include in the report. Default=All global variables</span>
<span class="sd">        </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            Either &#39;concentration&#39; or &#39;particle_number&#39;. Switch between having report output in either concentration of in particle_numbers. </span>

<span class="sd">        ReportName:</span>
<span class="sd">            Name of the report. Default depends on kwarg ReportType</span>
<span class="sd">        </span>
<span class="sd">        Append: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Append to report. Default &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        ConfirmOverwrite: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;.  Default= &#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        Save: </span>
<span class="sd">            either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;. </span>
<span class="sd">            false: don&#39;t write to file</span>
<span class="sd">            overwrite: overwrite copasi_file</span>
<span class="sd">            duplicate: write a new file named using the kwarg OutputML</span>
<span class="sd">        </span>
<span class="sd">        OutputML: </span>
<span class="sd">            When Save set to &#39;duplicate&#39;, this is the name of the file</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        Variable: </span>
<span class="sd">            When ReportType is profilelikelihood, theta is the parameter of interest</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
<span class="c1">#        default_report_name=os.path.split(self.copasi_file)[1][:-4]+&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;Separator&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                 <span class="c1">#</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#only for profile_likelihood</span>
        
                 <span class="p">}</span>
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Reports&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                 
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;valid report types include {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
        
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>     
        
        <span class="n">quantity_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_types</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_profilelikelihood.txt&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_time_course.txt&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_parameter_estimation.txt&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_all_reports</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">timecourse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        creates a report to collect time course results. </span>
<span class="sd">        </span>
<span class="sd">        By default all species and all global quantities are used with </span>
<span class="sd">        Time on the left most column. This behavior can be overwritten by passing</span>
<span class="sd">        lists of metabolites to the Metabolites keyword or global quantities to the</span>
<span class="sd">        global quantities keyword</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>              
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_30&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Objects for the report to report</span>
        <span class="n">time</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="c1">#first element always time. </span>
        <span class="n">time</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;CN=Root,Model={},Reference=Time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_model_name_cn</span><span class="p">())</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generate more SubElements dynamically</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=ParticleNumber&#39;</span>
            <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">profile_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create report of a parameter and best value for a parameter estimation </span>
<span class="sd">        for profile likelihoods</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_31&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Scan&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">})</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        

    <span class="k">def</span> <span class="nf">parameter_estimation_with_function_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Define a parameter estimation report and include the progression </span>
<span class="sd">        of the parameter estimation (function evaluations).</span>
<span class="sd">        Defaults to including all</span>
<span class="sd">        metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">        These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">        keywords. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_32&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
        
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Objects for the report to report</span>
<span class="c1">#        time=etree.SubElement(table,&#39;Object&#39;)</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        generate more SubElements dynamically</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
            <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
                <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
                
        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
                <span class="c1">#add to xml</span>
                <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
                
                
        <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     


    <span class="k">def</span> <span class="nf">parameter_estimation_broken</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        IMPORTANT</span>
<span class="sd">        THIS FUNCTION GIVES THE ORIGINAL PARAMETER VALUES</span>
<span class="sd">        NOT THE RESULTS OF THE PARAMTEER ESTIMATION</span>
<span class="sd">        </span>
<span class="sd">        Define a parameter estimation report. Defaults to including all</span>
<span class="sd">        metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">        These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">        keywords</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get existing report keys</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
        
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_33&#39;</span>
        <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                           <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
<span class="c1">#        </span>
        <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
        <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
        <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
        <span class="n">header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Header&#39;</span><span class="p">)</span>
        <span class="n">body</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Body&#39;</span><span class="p">)</span>
        <span class="n">footer</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Footer&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_sep</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">),</span><span class="s1">&#39;parent element needs to be an etree element&#39;</span>
            <span class="n">sep</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span><span class="c1">#,attrib={&#39;cn&#39;:&#39;Separator={}&#39;.format()})   </span>
            <span class="n">sep</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Separator={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sep</span>
        
        <span class="c1">#for metabolites</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration,Property=DisplayName&#39;</span>
                    <span class="n">foot_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
                
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                    <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber,Property=DisplayName&#39;</span>
                    <span class="n">foot_cn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
                
                <span class="c1">#add to xml</span>
                <span class="c1">#header</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">head_cn</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="c1">#footer    </span>
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">foot_cn</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>

        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue,Property=DisplayName&#39;</span>
                <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>


                <span class="c1">#add to xml</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                
                
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
                
                
        <span class="c1">#for global quantities </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
                <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value,Property=DisplayName&#39;</span>
                <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>


                <span class="c1">#add to xml</span>
                <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
                <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
                <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
<span class="c1">#                </span>
        <span class="n">best_value_header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">best_value_header</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value,Property=DisplayName&quot;</span>
        <span class="n">best_value_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
        <span class="n">best_value_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     
        
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Execute code that builds the report defined by the kwargs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_estimation_with_function_evaluations</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_likelihood</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timecourse</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">report_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        remove report called report_name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">report_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} not a valid report type. These are valid report types: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">report_name</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
                <span class="n">report_name</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">report_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">clear_all_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Having multile reports defined at once can be really annoying</span>
<span class="sd">        and give you unexpected results. Use this function to remove all reports</span>
<span class="sd">        before defining a new one to ensure you only have one active report any once. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.Reports">Reports</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.Reports.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Reports.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Reports.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Reports.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Reports.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Reports.report_types" class="name">var <span class="ident">report_types</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    
     <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
             <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;LocalParameters&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">(),</span>
             <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
             <span class="s1">&#39;Separator&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
             <span class="c1">#</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="c1">#only for profile_likelihood</span>
    
             <span class="p">}</span>
                 
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Reports&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
             
             
    <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;valid report types include {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
    
    <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span>     
    
    <span class="n">quantity_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_types</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_all_model_variables</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
            <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_profilelikelihood.txt&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_time_course.txt&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_parameter_estimation.txt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_all_reports</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.clear_all_reports">
    <p>def <span class="ident">clear_all_reports</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Having multile reports defined at once can be really annoying
and give you unexpected results. Use this function to remove all reports
before defining a new one to ensure you only have one active report any once.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.clear_all_reports', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.clear_all_reports" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">clear_all_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Having multile reports defined at once can be really annoying</span>
<span class="sd">    and give you unexpected results. Use this function to remove all reports</span>
<span class="sd">    before defining a new one to ensure you only have one active report any once. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.parameter_estimation_broken">
    <p>def <span class="ident">parameter_estimation_broken</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>IMPORTANT
THIS FUNCTION GIVES THE ORIGINAL PARAMETER VALUES
NOT THE RESULTS OF THE PARAMTEER ESTIMATION</p>
<p>Define a parameter estimation report. Defaults to including all
metabolites, global variables and local variables with the RSS best value
These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites
keywords</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.parameter_estimation_broken', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.parameter_estimation_broken" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parameter_estimation_broken</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    IMPORTANT</span>
<span class="sd">    THIS FUNCTION GIVES THE ORIGINAL PARAMETER VALUES</span>
<span class="sd">    NOT THE RESULTS OF THE PARAMTEER ESTIMATION</span>
<span class="sd">    </span>
<span class="sd">    Define a parameter estimation report. Defaults to including all</span>
<span class="sd">    metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">    These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">    keywords</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#get existing report keys</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
    
    <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_33&#39;</span>
    <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">),</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                       <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
     
    <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
    <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
    <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
    <span class="n">header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Header&#39;</span><span class="p">)</span>
    <span class="n">body</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Body&#39;</span><span class="p">)</span>
    <span class="n">footer</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Footer&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_sep</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">etree</span><span class="o">.</span><span class="n">_Element</span><span class="p">),</span><span class="s1">&#39;parent element needs to be an etree element&#39;</span>
        <span class="n">sep</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span><span class="c1">#,attrib={&#39;cn&#39;:&#39;Separator={}&#39;.format()})   </span>
        <span class="n">sep</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Separator={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Separator&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sep</span>
    
    <span class="c1">#for metabolites</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration,Property=DisplayName&#39;</span>
                <span class="n">foot_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
            
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                <span class="n">head_cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber,Property=DisplayName&#39;</span>
                <span class="n">foot_cn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
            
            <span class="c1">#add to xml</span>
            <span class="c1">#header</span>
            <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">head_cn</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="c1">#footer    </span>
            <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">foot_cn</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
    <span class="c1">#for global quantities </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue,Property=DisplayName&#39;</span>
            <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
            <span class="c1">#add to xml</span>
            <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            
            
            <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
            
            
    <span class="c1">#for global quantities </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
            <span class="n">cn_head</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value,Property=DisplayName&#39;</span>
            <span class="n">cn_foot</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
            <span class="c1">#add to xml</span>
            <span class="n">Object_head</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_head</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_head</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="n">Object_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn_foot</span>
            <span class="n">add_sep</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span>
             
    <span class="n">best_value_header</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
    <span class="n">best_value_header</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value,Property=DisplayName&quot;</span>
    <span class="n">best_value_foot</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
    <span class="n">best_value_foot</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.parameter_estimation_with_function_evaluations">
    <p>def <span class="ident">parameter_estimation_with_function_evaluations</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Define a parameter estimation report and include the progression 
of the parameter estimation (function evaluations).
Defaults to including all
metabolites, global variables and local variables with the RSS best value
These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites
keywords.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.parameter_estimation_with_function_evaluations', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.parameter_estimation_with_function_evaluations" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parameter_estimation_with_function_evaluations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Define a parameter estimation report and include the progression </span>
<span class="sd">    of the parameter estimation (function evaluations).</span>
<span class="sd">    Defaults to including all</span>
<span class="sd">    metabolites, global variables and local variables with the RSS best value</span>
<span class="sd">    These can be over-ridden with the GlobalQuantities, LocalParameters and Metabolites</span>
<span class="sd">    keywords. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#get existing report keys</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>            
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">)</span>
    
    <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_32&#39;</span>
    <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                       <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;parameterFitting&#39;</span><span class="p">}</span>
    
    <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
    <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
    <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
    <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#Objects for the report to report</span>
     <span class="n">time</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    generate more SubElements dynamically</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#for metabolites</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
        <span class="c1">#add to xml</span>
            <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
    <span class="c1">#for global quantities </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
            <span class="c1">#add to xml</span>
            <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
            
    <span class="c1">#for global quantities </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
            <span class="c1">#add to xml</span>
            <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
            
            
    <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
    <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>     
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.profile_likelihood">
    <p>def <span class="ident">profile_likelihood</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Create report of a parameter and best value for a parameter estimation 
for profile likelihoods</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.profile_likelihood', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.profile_likelihood" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">profile_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create report of a parameter and best value for a parameter estimation </span>
<span class="sd">    for profile likelihoods</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#get existing report keys</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">)</span>
    
    <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_31&#39;</span>
    <span class="k">while</span> <span class="n">new_key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                       <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Scan&#39;</span><span class="p">}</span>
    
    <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
    
    <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
    <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
        <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
        <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span><span class="c1">#{}&#39;.format(self.kwargs.get(&#39;QuantityType&#39;))</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">})</span>
    <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cn&#39;</span><span class="p">:</span><span class="s2">&quot;CN=Root,Vector=TaskList[Parameter Estimation],Problem=Parameter Estimation,Reference=Best Value&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.remove_report">
    <p>def <span class="ident">remove_report</span>(</p><p>self, report_name)</p>
    </div>
    

    
  
    <div class="desc"><p>remove report called report_name</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.remove_report', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.remove_report" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">report_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    remove report called report_name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">report_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} not a valid report type. These are valid report types: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">report_types</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">report_name</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="n">report_name</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">report_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Execute code that builds the report defined by the kwargs</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Execute code that builds the report defined by the kwargs</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameter_estimation_with_function_evaluations</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_likelihood</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timecourse</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Reports.timecourse">
    <p>def <span class="ident">timecourse</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>creates a report to collect time course results. </p>
<p>By default all species and all global quantities are used with 
Time on the left most column. This behavior can be overwritten by passing
lists of metabolites to the Metabolites keyword or global quantities to the
global quantities keyword</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Reports.timecourse', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Reports.timecourse" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">timecourse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    creates a report to collect time course results. </span>
<span class="sd">    </span>
<span class="sd">    By default all species and all global quantities are used with </span>
<span class="sd">    Time on the left most column. This behavior can be overwritten by passing</span>
<span class="sd">    lists of metabolites to the Metabolites keyword or global quantities to the</span>
<span class="sd">    global quantities keyword</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#get existing report keys</span>
    <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>              
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_report</span><span class="p">(</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
    
    <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_30&#39;</span>
    <span class="k">while</span> <span class="n">new_key</span>  <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new_key</span><span class="o">=</span><span class="s1">&#39;Report_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
    <span class="n">report_attributes</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="n">new_key</span><span class="p">,</span> 
                       <span class="s1">&#39;taskType&#39;</span><span class="p">:</span> <span class="s1">&#39;Time-Course&#39;</span><span class="p">}</span>
    
    <span class="n">ListOfReports</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">ListOfReports</span><span class="p">,</span><span class="s1">&#39;Report&#39;</span><span class="p">)</span>
    <span class="n">report</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attributes</span><span class="p">)</span>
    <span class="n">comment</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Comment&#39;</span><span class="p">)</span> 
    <span class="n">comment</span><span class="o">=</span><span class="n">comment</span> <span class="c1">#get rid of annoying squiggly line above</span>
    <span class="n">table</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">report</span><span class="p">,</span><span class="s1">&#39;Table&#39;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;printTitle&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#Objects for the report to report</span>
    <span class="n">time</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
    <span class="c1">#first element always time. </span>
    <span class="n">time</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;CN=Root,Model={},Reference=Time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_model_name_cn</span><span class="p">())</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    generate more SubElements dynamically</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#for metabolites</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Concentration&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_numbers&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=ParticleNumber&#39;</span>
        <span class="c1">#add to xml</span>
            <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
    <span class="c1">#for global quantities </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
            <span class="n">Object</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="s1">&#39;Object&#39;</span><span class="p">)</span>
            <span class="n">Object</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cn</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.Run" class="name">class <span class="ident">Run</span></p>
      
  
    <div class="desc"><p>Run a copasi file using CopasiSE. Run will deactivate all tasks from 
being executable via CopasiSE then activate the task you want to run, 
then run it. </p>
<p>copasi_file:
    The copasi file you want to run </p>
<p>**kwargs:</p>
<div class="codehilite"><pre><span></span><span class="n">Task</span><span class="o">:</span>
    <span class="n">Any</span> <span class="n">valid</span> <span class="n">copasi</span> <span class="n">task</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="n">time_course</span><span class="o">.</span> <span class="n">Options</span> <span class="n">are</span> 
    <span class="o">[</span><span class="s1">&#39;steady_state&#39;</span><span class="o">,</span><span class="s1">&#39;time_course&#39;</span><span class="o">,</span><span class="s1">&#39;scan&#39;</span><span class="o">,</span><span class="s1">&#39;fluxmode&#39;</span><span class="o">,</span><span class="s1">&#39;optimization&#39;</span><span class="o">,</span>
    <span class="s1">&#39;parameter_estimation&#39;</span><span class="o">,</span><span class="s1">&#39;metaboliccontrolanalysis&#39;</span><span class="o">,</span><span class="s1">&#39;lyapunovexponents&#39;</span><span class="o">,</span>
    <span class="s1">&#39;timescaleseparationanalysis&#39;</span><span class="o">,</span><span class="s1">&#39;sensitivities&#39;</span><span class="o">,</span><span class="s1">&#39;moieties&#39;</span><span class="o">,</span>
    <span class="s1">&#39;crosssection&#39;</span><span class="o">,</span><span class="s1">&#39;linearnoiseapproximation&#39;</span><span class="o">]</span>

<span class="n">Save</span><span class="o">:</span>
    <span class="n">Either</span> <span class="s1">&#39;false&#39;</span><span class="o">,</span><span class="s1">&#39;duplicate&#39;</span> <span class="n">or</span> <span class="s1">&#39;overwrite&#39;</span><span class="o">.</span> <span class="n">Should</span> <span class="n">probably</span> <span class="n">remain</span> 
    <span class="n">on</span> <span class="s1">&#39;overwrite&#39;</span><span class="o">,</span> <span class="n">the</span> <span class="k">default</span><span class="o">.</span>

<span class="n">Mode</span><span class="o">:</span>
    <span class="s1">&#39;true&#39;</span><span class="o">,</span> <span class="s1">&#39;false&#39;</span><span class="o">,</span><span class="s1">&#39;multiprocess&#39;</span><span class="o">,</span> <span class="n">or</span> <span class="s1">&#39;SGE&#39;</span><span class="o">.</span> <span class="n">Default</span> <span class="k">is</span> <span class="s1">&#39;true&#39;</span> <span class="n">but</span> <span class="n">can</span> <span class="n">be</span> <span class="n">turned</span> <span class="n">off</span> <span class="k">if</span> <span class="n">you</span> 
    <span class="n">want</span> <span class="n">to</span> <span class="n">uncheck</span> <span class="n">all</span> <span class="n">executable</span> <span class="n">boxes</span> <span class="n">then</span> <span class="n">check</span> <span class="n">the</span> <span class="n">Task</span> <span class="n">executable</span>

<span class="n">MaxTime</span><span class="o">:</span>
    <span class="n">Default</span> <span class="n">None</span><span class="o">.</span> <span class="n">Max</span> <span class="n">time</span> <span class="k">in</span> <span class="n">seconds</span> <span class="k">for</span> <span class="n">copasi</span> <span class="n">to</span> <span class="n">be</span> <span class="n">allowed</span> <span class="n">to</span> <span class="n">run</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Run</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a copasi file using CopasiSE. Run will deactivate all tasks from </span>
<span class="sd">    being executable via CopasiSE then activate the task you want to run, </span>
<span class="sd">    then run it. </span>
<span class="sd">    </span>
<span class="sd">    copasi_file:</span>
<span class="sd">        The copasi file you want to run </span>
<span class="sd">    </span>
<span class="sd">    **kwargs:</span>
<span class="sd">    </span>
<span class="sd">        Task:</span>
<span class="sd">            Any valid copasi task. Default=time_course. Options are </span>
<span class="sd">            [&#39;steady_state&#39;,&#39;time_course&#39;,&#39;scan&#39;,&#39;fluxmode&#39;,&#39;optimization&#39;,</span>
<span class="sd">            &#39;parameter_estimation&#39;,&#39;metaboliccontrolanalysis&#39;,&#39;lyapunovexponents&#39;,</span>
<span class="sd">            &#39;timescaleseparationanalysis&#39;,&#39;sensitivities&#39;,&#39;moieties&#39;,</span>
<span class="sd">            &#39;crosssection&#39;,&#39;linearnoiseapproximation&#39;]</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            Either &#39;false&#39;,&#39;duplicate&#39; or &#39;overwrite&#39;. Should probably remain </span>
<span class="sd">            on &#39;overwrite&#39;, the default. </span>
<span class="sd">            </span>
<span class="sd">        Mode:</span>
<span class="sd">            &#39;true&#39;, &#39;false&#39;,&#39;multiprocess&#39;, or &#39;SGE&#39;. Default is &#39;true&#39; but can be turned off if you </span>
<span class="sd">            want to uncheck all executable boxes then check the Task executable</span>
<span class="sd">            </span>
<span class="sd">        MaxTime:</span>
<span class="sd">            Default None. Max time in seconds for copasi to be allowed to run</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.sh&#39;</span>
        
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Task&#39;</span><span class="p">:</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Mode&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MaxTime&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
                                  
                 
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Run&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>    


        <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
               <span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;fluxmode&#39;</span><span class="p">,</span><span class="s1">&#39;optimization&#39;</span><span class="p">,</span>
               <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="s1">&#39;metaboliccontrolanalysis&#39;</span><span class="p">,</span>
               <span class="s1">&#39;lyapunovexponents&#39;</span><span class="p">,</span><span class="s1">&#39;timescaleseparationanalysis&#39;</span><span class="p">,</span>
               <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;moieties&#39;</span><span class="p">,</span><span class="s1">&#39;crosssection&#39;</span><span class="p">,</span>
               <span class="s1">&#39;linearnoiseapproximation&#39;</span><span class="p">]</span>
                   
        
                  
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid task. Choose from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">),</span><span class="n">tasks</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;MaxTime argument must be float or int&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;timecourse&#39;</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameterfitting&#39;</span>        
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;steady_state&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;steadystate&#39;</span>        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_task</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">submit_copasi_job_SGE</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;multiprocess&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multi_run</span><span class="p">()</span>
            
            

    <span class="k">def</span> <span class="nf">multi_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">:</span>
                <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">0</span>


        
    <span class="k">def</span> <span class="nf">set_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;false&#39;</span> <span class="c1">#set all to false</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;true&#39;</span>
                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Process the copasi file using CopasiSE</span>
<span class="sd">        Must be Copasi version 16</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="s1">&#39;--maxTime&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">output</span><span class="p">,</span><span class="n">err</span><span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">output</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">err</span>
        <span class="k">if</span> <span class="n">err</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">CopasiError</span><span class="p">(</span><span class="s1">&#39;Failed with Copasi error: </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">submit_copasi_job_SGE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Submit copasi file as job to SGE based job scheduler. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#!/bin/bash</span><span class="se">\n</span><span class="s1">#$ -V -cwd</span><span class="se">\n</span><span class="s1">module add apps/COPASI/4.16.104-Linux-64bit</span><span class="se">\n</span><span class="s1">CopasiSE {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
        <span class="c1">## -N option for job name </span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;qsub {} -N {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">))</span>
        <span class="c1">## remove .sh file after used. </span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">)</span>
    
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.Run">Run</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.Run.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Run.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Run.SGE_job_file" class="name">var <span class="ident">SGE_job_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Run.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Run.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Run.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.Run.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.sh&#39;</span>
    
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Task&#39;</span><span class="p">:</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Mode&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;MaxTime&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
                              
             
                 
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Run&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>    
    <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
           <span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;fluxmode&#39;</span><span class="p">,</span><span class="s1">&#39;optimization&#39;</span><span class="p">,</span>
           <span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span><span class="s1">&#39;metaboliccontrolanalysis&#39;</span><span class="p">,</span>
           <span class="s1">&#39;lyapunovexponents&#39;</span><span class="p">,</span><span class="s1">&#39;timescaleseparationanalysis&#39;</span><span class="p">,</span>
           <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;moieties&#39;</span><span class="p">,</span><span class="s1">&#39;crosssection&#39;</span><span class="p">,</span>
           <span class="s1">&#39;linearnoiseapproximation&#39;</span><span class="p">]</span>
               
    
              
    <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;{} is not a valid task. Choose from {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">),</span><span class="n">tasks</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">))</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;MaxTime argument must be float or int&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;timecourse&#39;</span>
        
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;parameterfitting&#39;</span>        
        
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;steady_state&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Task&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;steadystate&#39;</span>        
    
    
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_task</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">submit_copasi_job_SGE</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Mode&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;multiprocess&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_run</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Run.multi_run">
    <p>def <span class="ident">multi_run</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.multi_run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.multi_run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">multi_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;CopasiSE &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">:</span>
            <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Process</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Run.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Process the copasi file using CopasiSE
Must be Copasi version 16</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Process the copasi file using CopasiSE</span>
<span class="sd">    Must be Copasi version 16</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="s1">&#39;--maxTime&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxTime&#39;</span><span class="p">)),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
    <span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">output</span><span class="p">,</span><span class="n">err</span><span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">output</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">err</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">CopasiError</span><span class="p">(</span><span class="s1">&#39;Failed with Copasi error: </span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Run.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Run.set_task">
    <p>def <span class="ident">set_task</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.set_task', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.set_task" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfTasks&#39;</span><span class="p">):</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;false&#39;</span> <span class="c1">#set all to false</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">)</span><span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;true&#39;</span>
            
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Run.submit_copasi_job_SGE">
    <p>def <span class="ident">submit_copasi_job_SGE</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Submit copasi file as job to SGE based job scheduler.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Run.submit_copasi_job_SGE', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Run.submit_copasi_job_SGE" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">submit_copasi_job_SGE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Submit copasi file as job to SGE based job scheduler. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#!/bin/bash</span><span class="se">\n</span><span class="s1">#$ -V -cwd</span><span class="se">\n</span><span class="s1">module add apps/COPASI/4.16.104-Linux-64bit</span><span class="se">\n</span><span class="s1">CopasiSE {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
    <span class="c1">## -N option for job name </span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;qsub {} -N {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">))</span>
    <span class="c1">## remove .sh file after used. </span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SGE_job_file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.Scan" class="name">class <span class="ident">Scan</span></p>
      
  
    <div class="desc"><p>Positional Args:
    copasi_file:
        the copasi file you want to scan</p>
<p>**kwargs:
    ScanType:
        Which type of scan do you want to set up. 
        Options are ['scan','repeat','random_sampling']</p>
<div class="codehilite"><pre><span></span><span class="n">Metabolites</span><span class="o">:</span>
    <span class="n">Metabolites</span> <span class="n">to</span> <span class="n">pass</span> <span class="n">to</span> <span class="n">report</span>

<span class="n">GlobalQuantities</span><span class="o">:</span>
    <span class="n">global</span> <span class="n">wuantities</span> <span class="n">to</span> <span class="n">pass</span> <span class="n">to</span> <span class="n">report</span>

<span class="n">QuantityType</span><span class="o">:</span>
    <span class="n">either</span> <span class="s1">&#39;concentration&#39;</span> <span class="n">or</span> <span class="s1">&#39;particle_number&#39;</span>

<span class="n">ReportName</span><span class="o">:</span>
    <span class="n">Name</span> <span class="n">the</span> <span class="n">output</span> <span class="n">report</span>

<span class="n">Append</span><span class="o">:</span>
    <span class="n">Check</span> <span class="n">the</span> <span class="n">Append</span> <span class="n">button</span> <span class="k">in</span> <span class="n">copasi</span> <span class="n">scan</span> <span class="n">task</span><span class="o">.</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">ConfirmOverwrite</span><span class="o">:</span>
    <span class="n">Check</span> <span class="n">the</span> <span class="n">confirm</span> <span class="n">overwrite</span> <span class="n">button</span> <span class="k">in</span> <span class="n">copasi</span> <span class="n">scan</span><span class="o">.</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">OutputML</span><span class="o">:</span>
    <span class="n">If</span> <span class="n">Save</span> <span class="kd">set</span> <span class="n">to</span> <span class="n">duplicate</span><span class="o">,</span> <span class="k">this</span> <span class="k">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> 
    <span class="n">the</span> <span class="n">duplicated</span> <span class="n">copasi</span> <span class="n">file</span><span class="o">.</span><span class="na">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> 
    <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">UpdateModel</span><span class="o">:</span>
    <span class="n">Check</span> <span class="n">the</span> <span class="n">update</span> <span class="n">model</span> <span class="n">button</span> <span class="k">in</span> <span class="n">copasi</span> <span class="n">scan</span> <span class="n">task</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">SubTask</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">valid</span> <span class="n">scan</span> <span class="n">subtask</span><span class="o">.</span> <span class="n">Options</span> <span class="n">are</span><span class="o">:</span>
    <span class="o">[</span><span class="s1">&#39;steady_state&#39;</span><span class="o">,</span><span class="s1">&#39;time_course&#39;</span><span class="o">,</span><span class="s1">&#39;metabolic_control_nalysis&#39;</span><span class="o">,</span>
    <span class="s1">&#39;lyapunov_exponents&#39;</span><span class="o">,</span><span class="s1">&#39;optimiztion&#39;</span><span class="o">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="o">,</span>
    <span class="s1">&#39;sensitivities&#39;</span><span class="o">,</span><span class="s1">&#39;linear_noise_approximation&#39;</span><span class="o">,</span><span class="s1">&#39;cross_section&#39;</span><span class="o">,</span>
    <span class="s1">&#39;time_scale_separation_analysis&#39;</span><span class="o">]</span>

<span class="n">ReportType</span><span class="o">:</span>
    <span class="n">Which</span> <span class="n">type</span> <span class="n">of</span> <span class="n">report</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span> <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;none&#39;</span><span class="o">,</span>
    <span class="s1">&#39;profilelikelihood&#39;</span><span class="o">,</span><span class="s1">&#39;time_course&#39;</span><span class="o">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="o">]</span>

<span class="n">OutputInSubtask</span><span class="o">:</span>
    <span class="n">Check</span> <span class="n">the</span> <span class="n">OutputInSubtask</span> <span class="n">button</span> <span class="k">in</span> <span class="n">copasi</span> <span class="n">scan</span> <span class="n">task</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">AdjustInitialConditions</span><span class="o">:</span>
    <span class="n">Check</span> <span class="n">the</span> <span class="n">AdjustInitialConditions</span> <span class="n">button</span> <span class="k">in</span> <span class="n">copasi</span> <span class="n">scan</span> <span class="n">task</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">NumberOfSteps</span><span class="o">:</span>
    <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Intervals</span> <span class="n">box</span> <span class="k">in</span> <span class="n">Copasi</span> <span class="n">GUI</span> <span class="n">or</span> <span class="n">number</span>
    <span class="n">of</span> <span class="n">repeats</span> <span class="k">in</span> <span class="k">case</span> <span class="n">your</span> <span class="n">using</span> <span class="n">the</span> <span class="n">Task</span><span class="o">=</span><span class="s1">&#39;repeat&#39;</span> <span class="n">option</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mi">10</span><span class="o">.</span>

<span class="n">Maximum</span><span class="o">:</span> 
    <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Maximum</span> <span class="n">box</span> <span class="k">in</span> <span class="n">Copasi</span> <span class="n">GUI</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mi">100</span><span class="o">.</span>

<span class="n">Minimum</span><span class="o">:</span> 
    <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Minimum</span> <span class="n">box</span> <span class="k">in</span> <span class="n">Copasi</span> <span class="n">GUI</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mf">0.01</span><span class="o">.</span>

<span class="n">Log</span><span class="o">:</span> 
    <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Log</span> <span class="n">box</span> <span class="k">in</span> <span class="n">Copasi</span> <span class="n">GUI</span><span class="o">.</span>
    <span class="n">Options</span> <span class="n">are</span> <span class="o">[</span><span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">],</span> <span class="k">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="o">.</span>

<span class="n">DistributionType</span><span class="o">:</span>
    <span class="n">When</span> <span class="n">ScanType</span> <span class="kd">set</span> <span class="n">to</span> <span class="s1">&#39;random_sampling&#39;</span><span class="o">,</span> <span class="n">can</span> <span class="n">be</span> <span class="n">any</span> <span class="n">of</span>
    <span class="o">[</span><span class="s1">&#39;normal&#39;</span><span class="o">,</span><span class="s1">&#39;uniform&#39;</span><span class="o">,</span><span class="s1">&#39;poisson&#39;</span><span class="o">,</span><span class="s1">&#39;gamma&#39;</span><span class="o">].</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span>

<span class="n">Variable</span><span class="o">:</span>
    <span class="n">The</span> <span class="n">target</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Scan</span><span class="o">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">model</span> <span class="n">entity</span><span class="o">.</span> 
    <span class="n">Defaults</span> <span class="n">to</span> <span class="n">the</span> <span class="n">first</span> <span class="n">key</span> <span class="k">in</span> <span class="n">the</span> <span class="n">GMQ</span><span class="o">.</span><span class="na">get_metabolites</span><span class="o">()</span> <span class="n">method</span>

<span class="n">Scheduled</span><span class="o">:</span> 
    <span class="n">Corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Scheduled</span> <span class="n">box</span> <span class="k">in</span> <span class="n">Copasi</span> <span class="n">GUI</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="o">.</span>

<span class="n">Save</span><span class="o">:</span>
    <span class="n">Can</span> <span class="n">be</span> <span class="n">one</span> <span class="n">of</span> <span class="o">[</span><span class="s1">&#39;duplicate&#39;</span><span class="o">,</span><span class="s1">&#39;false&#39;</span><span class="o">,</span><span class="s1">&#39;overwrite&#39;</span><span class="o">].</span> <span class="n">Duplicate</span>
    <span class="n">will</span> <span class="n">copy</span> <span class="n">copasi</span> <span class="n">file</span> <span class="n">to</span> <span class="n">different</span> <span class="n">file</span> <span class="n">name</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;overwrite&#39;</span>

<span class="n">ClearScans</span><span class="o">:</span>
    <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span><span class="o">.</span> <span class="n">If</span> <span class="s1">&#39;true&#39;</span> <span class="n">will</span> <span class="n">remove</span> <span class="n">all</span> <span class="n">scans</span> <span class="n">present</span> <span class="n">before</span>
    <span class="n">adding</span> <span class="n">scans</span><span class="o">.</span> <span class="n">If</span> <span class="kc">false</span><span class="o">,</span> <span class="n">will</span> <span class="n">add</span> <span class="n">another</span> <span class="n">scan</span> <span class="k">in</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">any</span>
    <span class="n">scans</span> <span class="n">alredy</span> <span class="n">present</span><span class="o">.</span><span class="na">Default</span><span class="o">=</span><span class="s1">&#39;true&#39;</span>

<span class="n">Variable</span><span class="o">:</span>
    <span class="n">Only</span> <span class="n">used</span> <span class="n">when</span> <span class="n">the</span> <span class="n">report</span> <span class="k">is</span> <span class="n">profile</span> <span class="n">likelihood</span><span class="o">.</span> <span class="n">Corresponds</span> <span class="n">to</span> 
    <span class="n">parameter</span> <span class="n">of</span> <span class="n">interest</span><span class="o">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">model</span> <span class="n">entity</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="n">None</span>

<span class="n">Run</span><span class="o">:</span>
    <span class="n">Run</span> <span class="n">Scan</span> <span class="n">task</span> <span class="n">or</span> <span class="n">not</span><span class="o">.</span> <span class="s1">&#39;true&#39;</span> <span class="n">or</span> <span class="s1">&#39;false&#39;</span> <span class="n">or</span> <span class="s1">&#39;SGE&#39;</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Scan</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Positional Args:</span>
<span class="sd">        copasi_file:</span>
<span class="sd">            the copasi file you want to scan</span>

<span class="sd">    **kwargs:</span>
<span class="sd">        ScanType:</span>
<span class="sd">            Which type of scan do you want to set up. </span>
<span class="sd">            Options are [&#39;scan&#39;,&#39;repeat&#39;,&#39;random_sampling&#39;]</span>

<span class="sd">        Metabolites:</span>
<span class="sd">            Metabolites to pass to report </span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities:</span>
<span class="sd">            global wuantities to pass to report</span>
<span class="sd">            </span>
<span class="sd">        QuantityType:</span>
<span class="sd">            either &#39;concentration&#39; or &#39;particle_number&#39;</span>
<span class="sd">        </span>
<span class="sd">        ReportName:</span>
<span class="sd">            Name the output report</span>
<span class="sd">            </span>
<span class="sd">        Append:</span>
<span class="sd">            Check the Append button in copasi scan task.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            Check the confirm overwrite button in copasi scan.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>

<span class="sd">        OutputML:</span>
<span class="sd">            If Save set to duplicate, this is the name of </span>
<span class="sd">            the duplicated copasi file.Options are [&#39;true&#39; or &#39;false&#39;], </span>
<span class="sd">            default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Check the update model button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">        </span>
<span class="sd">        SubTask:</span>
<span class="sd">            A valid scan subtask. Options are:</span>
<span class="sd">            [&#39;steady_state&#39;,&#39;time_course&#39;,&#39;metabolic_control_nalysis&#39;,</span>
<span class="sd">            &#39;lyapunov_exponents&#39;,&#39;optimiztion&#39;,&#39;parameter_estimation&#39;,</span>
<span class="sd">            &#39;sensitivities&#39;,&#39;linear_noise_approximation&#39;,&#39;cross_section&#39;,</span>
<span class="sd">            &#39;time_scale_separation_analysis&#39;]</span>
<span class="sd">                   </span>
<span class="sd">        ReportType:</span>
<span class="sd">            Which type of report to use. Options are [&#39;none&#39;,</span>
<span class="sd">            &#39;profilelikelihood&#39;,&#39;time_course&#39;,&#39;parameter_estimation&#39;]</span>
<span class="sd">            </span>
<span class="sd">        OutputInSubtask:</span>
<span class="sd">            Check the OutputInSubtask button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>

<span class="sd">        AdjustInitialConditions:</span>
<span class="sd">            Check the AdjustInitialConditions button in copasi scan task</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">        NumberOfSteps:</span>
<span class="sd">            Corresponds to the Intervals box in Copasi GUI or number</span>
<span class="sd">            of repeats in case your using the Task=&#39;repeat&#39; option. Default=10. </span>
<span class="sd">            </span>
<span class="sd">        Maximum: </span>
<span class="sd">            Corresponds to the Maximum box in Copasi GUI. Default=100. </span>

<span class="sd">        Minimum: </span>
<span class="sd">            Corresponds to the Minimum box in Copasi GUI. Default=0.01. </span>

<span class="sd">        Log: </span>
<span class="sd">            Corresponds to the Log box in Copasi GUI.</span>
<span class="sd">            Options are [&#39;true&#39; or &#39;false&#39;], default=&#39;false&#39;.  </span>
<span class="sd">            </span>
<span class="sd">        DistributionType:</span>
<span class="sd">            When ScanType set to &#39;random_sampling&#39;, can be any of</span>
<span class="sd">            [&#39;normal&#39;,&#39;uniform&#39;,&#39;poisson&#39;,&#39;gamma&#39;]. Default=&#39;normal&#39;</span>
<span class="sd">            </span>
<span class="sd">        Variable:</span>
<span class="sd">            The target of the Scan. Must be a valid model entity. </span>
<span class="sd">            Defaults to the first key in the GMQ.get_metabolites() method</span>

<span class="sd">        Scheduled: </span>
<span class="sd">            Corresponds to the Scheduled box in Copasi GUI. Default=&#39;true&#39;.</span>
<span class="sd">            </span>
<span class="sd">        Save:</span>
<span class="sd">            Can be one of [&#39;duplicate&#39;,&#39;false&#39;,&#39;overwrite&#39;]. Duplicate</span>
<span class="sd">            will copy copasi file to different file name. Default=&#39;overwrite&#39;</span>
<span class="sd">            </span>
<span class="sd">        ClearScans:</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. If &#39;true&#39; will remove all scans present before</span>
<span class="sd">            adding scans. If false, will add another scan in addition to any</span>
<span class="sd">            scans alredy present.Default=&#39;true&#39;</span>
<span class="sd">        </span>
<span class="sd">        Variable:</span>
<span class="sd">            Only used when the report is profile likelihood. Corresponds to </span>
<span class="sd">            parameter of interest. Must be a model entity. Default=None</span>
<span class="sd">            </span>
<span class="sd">        Run:</span>
<span class="sd">            Run Scan task or not. &#39;true&#39; or &#39;false&#39; or &#39;SGE&#39;. Default=&#39;false&#39;</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="c1">#</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SubTask&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;Maximum&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
                 <span class="s1">&#39;Minimum&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="s1">&#39;Log&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;DistributionType&#39;</span><span class="p">:</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ScanType&#39;</span><span class="p">:</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span>
                 <span class="c1">#scan object specific (for scan and random_sampling ScanTypes)</span>
                 <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ClearScans&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="c1">#if true, will remove all scans present then add new scan</span>
                 <span class="s1">&#39;Run&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
                                  
                 
                     
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Scan&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
        
        <span class="c1">#correct OutputInSubtask and AsjestInitialConditions</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">],</span><span class="s1">&#39;{} is not either </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
        
        <span class="n">subtasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;metabolic_control_nalysis&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;lyapunov_exponents&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;optimiztion&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;linear_noise_approximation&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;cross_section&#39;</span><span class="p">,</span><span class="s1">&#39;time_scale_separation_analysis&#39;</span><span class="p">]</span>
                   
        <span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
        <span class="n">dist_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
        <span class="n">scan_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;repeat&#39;</span><span class="p">,</span><span class="s1">&#39;random_sampling&#39;</span><span class="p">]</span>
        <span class="n">quantity_type_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_number&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
        
                   
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">subtasks</span>                   
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} is not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">),</span><span class="n">report_types</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist_types</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">scan_types</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_type_list</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;SGE&#39;</span><span class="p">]</span>


        <span class="c1">#numericify the some keyword arguments</span>
        <span class="n">subtask_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subtasks</span><span class="p">,</span><span class="n">subtask_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SubTask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">#numericidy type keywork arguments </span>
        <span class="n">scan_type_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scan_types</span><span class="p">,</span><span class="n">scan_type_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ScanType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   
                
        <span class="n">dist_types_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dist_types</span><span class="p">,</span><span class="n">dist_types_numbers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
                
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
        
        <span class="c1">#convert what needs to be a string to a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">])</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">))</span>

<span class="c1">#        if self.kwargs.get(&#39;ReportType&#39;)==&#39;time_course&#39;:</span>
<span class="c1">#            self.kwargs[&#39;ReportType&#39;]=&#39;time-course&#39;</span>
        <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span><span class="p">,</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">),</span><span class="n">write_to_file_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_scans</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_scan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_scan_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
            
<span class="c1">#            PruneCopasiHeaders(self.kwargs[&#39;ReportName&#39;],replace=&#39;true&#39;)</span>
            
            
            
        
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
                
        
    <span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;defining report&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span>
        
        <span class="n">R</span><span class="o">=</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">copasiML</span>
        
        
    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#ammend the time course option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ReportDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;Report doesn</span><span class="se">\&#39;</span><span class="s1">t exist. Check to see if you have either defined the report manually or used the pycopi.Reports class&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">key</span>
        
    <span class="k">def</span> <span class="nf">create_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        need to find a report key which corresponds to the report we want to use</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#get cn value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cn</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>


        <span class="n">number_of_steps_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of steps&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">)}</span>
        <span class="n">scan_item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cn</span><span class="p">}</span>
        <span class="n">type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)}</span>
        <span class="n">maximum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">)}</span>
        <span class="n">minimum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">)}</span>
        <span class="n">log_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)}</span>
        <span class="n">dist_type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Distribution type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)}</span>

        <span class="n">scanItem_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;ScanItem&#39;</span><span class="p">})</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;2&#39;</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dist_type_attrib</span><span class="p">)</span>

        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">set_scan_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
                       <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span> 
                       <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                       <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
                       
        <span class="n">subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)}</span>
        <span class="n">output_in_subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Output in subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)}</span>
        <span class="n">adjust_initial_conditions_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)}</span>
        <span class="n">scheduled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span> <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
        
        <span class="n">R</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">report_attrib</span><span class="p">)</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Scan&quot;]&#39;</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        If scan task already has a report element defined, modify it, </span>
<span class="sd">        otherwise create a new report element directly under the ScanTask </span>
<span class="sd">        element</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">scan_task</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Problem&#39;</span><span class="p">:</span>
            <span class="n">scan_task</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Report&#39;</span><span class="p">:</span>
            <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduled_attrib</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Subtask&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subtask_attrib</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output in subtask&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">output_in_subtask_attrib</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adjust_initial_conditions_attrib</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">remove_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">i</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="c1">#            i.getparent().remove(i)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.Scan">Scan</a></li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.Scan.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Scan.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Scan.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Scan.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.Scan.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    
    <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_PE_results.txt&#39;</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_Duplicate.cps&#39;</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="c1">#report variables</span>
             <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
             <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
             <span class="c1">#</span>
             <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SubTask&#39;</span><span class="p">:</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportType&#39;</span><span class="p">:</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
             <span class="s1">&#39;Maximum&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
             <span class="s1">&#39;Minimum&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span>
             <span class="s1">&#39;Log&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;DistributionType&#39;</span><span class="p">:</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ScanType&#39;</span><span class="p">:</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span>
             <span class="c1">#scan object specific (for scan and random_sampling ScanTypes)</span>
             <span class="s1">&#39;Variable&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
             <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ClearScans&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="c1">#if true, will remove all scans present then add new scan</span>
             <span class="s1">&#39;Run&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">}</span>
                              
             
                 
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for Scan&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    
    <span class="c1">#correct OutputInSubtask and AsjestInitialConditions</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">],</span><span class="s1">&#39;{} is not either </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    
    <span class="n">subtasks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;steady_state&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span>
               <span class="s1">&#39;metabolic_control_nalysis&#39;</span><span class="p">,</span>
               <span class="s1">&#39;lyapunov_exponents&#39;</span><span class="p">,</span>
               <span class="s1">&#39;optimiztion&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">,</span>
               <span class="s1">&#39;sensitivities&#39;</span><span class="p">,</span><span class="s1">&#39;linear_noise_approximation&#39;</span><span class="p">,</span>
               <span class="s1">&#39;cross_section&#39;</span><span class="p">,</span><span class="s1">&#39;time_scale_separation_analysis&#39;</span><span class="p">]</span>
               
    <span class="n">report_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="s1">&#39;profilelikelihood&#39;</span><span class="p">,</span><span class="s1">&#39;time_course&#39;</span><span class="p">,</span><span class="s1">&#39;parameter_estimation&#39;</span><span class="p">]</span>
    <span class="n">dist_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
    <span class="n">scan_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="s1">&#39;repeat&#39;</span><span class="p">,</span><span class="s1">&#39;random_sampling&#39;</span><span class="p">]</span>
    <span class="n">quantity_type_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particle_number&#39;</span><span class="p">,</span><span class="s1">&#39;concentration&#39;</span><span class="p">]</span>
    
               
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">subtasks</span>                   
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">report_types</span><span class="p">,</span><span class="s1">&#39;{} is not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">),</span><span class="n">report_types</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dist_types</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">scan_types</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">quantity_type_list</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;SGE&#39;</span><span class="p">]</span>
    <span class="c1">#numericify the some keyword arguments</span>
    <span class="n">subtask_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subtasks</span><span class="p">,</span><span class="n">subtask_numbers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;SubTask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="c1">#numericidy type keywork arguments </span>
    <span class="n">scan_type_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">scan_types</span><span class="p">,</span><span class="n">scan_type_numbers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ScanType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   
            
    <span class="n">dist_types_numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dist_types</span><span class="p">,</span><span class="n">dist_types_numbers</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>    
            
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span>
    
    <span class="c1">#convert what needs to be a string to a string</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Log&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Maximum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">),(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Minimum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">))</span>
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
    <span class="n">write_to_file_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;duplicate&#39;</span><span class="p">,</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">write_to_file_list</span><span class="p">,</span><span class="s1">&#39;{} not in {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">),</span><span class="n">write_to_file_list</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ClearScans&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_scans</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">define_report</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_scan</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_scan_options</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.create_scan">
    <p>def <span class="ident">create_scan</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>need to find a report key which corresponds to the report we want to use</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.create_scan', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.create_scan" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    need to find a report key which corresponds to the report we want to use</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#get cn value</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialConcentration&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
            <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialParticleNumber&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cn</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=InitialValue&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cn</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_local_kinetic_parameters_cns</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)][</span><span class="s1">&#39;cn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;,Reference=Value&#39;</span>
    <span class="n">number_of_steps_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of steps&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NumberOfSteps&#39;</span><span class="p">)}</span>
    <span class="n">scan_item</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;cn&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Object&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cn</span><span class="p">}</span>
    <span class="n">type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)}</span>
    <span class="n">maximum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Maximum&#39;</span><span class="p">)}</span>
    <span class="n">minimum_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Minimum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Minimum&#39;</span><span class="p">)}</span>
    <span class="n">log_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Log&#39;</span><span class="p">)}</span>
    <span class="n">dist_type_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Distribution type&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DistributionType&#39;</span><span class="p">)}</span>
    <span class="n">scanItem_element</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;ParameterGroup&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;ScanItem&#39;</span><span class="p">})</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;0&#39;</span><span class="p">:</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ScanType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;2&#39;</span><span class="p">:</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">number_of_steps_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">type_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">scan_item</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">minimum_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">maximum_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">log_attrib</span><span class="p">)</span>
        <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">,</span><span class="s1">&#39;Parameter&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">dist_type_attrib</span><span class="p">)</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scanItem_element</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.define_report">
    <p>def <span class="ident">define_report</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.define_report', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.define_report" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">define_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;defining report&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="o">=</span><span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;Variable&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span>
    
    <span class="n">R</span><span class="o">=</span> <span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.get_report_key">
    <p>def <span class="ident">get_report_key</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.get_report_key', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.get_report_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#ammend the time course option</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;time_course&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time-course&#39;</span>
    <span class="n">key</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">ReportDoesNotExistError</span><span class="p">(</span><span class="s1">&#39;Report doesn</span><span class="se">\&#39;</span><span class="s1">t exist. Check to see if you have either defined the report manually or used the pycopi.Reports class&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.remove_scans">
    <p>def <span class="ident">remove_scans</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.remove_scans', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.remove_scans" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;ScanItems&quot;]&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
         <span class="n">i</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span><span class="n">Mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;false&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;SGE&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.Scan.set_scan_options">
    <p>def <span class="ident">set_scan_options</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.Scan.set_scan_options', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.Scan.set_scan_options" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_scan_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">report_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
                   <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span> 
                   <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">(),</span>
                   <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
                   
    <span class="n">subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;unsignedInteger&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SubTask&#39;</span><span class="p">)}</span>
    <span class="n">output_in_subtask_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Output in subtask&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputInSubtask&#39;</span><span class="p">)}</span>
    <span class="n">adjust_initial_conditions_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;bool&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AdjustInitialConditions&#39;</span><span class="p">)}</span>
    <span class="n">scheduled_attrib</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;scheduled&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">),</span> <span class="s1">&#39;updateModel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)}</span>
    
    <span class="n">R</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">report_attrib</span><span class="p">)</span>
    <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//*[@name=&quot;Scan&quot;]&#39;</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If scan task already has a report element defined, modify it, </span>
<span class="sd">    otherwise create a new report element directly under the ScanTask </span>
<span class="sd">    element</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scan_task</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Problem&#39;</span><span class="p">:</span>
        <span class="n">scan_task</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="o">==</span><span class="s1">&#39;{http://www.copasi.org/static/schema}Report&#39;</span><span class="p">:</span>
        <span class="n">scan_task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">report_attrib</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduled_attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Subtask&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subtask_attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output in subtask&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">output_in_subtask_attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Adjust initial conditions&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adjust_initial_conditions_attrib</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="pycopi.TimeCourse" class="name">class <span class="ident">TimeCourse</span></p>
      
  
    <div class="desc"><p>Run a time course using Copasi. Ensure, you specify the corrent amount
of time you want simulating. Do this by ensuring that End=StepSize*Intervals.
Set Plot='true' to automatically plot the results which can be found in a file
in the same directory as your copasi file in a folder named after your ReportName
kwarg</p>
<p>NOTE: Space has been left for addition of code to interface with the other
copasi solvers. Currently only deterministic is supported. </p>
<p>args:
    copasi_file - the copasi file you want to do a time course on </p>
<p>**kwargs:
    For arguments related to plotting, see the documentation for Plot</p>
<div class="codehilite"><pre><span></span><span class="n">Intervals</span><span class="o">:</span>
    <span class="n">How</span> <span class="n">many</span> <span class="n">intervals</span> <span class="n">between</span> <span class="n">start</span> <span class="n">and</span> <span class="n">end</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mi">100</span>

<span class="n">StepSize</span><span class="o">:</span>
    <span class="n">How</span> <span class="n">big</span> <span class="k">each</span> <span class="n">time</span> <span class="n">increment</span> <span class="k">is</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;0.01&#39;</span><span class="o">,</span>

<span class="n">Start</span><span class="o">:</span> 
    <span class="n">Starting</span> <span class="n">point</span> <span class="n">of</span> <span class="n">stimulation</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mf">0.0</span>

<span class="n">End</span><span class="o">:</span> 
    <span class="n">The</span> <span class="n">end</span> <span class="n">point</span> <span class="n">of</span> <span class="n">the</span> <span class="n">time</span> <span class="n">course</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="mi">1</span><span class="o">.</span>

<span class="err">#</span><span class="n">integration</span> <span class="n">options</span>
<span class="n">RelativeTolerance</span><span class="o">:</span> 
    <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;1e-6&#39;</span><span class="o">,</span>

<span class="n">AbsoluteTolerance</span><span class="o">:</span>
    <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;1e-12&#39;</span><span class="o">,</span>

<span class="n">MaxInternalSteps</span><span class="o">:</span>
    <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;10000&#39;</span><span class="o">,</span>

<span class="n">UpdateModel</span><span class="o">:</span>
    <span class="n">Not</span> <span class="n">really</span> <span class="n">needed</span> <span class="k">in</span> <span class="n">time</span> <span class="n">course</span><span class="o">.</span> <span class="n">Do</span> <span class="n">not</span> <span class="n">change</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span>

<span class="n">Metabolites</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">list</span> <span class="n">of</span> <span class="n">which</span> <span class="n">metabolites</span> <span class="n">to</span> <span class="k">include</span> <span class="k">in</span> <span class="n">output</span><span class="o">.</span> <span class="n">Default</span><span class="o">=</span><span class="n">all</span>

<span class="n">GlobalQuantities</span><span class="o">:</span> 
    <span class="n">A</span> <span class="n">list</span> <span class="n">of</span> <span class="n">global</span> <span class="n">quantities</span> <span class="n">to</span> <span class="k">include</span> <span class="k">in</span> <span class="n">the</span> <span class="n">output</span><span class="o">.</span> <span class="n">Default</span> <span class="k">is</span> <span class="n">all</span> <span class="n">global</span> <span class="n">quantities</span>

<span class="n">QuantityType</span><span class="o">:</span> 
    <span class="n">Either</span> <span class="s1">&#39;particle_numbers&#39;</span> <span class="n">or</span> <span class="s1">&#39;concentration&#39;</span><span class="o">,</span>

<span class="n">ReportName</span><span class="o">:</span> 
    <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">output</span> <span class="n">report</span><span class="o">.</span> <span class="n">Default</span> <span class="k">is</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">copasi</span> <span class="n">file</span> <span class="k">with</span> <span class="n">_TimeCourse</span> <span class="n">appended</span><span class="s1">&#39;</span>

<span class="s1">Append: </span>
<span class="s1">    Append to the report, &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39; , default=&#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">ConfirmOverwrite:</span>
<span class="s1">    Report confirm overwrite , &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39; , default=&#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">SimulationType: </span>
<span class="s1">    Either &#39;</span><span class="n">stochastic</span><span class="s1">&#39; or &#39;</span><span class="n">deterministic</span><span class="s1">&#39;. default=&#39;</span><span class="n">deterministic</span><span class="s1">&#39;. IMPORTANT: stochastic not yet implemented but there is room for it</span>

<span class="s1">OutputEvent: </span>
<span class="s1">    Output event or not, default =&#39;</span><span class="kc">false</span><span class="s1">&#39;</span>

<span class="s1">Scheduled: </span>
<span class="s1">    &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39;. Enables running the simulation by CopasiSE. Default=&#39;</span><span class="kc">true</span><span class="s1">&#39;,</span>

<span class="s1">Save: </span>
<span class="s1">    Save the copasi file with the changes. Either &#39;</span><span class="kc">false</span><span class="s1">&#39;,&#39;</span><span class="n">overwrite</span><span class="s1">&#39; or &#39;</span><span class="n">duplicate</span><span class="s1">&#39;</span>

<span class="s1">PruneHeaders:</span>
<span class="s1">    Copasi automatically prints out copasi references to output files. Set</span>
<span class="s1">    this to &#39;</span><span class="kc">true</span><span class="s1">&#39; to  prune the references off leaving just the variable name,</span>
<span class="s1">    &#39;</span><span class="kc">true</span><span class="s1">&#39; or &#39;</span><span class="kc">false</span><span class="s1">&#39;, default=&#39;</span><span class="kc">true</span><span class="s1">&#39;</span>

<span class="s1">#graph options</span>
<span class="s1">Plot:</span>
<span class="s1">    Whether to plot the graphs or not</span>

<span class="s1">SaveFig:</span>
<span class="s1">    Whether to save the figures to file or not</span>

<span class="s1">ExtraTitle:</span>
<span class="s1">    If SaveFig=&#39;</span><span class="kc">true</span><span class="err">&#39;</span><span class="o">,</span><span class="n">give</span> <span class="n">the</span> <span class="n">filename</span> <span class="n">an</span> <span class="n">extra</span> <span class="n">identifier</span>

<span class="n">LineWidth</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">Thickness</span> <span class="n">of</span> <span class="n">the</span> <span class="n">line</span>

<span class="n">LineColor</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">Color</span> <span class="n">of</span> <span class="n">the</span> <span class="n">line</span>

<span class="n">MarkerColor</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">color</span> <span class="n">of</span> <span class="n">the</span> <span class="n">dots</span>

<span class="n">LineStyle</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">Style</span> <span class="n">of</span> <span class="n">line</span>

<span class="n">MarkerStyle</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">Style</span> <span class="n">of</span> <span class="n">marker</span>

<span class="n">DPI</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span>

<span class="n">XTickRotation</span><span class="o">:</span>
    <span class="n">Passed</span> <span class="n">to</span> <span class="n">Matplotlib</span><span class="o">.</span><span class="na">pyplot</span><span class="o">.</span><span class="na">plot</span><span class="o">.</span> <span class="n">Rotate</span> <span class="n">x</span> <span class="n">labels</span>

<span class="n">TitleWrapSize</span><span class="o">:</span>
    <span class="n">Number</span> <span class="n">of</span> <span class="n">characters</span> <span class="n">before</span> <span class="n">word</span> <span class="n">wrapping</span> <span class="n">the</span> <span class="n">title</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">TimeCourse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a time course using Copasi. Ensure, you specify the corrent amount</span>
<span class="sd">    of time you want simulating. Do this by ensuring that End=StepSize*Intervals.</span>
<span class="sd">    Set Plot=&#39;true&#39; to automatically plot the results which can be found in a file</span>
<span class="sd">    in the same directory as your copasi file in a folder named after your ReportName</span>
<span class="sd">    kwarg</span>
<span class="sd">    </span>
<span class="sd">    NOTE: Space has been left for addition of code to interface with the other</span>
<span class="sd">    copasi solvers. Currently only deterministic is supported. </span>
<span class="sd">    </span>
<span class="sd">    args:</span>
<span class="sd">        copasi_file - the copasi file you want to do a time course on </span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    **kwargs:</span>
<span class="sd">        For arguments related to plotting, see the documentation for Plot</span>
<span class="sd">        </span>
<span class="sd">        Intervals:</span>
<span class="sd">            How many intervals between start and end. Default=100</span>
<span class="sd">        </span>
<span class="sd">        StepSize:</span>
<span class="sd">            How big each time increment is. Default=&#39;0.01&#39;,</span>
<span class="sd">        </span>
<span class="sd">        Start: </span>
<span class="sd">            Starting point of stimulation. Default=0.0</span>
<span class="sd">        </span>
<span class="sd">        End: </span>
<span class="sd">            The end point of the time course. Default=1.</span>
<span class="sd">        </span>
<span class="sd">        #integration options</span>
<span class="sd">        RelativeTolerance: </span>
<span class="sd">            Default=&#39;1e-6&#39;,</span>
<span class="sd">        </span>
<span class="sd">        AbsoluteTolerance:</span>
<span class="sd">            Default=&#39;1e-12&#39;,</span>
<span class="sd">        </span>
<span class="sd">        MaxInternalSteps:</span>
<span class="sd">            Default=&#39;10000&#39;,</span>
<span class="sd">            </span>
<span class="sd">        UpdateModel:</span>
<span class="sd">            Not really needed in time course. Do not change. Default=&#39;false&#39;</span>

<span class="sd">        Metabolites:</span>
<span class="sd">            A list of which metabolites to include in output. Default=all</span>
<span class="sd">        </span>
<span class="sd">        GlobalQuantities: </span>
<span class="sd">            A list of global quantities to include in the output. Default is all global quantities</span>

<span class="sd">        QuantityType: </span>
<span class="sd">            Either &#39;particle_numbers&#39; or &#39;concentration&#39;,</span>

<span class="sd">        ReportName: </span>
<span class="sd">            Name of the output report. Default is name of the copasi file with _TimeCourse appended&#39;</span>

<span class="sd">        Append: </span>
<span class="sd">            Append to the report, &#39;true&#39; or &#39;false&#39; , default=&#39;false&#39;</span>

<span class="sd">        ConfirmOverwrite:</span>
<span class="sd">            Report confirm overwrite , &#39;true&#39; or &#39;false&#39; , default=&#39;false&#39;</span>

<span class="sd">        SimulationType: </span>
<span class="sd">            Either &#39;stochastic&#39; or &#39;deterministic&#39;. default=&#39;deterministic&#39;. IMPORTANT: stochastic not yet implemented but there is room for it</span>

<span class="sd">        OutputEvent: </span>
<span class="sd">            Output event or not, default =&#39;false&#39;</span>

<span class="sd">        Scheduled: </span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;. Enables running the simulation by CopasiSE. Default=&#39;true&#39;,</span>

<span class="sd">        Save: </span>
<span class="sd">            Save the copasi file with the changes. Either &#39;false&#39;,&#39;overwrite&#39; or &#39;duplicate&#39;</span>
<span class="sd">        </span>
<span class="sd">        PruneHeaders:</span>
<span class="sd">            Copasi automatically prints out copasi references to output files. Set</span>
<span class="sd">            this to &#39;true&#39; to  prune the references off leaving just the variable name,</span>
<span class="sd">            &#39;true&#39; or &#39;false&#39;, default=&#39;true&#39;</span>
<span class="sd">        </span>
<span class="sd">        #graph options</span>
<span class="sd">        Plot:</span>
<span class="sd">            Whether to plot the graphs or not</span>
<span class="sd">            </span>
<span class="sd">        SaveFig:</span>
<span class="sd">            Whether to save the figures to file or not</span>
<span class="sd">            </span>
<span class="sd">        ExtraTitle:</span>
<span class="sd">            If SaveFig=&#39;true&#39;,give the filename an extra identifier</span>
<span class="sd">            </span>
<span class="sd">        LineWidth:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Thickness of the line</span>

<span class="sd">        LineColor:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Color of the line</span>

<span class="sd">        MarkerColor:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. color of the dots</span>

<span class="sd">        LineStyle:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Style of line</span>

<span class="sd">        MarkerStyle:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Style of marker</span>

<span class="sd">        DPI:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. </span>
<span class="sd">            </span>
<span class="sd">        XTickRotation:</span>
<span class="sd">            Passed to Matplotlib.pyplot.plot. Rotate x labels</span>
<span class="sd">            </span>
<span class="sd">        TitleWrapSize:</span>
<span class="sd">            Number of characters before word wrapping the title</span>
<span class="sd">            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
        <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_TimeCourse.txt&#39;</span>
        <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>

        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Intervals&#39;</span><span class="p">:</span><span class="s1">&#39;100&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;StepSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.01&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;End&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-6&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-12&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span><span class="s1">&#39;10000&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Start&#39;</span><span class="p">:</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="c1">#report variables</span>
                 <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                 <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
                 <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
<span class="c1">#                 &#39;target&#39;: &#39;cheese.txt&#39;, </span>
                 <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;SimulationType&#39;</span><span class="p">:</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputEvent&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
                 <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
                 
                 <span class="c1">#graph options</span>
                 <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span>      <span class="p">,</span>              
                 <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                 <span class="s1">&#39;LineColor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerColor&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LineStyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerStyle&#39;</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                 <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
                 <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                 <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                 <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
                 <span class="s1">&#39;MarkerSize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                 <span class="s1">&#39;GraphDirectory&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                 

                     <span class="p">}</span>
        <span class="c1">#values need to be lower case for copasiML</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c1">#            kwargs[i]=str(kwargs[i]).lower()</span>
<span class="c1">#            assert isinstance(kwargs[i],str),&#39;all optional arguments passed shold be lower case strings&#39;</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if the below three kwargs are a single entry they can be a string. </span>
<span class="sd">        In this case, put them back into a list to ensure a smooth ride</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>


        
        <span class="c1">#Ensure consistecny for time variables</span>
        <span class="k">assert</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)),</span><span class="s1">&#39;End should equal Interval Size times Number of Intervals but {}!={}*{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>        

        <span class="c1">#make sure Metabolites and ModelValues are lists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument Metabolites should be a Python list&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a Metabolite in this model. These are Metabolites in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument GlobalQuantities should be a Python list&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a global variable in this model. These are global variables in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">())</span>
            
        <span class="c1">#only accept deterministic or stochastic</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span><span class="s1">&#39;stochastic&#39;</span><span class="p">]</span>

<span class="c1">#</span>
        
        <span class="c1">#this bit of code helps keep the keyword arguments consistant</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
            
        <span class="c1">#report arguments</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;PruneHeaders kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Append kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;OutputEvent kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Scheduled kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Plot kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>

        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
        
        <span class="c1">#convert some numeric kwargs to str</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Intervals&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StepSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;End&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
            
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">float</span><span class="p">)</span>
                 
                 
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">)</span> <span class="ow">in</span>   <span class="p">[</span><span class="s1">&#39;-&#39;</span> <span class="p">,</span> <span class="s1">&#39;--&#39;</span> <span class="p">,</span> <span class="s1">&#39;-.&#39;</span> <span class="p">,</span> <span class="s1">&#39;:&#39;</span> <span class="p">,</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">),</span><span class="s1">&#39;{} is not int&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)))</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerStyle&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>

        <span class="n">color_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">}</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                 
                 
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="o">=</span><span class="p">{}</span><span class="c1">#report variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="c1">#self.kwargs.get(&#39;ReportType&#39;)</span>
        
        <span class="c1">#other keywords that are non optional for time course</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)})</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        All methods required for time course are </span>
<span class="sd">        called with run</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_sim_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
        
    <span class="k">def</span> <span class="nf">set_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set parameters for deterministic timecourse</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
        <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic(LSODA)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic (LSODA)&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="c1">#make available to coapsiSE</span>
            <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                    <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Duration&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">)</span>
                        
                    <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepNumber&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)</span>
                        
                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepSize&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TimeSeriesRequested&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>                        

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;OutputStartTime&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output Event&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Continue on Simultaneous Events&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Integrate Reduced Model&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Relative Tolerance&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Absolute Tolerance&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">)</span>

                    <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span>
                        <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>


    <span class="k">def</span> <span class="nf">report_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
        
    <span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        cros reference the timecourse task with the newly created</span>
<span class="sd">        time course reort to get the key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
                <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span><span class="p">,</span><span class="s1">&#39;have you ran the report_definition method?&#39;</span>
        <span class="k">return</span> <span class="n">key</span>
                
    <span class="k">def</span> <span class="nf">set_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use the report defined in self.create_report to tell copasi </span>
<span class="sd">        were to put the results</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
        <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">()</span>
        
        <span class="n">arg_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
                 <span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> 
                 <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
        <span class="n">present</span><span class="o">=</span><span class="bp">False</span>
<span class="c1">#        query=&#39;//Report&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">and</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">present</span><span class="o">=</span><span class="bp">True</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg_dct</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">present</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">arg_dct</span><span class="p">)</span>
                <span class="n">i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">report</span><span class="p">)</span>
<span class="c1">#        self.save()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Run a time course. Use keyword argument:</span>
<span class="sd">            SimulationType=&#39;deterministic&#39; #default</span>
<span class="sd">            SumulationType=&#39;stochastic&#39; #still to be written</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;deterministic&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_report</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_deterministic</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;stochastic&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;There is space in this class to write code to run a stochastic simulation but it is not yet written&#39;</span>
        <span class="c1">#save to duplicate copasi file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)]</span>
            
        <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">R</span>

        
    <span class="k">def</span> <span class="nf">read_sim_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data_output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">])</span>
        <span class="c1">#trim copasi style headers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> 
        
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">## Create directory for graphs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GraphDirectory&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;TimeCourseGraphs&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                         <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                         <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
<span class="c1">#                plt.plot(self.data[&#39;Time&#39;],self.data[i],color=self.kwargs.get(&#39;MarkerColor&#39;),marker=self.kwargs.get(&#39;MarkerStyle&#39;))</span>

                
                <span class="c1">#plot labels</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;Time-Course for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration (micromol)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Particle Numbers&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                        
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_time_unit</span><span class="p">()),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
                    
               <span class="c1">#pretty stuff</span>
        
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="c1">#xtick rotation</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
                
                <span class="c1">#options for changing the plot axis</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
        
                <span class="k">def</span> <span class="nf">save_plot</span><span class="p">():</span>
                    <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                                <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
                        <span class="k">return</span> <span class="n">st</span>
                        
                    <span class="n">filename</span><span class="o">=</span><span class="p">{}</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dire</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
                    <span class="k">return</span> <span class="n">filename</span>
        
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                    
                <span class="c1">#save figure options</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
                    <span class="n">save_plot</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#pycopi.TimeCourse">TimeCourse</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="pycopi.TimeCourse.CParser" class="name">var <span class="ident">CParser</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.GMQ" class="name">var <span class="ident">GMQ</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.copasiML" class="name">var <span class="ident">copasiML</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.copasi_file" class="name">var <span class="ident">copasi_file</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.data" class="name">var <span class="ident">data</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.kwargs" class="name">var <span class="ident">kwargs</span></p>
            

            
  
    <div class="desc"><p>if the below three kwargs are a single entry they can be a string. 
In this case, put them back into a list to ensure a smooth ride</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="pycopi.TimeCourse.report_options" class="name">var <span class="ident">report_options</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, copasi_file, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.__init__', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="o">=</span><span class="n">copasi_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">=</span><span class="n">CopasiMLParser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">=</span><span class="n">GetModelQuantities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)</span>
    <span class="n">default_report_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_TimeCourse.txt&#39;</span>
    <span class="n">default_outputML</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;_Duplicate.cps&#39;</span><span class="p">)</span>
    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Intervals&#39;</span><span class="p">:</span><span class="s1">&#39;100&#39;</span><span class="p">,</span>
             <span class="s1">&#39;StepSize&#39;</span><span class="p">:</span><span class="s1">&#39;0.01&#39;</span><span class="p">,</span>
             <span class="s1">&#39;End&#39;</span><span class="p">:</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
             <span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-6&#39;</span><span class="p">,</span>
             <span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">:</span><span class="s1">&#39;1e-12&#39;</span><span class="p">,</span>
             <span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span><span class="s1">&#39;10000&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Start&#39;</span><span class="p">:</span><span class="s1">&#39;0.0&#39;</span><span class="p">,</span>
             <span class="s1">&#39;UpdateModel&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="c1">#report variables</span>
             <span class="s1">&#39;Metabolites&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
             <span class="s1">&#39;QuantityType&#39;</span><span class="p">:</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ReportName&#39;</span><span class="p">:</span><span class="n">default_report_name</span><span class="p">,</span>
             <span class="s1">&#39;Append&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> 
              <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;cheese.txt&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">:</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;SimulationType&#39;</span><span class="p">:</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputEvent&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Scheduled&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             <span class="s1">&#39;Save&#39;</span><span class="p">:</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span>
             <span class="s1">&#39;OutputML&#39;</span><span class="p">:</span><span class="n">default_outputML</span><span class="p">,</span>
             <span class="s1">&#39;PruneHeaders&#39;</span><span class="p">:</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
             
             <span class="c1">#graph options</span>
             <span class="s1">&#39;Plot&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span>      <span class="p">,</span>              
             <span class="s1">&#39;LineWidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
             <span class="s1">&#39;LineColor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
             <span class="s1">&#39;MarkerColor&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
             <span class="s1">&#39;LineStyle&#39;</span><span class="p">:</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
             <span class="s1">&#39;MarkerStyle&#39;</span><span class="p">:</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
             <span class="s1">&#39;AxisSize&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
             <span class="s1">&#39;FontSize&#39;</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span>
             <span class="s1">&#39;XTickRotation&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
             <span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
             <span class="s1">&#39;SaveFig&#39;</span><span class="p">:</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ExtraTitle&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             <span class="s1">&#39;DPI&#39;</span><span class="p">:</span><span class="mi">125</span><span class="p">,</span>
             <span class="s1">&#39;MarkerSize&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
             <span class="s1">&#39;GraphDirectory&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
             
                 <span class="p">}</span>
    <span class="c1">#values need to be lower case for copasiML</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a keyword argument for TimeCourse&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
         <span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
         <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">str</span><span class="p">),</span><span class="s1">&#39;all optional arguments passed shold be lower case strings&#39;</span>
    <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">=</span><span class="n">options</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if the below three kwargs are a single entry they can be a string. </span>
<span class="sd">    In this case, put them back into a list to ensure a smooth ride</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">),</span><span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LocalParameters&#39;</span><span class="p">)]</span>
    
    <span class="c1">#Ensure consistecny for time variables</span>
    <span class="k">assert</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)),</span><span class="s1">&#39;End should equal Interval Size times Number of Intervals but {}!={}*{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>        
    <span class="c1">#make sure Metabolites and ModelValues are lists</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument Metabolites should be a Python list&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_metabolites</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a Metabolite in this model. These are Metabolites in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_IC_cns</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">),</span><span class="nb">list</span><span class="p">),</span><span class="s1">&#39;Keyword argument GlobalQuantities should be a Python list&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="s1">&#39;{} is not a global variable in this model. These are global variables in this model: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_global_quantities</span><span class="p">())</span>
        
    <span class="c1">#only accept deterministic or stochastic</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span><span class="s1">&#39;stochastic&#39;</span><span class="p">]</span>
    
    <span class="c1">#this bit of code helps keep the keyword arguments consistant</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;concentration&#39;</span><span class="p">,</span><span class="s1">&#39;particle_number&#39;</span><span class="p">]</span>
        
    <span class="c1">#report arguments</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;PruneHeaders kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Append kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;OutputEvent kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Scheduled kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">InputError</span><span class="p">(</span><span class="s1">&#39;Plot kwarg must be either </span><span class="se">\&#39;</span><span class="s1">true</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">false</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;DPI&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="p">]</span>
    
    <span class="c1">#convert some numeric kwargs to str</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Intervals&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;StepSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;End&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Start&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
        
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">),</span><span class="nb">float</span><span class="p">)</span>
             
             
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">)</span> <span class="ow">in</span>   <span class="p">[</span><span class="s1">&#39;-&#39;</span> <span class="p">,</span> <span class="s1">&#39;--&#39;</span> <span class="p">,</span> <span class="s1">&#39;-.&#39;</span> <span class="p">,</span> <span class="s1">&#39;:&#39;</span> <span class="p">,</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="nb">int</span><span class="p">),</span><span class="s1">&#39;{} is not int&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">)))</span>
    
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerStyle&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span>
    <span class="n">color_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
               <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span>
               <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
               <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span>
               <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="s1">&#39;magenta&#39;</span><span class="p">,</span>
               <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
               <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
               <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">}</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">+</span><span class="n">color_dct</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
             
             
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="o">=</span><span class="p">{}</span><span class="c1">#report variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Metabolites&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GlobalQuantities&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Append&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;OutputML&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;Save&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;UpdateModel&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="c1">#self.kwargs.get(&#39;ReportType&#39;)</span>
    
    <span class="c1">#other keywords that are non optional for time course</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportType&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AxisSize&#39;</span><span class="p">)})</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All methods required for time course are </span>
<span class="sd">    called with run</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_sim_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Plot&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.get_report_key">
    <p>def <span class="ident">get_report_key</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>cros reference the timecourse task with the newly created
time course reort to get the key</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.get_report_key', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.get_report_key" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_report_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    cros reference the timecourse task with the newly created</span>
<span class="sd">    time course reort to get the key</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;{http://www.copasi.org/static/schema}ListOfReports&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Time-Course&#39;</span><span class="p">:</span>
            <span class="n">key</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">key</span><span class="o">!=</span><span class="bp">None</span><span class="p">,</span><span class="s1">&#39;have you ran the report_definition method?&#39;</span>
    <span class="k">return</span> <span class="n">key</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.plot">
    <p>def <span class="ident">plot</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.plot', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">## Create directory for graphs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GraphDirectory&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">dire</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span><span class="s1">&#39;TimeCourseGraphs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span><span class="o">!=</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dire</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                     <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineWidth&#39;</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineColor&#39;</span><span class="p">),</span>
                     <span class="n">linestyle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LineStyle&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">markersize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerSize&#39;</span><span class="p">))</span>
             <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerColor&#39;</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MarkerStyle&#39;</span><span class="p">))</span>
            
            <span class="c1">#plot labels</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrap</span><span class="p">(</span><span class="s1">&#39;Time-Course for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TitleWrapSize&#39;</span><span class="p">))),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_quantity_units</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Concentration (micromol)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;QuantityType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;particle_number&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Particle Numbers&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>
                    
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GMQ</span><span class="o">.</span><span class="n">get_time_unit</span><span class="p">()),</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FontSize&#39;</span><span class="p">))</span>         
                
           <span class="c1">#pretty stuff</span>
    
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_smart_bounds</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="c1">#xtick rotation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XTickRotation&#39;</span><span class="p">))</span>
            
            <span class="c1">#options for changing the plot axis</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Ylimit&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">)</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlimit&#39;</span><span class="p">))</span>
    
            <span class="k">def</span> <span class="nf">save_plot</span><span class="p">():</span>
                <span class="k">def</span> <span class="nf">replace_non_ascii</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span>  <span class="ow">not</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s1">&#39;_-[]&#39;</span><span class="p">:</span>
                            <span class="n">st</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">st</span><span class="p">)</span> 
                    <span class="k">return</span> <span class="n">st</span>
                    
                <span class="n">filename</span><span class="o">=</span><span class="p">{}</span>
                <span class="n">name</span><span class="o">=</span><span class="n">replace_non_ascii</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dire</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ExtraTitle&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DPI&#39;</span><span class="p">))</span>     
                <span class="k">return</span> <span class="n">filename</span>
    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Show&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                
            <span class="c1">#save figure options</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SaveFig&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">))</span>
                <span class="n">save_plot</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.read_sim_data">
    <p>def <span class="ident">read_sim_data</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.read_sim_data', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.read_sim_data" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">read_sim_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data_output</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ReportName&#39;</span><span class="p">])</span>
    <span class="c1">#trim copasi style headers</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PruneHeaders&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
        <span class="n">PruneCopasiHeaders</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_output</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span> 
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.report_definition">
    <p>def <span class="ident">report_definition</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.report_definition', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.report_definition" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">report_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="n">Reports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">report_options</span><span class="p">)</span><span class="o">.</span><span class="n">copasiML</span> 
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Run a time course. Use keyword argument:
SimulationType='deterministic' #default
SumulationType='stochastic' #still to be written</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.run', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run a time course. Use keyword argument:</span>
<span class="sd">        SimulationType=&#39;deterministic&#39; #default</span>
<span class="sd">        SumulationType=&#39;stochastic&#39; #still to be written</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;deterministic&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_deterministic</span><span class="p">()</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SimulationType&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;stochastic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;There is space in this class to write code to run a stochastic simulation but it is not yet written&#39;</span>
    <span class="c1">#save to duplicate copasi file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CopasiSE&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">)]</span>
        
    <span class="n">R</span><span class="o">=</span><span class="n">Run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="n">Task</span><span class="o">=</span><span class="s1">&#39;time_course&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.save">
    <p>def <span class="ident">save</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.save', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;duplicate&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputML&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;overwrite&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CParser</span><span class="o">.</span><span class="n">write_copasi_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">copasi_file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>        
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.set_deterministic">
    <p>def <span class="ident">set_deterministic</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>set parameters for deterministic timecourse</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.set_deterministic', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.set_deterministic" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_deterministic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    set parameters for deterministic timecourse</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
    <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic(LSODA)&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Deterministic (LSODA)&#39;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="c1">#make available to coapsiSE</span>
        <span class="n">i</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;scheduled&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Scheduled&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">method_params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
                <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Duration&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;End&#39;</span><span class="p">)</span>
                    
                <span class="k">if</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepNumber&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Intervals&#39;</span><span class="p">)</span>
                    
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;StepSize&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;StepSize&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;TimeSeriesRequested&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>                        
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;OutputStartTime&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Output Event&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OutputEvent&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Continue on Simultaneous Events&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Integrate Reduced Model&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Relative Tolerance&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;RelativeTolerance&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Absolute Tolerance&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AbsoluteTolerance&#39;</span><span class="p">)</span>
                <span class="k">elif</span>  <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">:</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MaxInternalSteps&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="pycopi.TimeCourse.set_report">
    <p>def <span class="ident">set_report</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Use the report defined in self.create_report to tell copasi 
were to put the results</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-pycopi.TimeCourse.set_report', this);">Show source &equiv;</a></p>
  <div id="source-pycopi.TimeCourse.set_report" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Use the report defined in self.create_report to tell copasi </span>
<span class="sd">    were to put the results</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">report_definition</span><span class="p">()</span>
    <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_report_key</span><span class="p">()</span>
    
    <span class="n">arg_dct</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;append&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Append&#39;</span><span class="p">),</span> 
             <span class="s1">&#39;target&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ReportName&#39;</span><span class="p">),</span>
             <span class="s1">&#39;reference&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> 
             <span class="s1">&#39;confirmOverwrite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ConfirmOverwrite&#39;</span><span class="p">)}</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;//*[@name=&#39;Time-Course&#39;]&quot;</span> <span class="ow">and</span> <span class="s2">&quot;//*[@type=&#39;timeCourse&#39;]&quot;</span>
    <span class="n">present</span><span class="o">=</span><span class="bp">False</span>
     <span class="n">query</span><span class="o">=</span><span class="s1">&#39;//Report&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;append&#39;</span> <span class="ow">and</span> <span class="s1">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">present</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">j</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">arg_dct</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">present</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">report</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;Report&#39;</span><span class="p">,</span><span class="n">attrib</span><span class="o">=</span><span class="n">arg_dct</span><span class="p">)</span>
            <span class="n">i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">report</span><span class="p">)</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copasiML</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>